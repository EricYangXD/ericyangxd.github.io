---
title: è®°å½•ä¸€äº›å‰ç«¯çŸ¥è¯†(3)
author: EricYangXD
date: "2022-06-24"
meta:
  - name: keywords
    content: å‰ç«¯ç›‘æ§,ä¸ŠæŠ¥,å¸¸è¯†
---

## å‰ç«¯ç›‘æ§ä¸ŠæŠ¥æ•°æ®

é‡ç‚¹è§£æåœ¨ **é¡µé¢å®ä¾‹å…³é—­** æ—¶ï¼Œå¦‚ä½•å°†ç›‘æ§æ•°æ®ä¸Šä¼ åˆ°æœåŠ¡ç«¯çš„è§£å†³æ–¹æ¡ˆã€‚æ¶‰åŠåˆ° 4 ç§æ–¹æ¡ˆï¼Œåˆ†åˆ«ä¸ºï¼š

- åŒæ­¥`XMLHttpRequest`
- `img.src`
- `navigator.sendBeacon`
- `fetch keepalive`

### åŒæ­¥ XMLHttpRequest

å·²åºŸå¼ƒã€‚

ä¸ºä»€ä¹ˆåŒæ­¥ XMLHttpRequest å¯ä»¥åœ¨é¡µé¢å…³é—­æ—¶ä¸Šä¼ æ•°æ®ï¼ŸåŒæ­¥è¯·æ±‚é˜»æ­¢ä»£ç çš„æ‰§è¡Œï¼Œè¿™ä¼šå¯¼è‡´å±å¹•ä¸Šå‡ºç°â€œå†»ç»“â€å’Œæ— å“åº”çš„ç”¨æˆ·ä½“éªŒã€‚

ç¼ºç‚¹:

- ç”¨æˆ·ä½“éªŒå·®ï¼Œä¼šé˜»å¡é¡µé¢åˆ‡æ¢
- åªæœ‰æ—§ç‰ˆçš„æµè§ˆå™¨æ”¯æŒ Chrome<80
- æ— æ³•è¯»å– reponse çš„è¿”å›å€¼

### img.src

åˆ›å»ºä¸€ä¸ª`<img>`å…ƒç´ ï¼Œå¹¶è®¾ç½®`src`ã€‚å¤§éƒ¨åˆ†çš„æµè§ˆå™¨ï¼Œéƒ½ä¼šå»¶è¿Ÿå¸è½½å½“å‰é¡µé¢ï¼Œä¼˜å…ˆåŠ è½½å›¾åƒã€‚

```js
var data = JSON.stringify({
  time: performance.now(),
});

const img = new Image();
img.src = `http://api.wangxiaokai.vip/test?${JSON.stringify(data)}`;
```

ç¼ºç‚¹:

- æ•°æ®ä¼ è¾“ä¸å¯é ï¼Œæœ‰å¯èƒ½æµè§ˆå™¨å¸è½½å½“å‰é¡µé¢ï¼Œç›´æ¥æ€æ‰å›¾åƒè¯·æ±‚
- åªèƒ½å‘èµ· GET è¯·æ±‚
- æ•°æ®å¤§å°æœ‰é™åˆ¶

### navigator.sendBeacon

é€šè¿‡ HTTP POST è¯·æ±‚ï¼Œå°†å°‘é‡æ•°æ®ä½¿ç”¨å¼‚æ­¥çš„æ–¹å¼ï¼Œå‘é€åˆ°æœåŠ¡ç«¯ã€‚

```js
function reportEvent() {
  const url = "http://api.wangxiaokai.vip/test";
  const data = JSON.stringify({
    time: performance.now(),
  });

  navigator.sendBeacon(url, data);
}

document.addEventListener("visibilitychange", function () {
  if (document.visiblityState === "hidden") {
    reportEvent();
  }
});
```

1. æµè§ˆå™¨ç«¯è‡ªåŠ¨åˆ¤æ–­åˆé€‚çš„æ—¶æœºè¿›è¡Œå‘é€ã€‚
2. ä¸ä¼šäº§ç”Ÿé˜»å¡ï¼Œå½±å“å½“å‰é¡µé¢çš„å¸è½½ã€‚
3. ä¸å½±å“ä¸‹ä¸ªæ–°é¡µé¢çš„åŠ è½½ï¼Œä¸å­˜åœ¨æ€§èƒ½é—®é¢˜ã€‚
4. å¦å¤–ï¼Œæ•°æ®ä¼ è¾“å¯é ã€‚
5. å½“æµè§ˆå™¨å°†æ•°æ®æˆåŠŸåŠ å…¥ä¼ è¾“é˜Ÿåˆ—æ—¶ï¼ŒsendBeacon æ–¹æ³•ä¼šè¿”å› trueï¼Œå¦åˆ™è¿”å› falseã€‚æ³¨æ„è¿”å›å€¼çš„æ—¶æœºï¼šæˆåŠŸåŠ å…¥ä¼ è¾“é˜Ÿåˆ—ï¼Œè€Œä¸æ˜¯æœåŠ¡ç«¯çš„å¤„ç†æˆåŠŸåçš„è¿”å›ã€‚

ç¼ºç‚¹:

- åªèƒ½å‘èµ· POST è¯·æ±‚
- æ— æ³•è‡ªå®šä¹‰è¯·æ±‚å¤´å‚æ•°
- æ•°æ®å¤§å°æœ‰é™åˆ¶ ï¼ˆChrome é™åˆ¶å¤§å°ä¸º 64kbï¼‰
- åªèƒ½åœ¨ window äº‹ä»¶ visibilitychange å’Œ beforeunload ä¸­ä½¿ç”¨ï¼Œå…¶ä»–äº‹ä»¶ä¸­å›è°ƒï¼Œä¼šä¸¢å¤±æ•°æ®

> å‡ºäºå…¼å®¹æ€§åŸå› ï¼Œè¯·ç¡®ä¿ä½¿ç”¨ document.addEventListener è€Œä¸æ˜¯ window.addEventListener æ¥æ³¨å†Œ`visibilitychange`å›è°ƒã€‚

### fetch keepalive

> The keepalive option can be used to allow the request to outlive the page. Fetch with the keepalive flag is a replacement for the Navigator.sendBeacon() API.
> keepalive é€‰é¡¹å¯ç”¨æ¥å…è®¸ä¸€ä¸ªè¯·æ±‚åœ¨é¡µé¢å…³é—­åç»§ç»­å­˜åœ¨ã€‚å¸¦ keepalive æ ‡å¿—çš„ Fetch å¯ä»¥æ›¿ä»£ Navigator.sendBeacon() APIã€‚

æ ‡è®° keepalive çš„ fetch è¯·æ±‚å…è®¸åœ¨é¡µé¢å¸è½½åæ‰§è¡Œã€‚

```js
const url = "http://api.wangxiaokai.vip/test";
const data = JSON.stringify({
  time: performance.now(),
});

fetch(url, {
  method: "POST",
  body: data,
  headers: {
    "Content-Type": "application/json",
  },
  keepalive: true,
});
```

## undefined

ä¸è¦å†ç›´æ¥å†™ undefinedï¼Œå› ä¸ºå¯ä»¥å±€éƒ¨ä¹Ÿèµ·ä¸€ä¸ªå« undefined çš„å˜é‡å¹¶ç»™å®ƒèµ‹å€¼ï¼Œå¦‚æœæ­¤æ—¶ç”¨åˆ°äº† undefinedï¼Œé‚£ä¹ˆå¯èƒ½å‡ºç° bugã€‚ç¤ºä¾‹å¦‚ä¸‹ï¼š

```js
function test(value) {
  let undefined = "hello world";
  if (value === undefined) {
    return `value is undefined`;
  }
  return `value is not undefined`;
}
let value;
test(value); // 'value is not undefined'
```

æ¨èçš„åšæ³•ï¼šä½¿ç”¨`void 0`æˆ–`void(0)`ä»£æ›¿`undefined`ã€‚

void è¿ç®—ç¬¦æ˜¯å¯¹ç»™å®šçš„è¡¨è¾¾å¼è¿›è¡Œæ±‚å€¼ï¼Œç„¶åè¿”å› undefined ã€‚è€Œä¸”ï¼Œ void æ˜¯ä¸èƒ½é‡æ–°å®šä¹‰çš„ï¼Œä¸ç„¶ä¼šæŠ¥è¯­æ³•é”™è¯¯ï¼Œè¿™æ ·ä¹Ÿä¿è¯äº†ç”¨ void æ¥ä»£æ›¿ undefined çš„ä¸ä¼šå‡ºç°è¢«é‡å®šä¹‰è€Œé€ æˆçš„ bugã€‚

## js åˆ¤æ–­å›¾ç‰‡æ˜¯å¦è¢«ç¼“å­˜

```js
/**
 url æµ‹è¯•å›¾ç‰‡è·¯å¾„
 è¢«ç¼“å­˜è¿”å›trueï¼Œæ²¡è¢«ç¼“å­˜è¿”å›false
 */
function testCache(url) {
  alert("æ‰§è¡Œ");
  var url = "http://www.8chedao.com/page/images/webIndex-logo.png";
  var myImg = new Image();
  myImg.src = url;
  if (myImg.complete) {
    alert("å›¾ç‰‡è¢«ç¼“å­˜");
    return true;
  } else {
    alert("å›¾ç‰‡æ²¡è¢«ç¼“å­˜");
    myImg.onload = function () {
      alert("å›¾ç‰‡å·²ç»ä¸‹è½½æˆåŠŸ!");
    };
    return false;
  }
}
```

## æ­£åˆ™-æ•è·ç»„

```javascript
const str = "2022-07";
const reg = /(?<year>[0-9]{4})-(?<month>[0-9]{2})/;

const group = str.match(reg).groups;

console.log(group.year);
```

## css ä¸­ html å’Œ body çš„åŒºåˆ«

1. åœ¨ html ä¸­ï¼Œ`<html>`åŒ…å«`<body>`
2. åœ¨ html æ–‡æ¡£ä¸­ï¼Œ`<html>`æ˜¯æ ¹å…ƒç´ ã€‚
3. åœ¨ css ä¸­æœ‰ä¸€ä¸ª`:root`é€‰æ‹©å™¨ï¼Œå’Œ`html`é€‰æ‹©å™¨ä½œç”¨ä¸€æ ·ï¼Œç”šè‡³`:root`å…·æœ‰æ›´é«˜çš„ä¼˜å…ˆçº§ï¼
4. ä»¥ä¸‹å†…è”å±æ€§ Inline Attribute æœ€åˆåœ¨è§„èŒƒ spec ä¸­åˆ†é…ç»™äº†`<body>`ï¼š`background`ã€`bgcolor`ã€`marginbottom`ã€`marginleft`ã€`marginright`ã€`margintop`ã€`text`
5. ç›¸åº”çš„ CSS å±æ€§ï¼š`background`ã€`background/background-color`ã€`margin-bottom`ã€`margin-left`ã€`margin-right`ã€`margin-top`ã€`font`
6. `rem` å•ä½æ˜¯ç›¸å¯¹äºæ–‡æ¡£æ ¹ç›®å½•çš„ã€‚æ˜¯ç›¸å¯¹äº `<html>` å…ƒç´ çš„å­—ä½“å¤§å°çš„ã€‚
7. å¦‚ä½•å°† `<html>` ä¸Šçš„å­—ä½“å¤§å°è®¾ç½®ä¸ºç™¾åˆ†æ¯”ï¼Œä»¥ä¾¿åœ¨ä½¿ç”¨ rem å•ä½æ—¶ç”¨ä½œé‡ç½®:[1](http://snook.ca/archives/html_and_css/font-size-with-rem)
8. åœ¨ body ä¸Šè®¾ç½®`background-color`ï¼Œ
9. åœ¨ html ä¸Šè®¾ç½®`background-color`ï¼Œ
10. JavaScript ä¹Ÿå­˜åœ¨å·®å¼‚ã€‚ä¾‹å¦‚ï¼Œhtml æ˜¯ `document.rootElement`ï¼Œbody æ˜¯ `document.body`ã€‚
11. body å…ƒç´ å®é™…ä¸Šæ²¡æœ‰æµè§ˆå™¨çª—å£é‚£ä¹ˆé«˜ã€‚å®ƒåªå’Œé‡Œé¢çš„å†…å®¹ä¸€æ ·é«˜ï¼Œå°±åƒ div æˆ–å…¶ä»–ä»»ä½•ä¸œè¥¿ä¸€æ ·ã€‚æ‰€ä»¥åœ¨ body ä¸Šè®¾ç½® background æ—¶è¦ç‰¹åˆ«æ³¨æ„ï¼ŒèƒŒæ™¯æœ‰å¯èƒ½æ’‘ä¸èµ·æ¥ï¼šå¦‚æœ html å…ƒç´ æ²¡æœ‰èƒŒæ™¯ï¼Œbody èƒŒæ™¯å°†è¦†ç›–é¡µé¢ã€‚å¦‚æœ html å…ƒç´ ä¸Šæœ‰èƒŒæ™¯ï¼Œåˆ™ body èƒŒæ™¯çš„è¡Œä¸ºä¸ä»»ä½•å…¶ä»–å…ƒç´ ä¸€æ ·ã€‚æ‰€ä»¥èƒŒæ™¯è‰²è¦ä¹ˆè®¾ç½®åœ¨ html ä¸Šï¼Œè¦ä¹ˆç»™ body è®¾ç½®ä¸€ä¸ªé«˜åº¦ï¼Œä»¥é˜²ä¸‡ä¸€ã€‚
12. å°†åŸºæœ¬å­—ä½“å¤§å°å®šä¹‰ä¸º 62.5%ï¼Œä»¥ä¾¿ä»¥ç±»ä¼¼äºä½¿ç”¨ px çš„æ–¹å¼æ–¹ä¾¿åœ°è°ƒæ•´ rems å¤§å°ã€‚

```css
/* ä¸è€ƒè™‘å…¼å®¹æ€§ */
html {
  font-size: 62.5%;
}
body {
  font-size: 1.4rem;
} /* =14px */
h1 {
  font-size: 2.4rem;
} /* =24px */

/* è€ƒè™‘å…¼å®¹æ€§ */
html {
  font-size: 62.5%;
}
body {
  font-size: 14px;
  font-size: 1.4rem;
} /* =14px */
h1 {
  font-size: 24px;
  font-size: 2.4rem;
} /* =24px */
```

13. å…³é”®åœ¨äºåŒºåˆ†é‚£äº›å±æ€§æ˜¯å¯è¦†ç›–çš„ï¼Œç„¶åè®¾ç½®åœ¨ä¸åŒçš„æ ‡ç­¾ä¸Š

## Why Not Iframe

ä¸ºä»€ä¹ˆä¸ç”¨ iframeï¼Œè¿™å‡ ä¹æ˜¯æ‰€æœ‰å¾®å‰ç«¯æ–¹æ¡ˆç¬¬ä¸€ä¸ªä¼šè¢« challenge çš„é—®é¢˜ã€‚ä½†æ˜¯å¤§éƒ¨åˆ†å¾®å‰ç«¯æ–¹æ¡ˆåˆä¸çº¦è€ŒåŒæ”¾å¼ƒäº† iframe æ–¹æ¡ˆï¼Œè‡ªç„¶æ˜¯æœ‰åŸå› çš„ï¼Œå¹¶ä¸æ˜¯ä¸ºäº† "ç‚«æŠ€" æˆ–è€…åˆ»æ„è¿½æ±‚ "ç‰¹ç«‹ç‹¬è¡Œ"ã€‚

å¦‚æœä¸è€ƒè™‘ä½“éªŒé—®é¢˜ï¼Œiframe å‡ ä¹æ˜¯æœ€å®Œç¾çš„å¾®å‰ç«¯è§£å†³æ–¹æ¡ˆäº†ã€‚

iframe æœ€å¤§çš„ç‰¹æ€§å°±æ˜¯æä¾›äº†æµè§ˆå™¨åŸç”Ÿçš„ç¡¬éš”ç¦»æ–¹æ¡ˆï¼Œä¸è®ºæ˜¯æ ·å¼éš”ç¦»ã€js éš”ç¦»è¿™ç±»é—®é¢˜ç»Ÿç»Ÿéƒ½èƒ½è¢«å®Œç¾è§£å†³ã€‚ä½†ä»–çš„æœ€å¤§é—®é¢˜ä¹Ÿåœ¨äºä»–çš„éš”ç¦»æ€§æ— æ³•è¢«çªç ´ï¼Œå¯¼è‡´åº”ç”¨é—´ä¸Šä¸‹æ–‡æ— æ³•è¢«å…±äº«ï¼Œéšä¹‹å¸¦æ¥çš„å¼€å‘ä½“éªŒã€äº§å“ä½“éªŒçš„é—®é¢˜ã€‚

- url ä¸åŒæ­¥ã€‚æµè§ˆå™¨åˆ·æ–° iframe url çŠ¶æ€ä¸¢å¤±ã€åé€€å‰è¿›æŒ‰é’®æ— æ³•ä½¿ç”¨ã€‚
- UI ä¸åŒæ­¥ï¼ŒDOM ç»“æ„ä¸å…±äº«ã€‚æƒ³è±¡ä¸€ä¸‹å±å¹•å³ä¸‹è§’ 1/4 çš„ iframe é‡Œæ¥ä¸€ä¸ªå¸¦é®ç½©å±‚çš„å¼¹æ¡†ï¼ŒåŒæ—¶æˆ‘ä»¬è¦æ±‚è¿™ä¸ªå¼¹æ¡†è¦æµè§ˆå™¨å±…ä¸­æ˜¾ç¤ºï¼Œè¿˜è¦æµè§ˆå™¨ resize æ—¶è‡ªåŠ¨å±…ä¸­ã€‚
- å…¨å±€ä¸Šä¸‹æ–‡å®Œå…¨éš”ç¦»ï¼Œå†…å­˜å˜é‡ä¸å…±äº«ã€‚iframe å†…å¤–ç³»ç»Ÿçš„é€šä¿¡ã€æ•°æ®åŒæ­¥ç­‰éœ€æ±‚ï¼Œä¸»åº”ç”¨çš„ cookie è¦é€ä¼ åˆ°æ ¹åŸŸåéƒ½ä¸åŒçš„å­åº”ç”¨ä¸­å®ç°å…- ç™»æ•ˆæœã€‚
- æ…¢ã€‚æ¯æ¬¡å­åº”ç”¨è¿›å…¥éƒ½æ˜¯ä¸€æ¬¡æµè§ˆå™¨ä¸Šä¸‹æ–‡é‡å»ºã€èµ„æºé‡æ–°åŠ è½½çš„è¿‡ç¨‹ã€‚

å…¶ä¸­æœ‰çš„é—®é¢˜æ¯”è¾ƒå¥½è§£å†³(é—®é¢˜ 1)ï¼Œæœ‰çš„é—®é¢˜æˆ‘ä»¬å¯ä»¥çä¸€åªçœ¼é—­ä¸€åªçœ¼(é—®é¢˜ 4)ï¼Œä½†æœ‰çš„é—®é¢˜æˆ‘ä»¬åˆ™å¾ˆéš¾è§£å†³(é—®é¢˜ 3)ç”šè‡³æ— æ³•è§£å†³(é—®é¢˜ 2)ï¼Œè€Œè¿™äº›æ— æ³•è§£å†³çš„é—®é¢˜æ°æ°åˆä¼šç»™äº§å“å¸¦æ¥éå¸¸ä¸¥é‡çš„ä½“éªŒé—®é¢˜ï¼Œ æœ€ç»ˆå¯¼è‡´æˆ‘ä»¬èˆå¼ƒäº† iframe æ–¹æ¡ˆã€‚

## ä¸º iframe æ­£å

## JavaScript æ·±æ‹·è´æ€§èƒ½åˆ†æ

### å¼•ç”¨ä¼ å€¼

```javascript
function mutate(obj) {
  obj.a = true;
}

const obj = { a: false };
mutate(obj);
console.log(obj.a); // è¾“å‡º true
```

1. å¯¹äºåŸºæœ¬ç±»å‹ï¼Œæ˜¯è¿›è¡Œå€¼ä¼ é€’ï¼›å¯¹äºå¼•ç”¨ç±»å‹ï¼Œä¼ é€’çš„æ˜¯è¿™ä¸ªå¯¹è±¡çš„æŒ‡é’ˆã€‚
2. åœ¨å€¼ä¼ é€’çš„åœºæ™¯ä¸­ï¼Œå‡½æ•°çš„å½¢å‚åªæ˜¯å®å‚çš„ä¸€ä¸ªå‰¯æœ¬ â€”â€”a copyâ€”â€” å½“å‡½æ•°è°ƒç”¨å®Œæˆåï¼Œå¹¶ä¸æ”¹å˜å®å‚ã€‚ä½†æ˜¯åœ¨ JavaScript è¿™ç§å¼•ç”¨ä¼ é€’çš„åœºæ™¯ä¸­ï¼Œå‡½æ•°çš„å½¢å‚å’Œå®å‚æŒ‡å‘åŒä¸€ä¸ªå¯¹è±¡ï¼Œå½“å‚æ•°å†…éƒ¨æ”¹å˜å½¢å‚çš„æ—¶å€™ï¼Œå‡½æ•°å¤–é¢çš„å®å‚ä¹Ÿè¢«æ”¹å˜äº†ã€‚

### æµ…æ‹·è´ï¼šObject.assign ()

```javascript
function mutateDeepObject(obj) {
  obj.a.thing = true;
}

const obj = { a: { thing: false } };
const copy = Object.assign({}, obj);
mutateDeepObject(copy);
console.log(obj.a.thing); // prints true

const a = { a: 1, b: 2, c: 3, d: { e: 5 } };
const b = { ...a };
console.log(b.d.e); // 5
b.d.e = 8;
console.log(a.d.e); // 8
```

1. `Object.assign(target, sources...)`ã€‚å®ƒæ¥å—ä»»æ„æ•°é‡çš„æºå¯¹è±¡ï¼Œæšä¸¾å®ƒä»¬çš„æ‰€æœ‰å±æ€§å¹¶åˆ†é…ç»™ targetã€‚å¦‚æœæˆ‘ä»¬ä½¿ç”¨ä¸€ä¸ªæ–°çš„ç©ºå¯¹è±¡ targetï¼Œé‚£ä¹ˆæˆ‘ä»¬å°±å¯ä»¥å®ç°å¯¹è±¡çš„å¤åˆ¶ã€‚æ³¨æ„ï¼Œç¬¬ä¸€ä¸ªå‚æ•° targetï¼Œä¼šè¢«æ”¹å˜ï¼
2. è¯¥æ–¹æ³•åªé€‚åˆæ‹·è´æ²¡æœ‰åµŒå¥—å¯¹è±¡çš„æƒ…å†µï¼Œå¦åˆ™è¦æ³¨æ„ï¼šä»–åªæ˜¯ä¸ªæµ…æ‹·è´ï¼Œå¯¹äºæ·±å±‚çš„å¯¹è±¡åªæ˜¯æ‹·è´çš„æŒ‡é’ˆã€‚ä¿®æ”¹æ–°çš„å¯¹è±¡å¯èƒ½ä¼šå¯¼è‡´æºå¯¹è±¡å‘ç”Ÿå˜åŒ–ï¼
3. æ³¨æ„ï¼šå¯¹è±¡è§£æ„è¿ç®—ï¼Œè¿™ä¹Ÿæ˜¯æµ…æ‹·è´ã€‚

### æ·±æ‹·è´çš„å‡ ç§æ–¹æ³•

æ·±æ‹·è´æ˜¯ä¸€ä¸ªå¸¸è§éœ€æ±‚ï¼Œæˆ‘ä»¬å¯ä»¥é€šè¿‡ `JSON` è½¬æ¢ã€é€’å½’ã€lodash çš„`_.cloneDeep()`ç­‰æ–¹å¼å®ç°ã€‚

#### `JSON.parse()`+`JSON.stringify()`

å°†è¯¥å¯¹è±¡è½¬æ¢ä¸ºå…¶ JSON å­—ç¬¦ä¸²è¡¨ç¤ºå½¢å¼ï¼Œç„¶åå°†å…¶è§£æå›å¯¹è±¡ã€‚

> ç¼ºç‚¹

- éœ€è¦åˆ›å»ºä¸€ä¸ªä¸´æ—¶çš„ï¼Œå¯èƒ½å¾ˆå¤§çš„å­—ç¬¦ä¸²ï¼Œåªæ˜¯ä¸ºäº†æŠŠå®ƒé‡æ–°æ”¾å›è§£æå™¨ã€‚
- ä¸èƒ½å¤„ç†å¾ªç¯å¯¹è±¡ã€‚è€Œä¸”å¾ªç¯å¯¹è±¡ç»å¸¸å‘ç”Ÿã€‚
- è¯¸å¦‚ Map, Set, RegExp, Date, ArrayBuffer å’Œå…¶ä»–å†…ç½®ç±»å‹åœ¨è¿›è¡Œåºåˆ—åŒ–æ—¶ä¼šä¸¢å¤±ã€‚
- ä¸èƒ½å…‹éš† functionã€‚
- å¯¹äºå€¼ä¸º undefined çš„å±æ€§ï¼Œå…‹éš†ä¹‹åä¼šè¢«ä¸¢å¼ƒã€‚å€¼ä¸º null çš„å±æ€§ä¼šè¢«ä¿ç•™ã€‚å¯ä»¥é€šè¿‡æ”¹å†™`JSON.stringify()`çš„ç¬¬äºŒä¸ªå‚æ•°è¿›è¡Œã€Œä¿®å¤ã€ã€‚
- åŸç†ï¼š`JSON.stringify` åªèƒ½å¤„ç†åŸºæœ¬å¯¹è±¡ã€æ•°ç»„å’ŒåŸºæœ¬ç±»å‹ï¼Œè€Œå…¶ä»–ç±»å‹çš„å€¼åœ¨è½¬æ¢ä¹‹åéƒ½å¯èƒ½å‡ºç°å‡ºä¹æ„æ–™çš„ç»“æœï¼Œä¾‹å¦‚ Date ä¼šè½¬åŒ–ä¸ºå­—ç¬¦ä¸²ï¼Œ Set ä¼šè½¬åŒ–ä¸º {}ã€‚`JSON.stringify` ç”šè‡³å®Œå…¨å¿½ç•¥æŸäº›å†…å®¹ï¼Œæ¯”å¦‚ undefined æˆ–å‡½æ•°ã€‚
- é™¤æ­¤ä¹‹å¤–ï¼Œ`JSON.parse(JSON.stringify(x))` æ— æ³•å¯¹åŒ…å«å¾ªç¯å¼•ç”¨çš„å¯¹è±¡è¿›è¡Œæ·±å…‹éš†

#### Structured Clone ç»“æ„åŒ–å…‹éš†ç®—æ³•

Structured cloning æ˜¯ä¸€ç§ç°æœ‰çš„ç®—æ³•ï¼Œç”¨äºå°†å€¼ä»ä¸€ä¸ªåœ°æ–¹è½¬ç§»åˆ°å¦ä¸€åœ°æ–¹ã€‚ä¾‹å¦‚ï¼Œæ¯å½“æ‚¨è°ƒç”¨ postMessage å°†æ¶ˆæ¯å‘é€åˆ°å¦ä¸€ä¸ªçª—å£æˆ– WebWorker æ—¶ï¼Œéƒ½ä¼šä½¿ç”¨å®ƒã€‚å…³äºç»“æ„åŒ–å…‹éš†çš„å¥½å¤„åœ¨äºå®ƒå¤„ç†å¾ªç¯å¯¹è±¡å¹¶ æ”¯æŒå¤§é‡çš„å†…ç½®ç±»å‹ã€‚

å®é™…ä¸Šï¼ŒJavaScript ä¸­æä¾›äº†ä¸€ä¸ªåŸç”Ÿ API æ¥æ‰§è¡Œå¯¹è±¡çš„æ·±æ‹·è´ï¼š`structuredClone()`ã€‚å®ƒå¯ä»¥é€šè¿‡ç»“æ„åŒ–å…‹éš†ç®—æ³•åˆ›å»ºä¸€ä¸ªç»™å®šå€¼çš„æ·±æ‹·è´ï¼Œå¹¶ä¸”è¿˜å¯ä»¥ä¼ è¾“åŸå§‹å€¼çš„å¯è½¬ç§»å¯¹è±¡ã€‚

`structuredClone()` çš„å®ç”¨æ–¹å¼å¾ˆç®€å•ï¼Œåªéœ€å°†åŸå§‹å¯¹è±¡ä¼ é€’ç»™è¯¥å‡½æ•°ï¼Œå®ƒå°†è¿”å›å…·æœ‰ä¸åŒå¼•ç”¨å’Œå¯¹è±¡å±æ€§å¼•ç”¨çš„æ·±å±‚å‰¯æœ¬ã€‚

æ³¨æ„äº‹é¡¹ï¼š

1. æ‹·è´æ— é™åµŒå¥—çš„å¯¹è±¡å’Œæ•°ç»„ï¼›
2. æ‹·è´å¾ªç¯å¼•ç”¨ï¼›å½“å¯¹è±¡ä¸­å­˜åœ¨å¾ªç¯å¼•ç”¨æ—¶ï¼Œä»ç„¶å¯ä»¥é€šè¿‡ `structuredClone()` è¿›è¡Œæ·±æ‹·è´ã€‚
3. æ‹·è´å„ç§ JavaScript ç±»å‹ï¼Œä¾‹å¦‚ Dateã€Setã€Mapã€Errorã€RegExpã€ArrayBufferã€Blobã€Fileã€ImageData ç­‰ï¼›
4. æ‹·è´ä½¿ç”¨ structuredClone()å¾—åˆ°çš„å¯¹è±¡ï¼›
5. `structuredClone()`ä¸èƒ½å…‹éš† DOM å…ƒç´ ã€‚å°† HTMLElement å¯¹è±¡ä¼ é€’ç»™ `structuredClone()`å°†å¯¼è‡´é”™è¯¯ã€‚
6. å¯ä»¥æ‹·è´ä»»ä½•å¯è½¬ç§»çš„å¯¹è±¡ã€‚è¦æ³¨æ„çš„æ˜¯ï¼Œä½¿ç”¨å¯è½¬ç§»å¯¹è±¡æ—¶å¿…é¡»å°å¿ƒå¤„ç†ï¼Œå› ä¸ºä¸€æ—¦å¯¹è±¡è¢«è½¬ç§»ï¼ŒåŸçº¿ç¨‹å°†ä¸å†æ‹¥æœ‰è¯¥å¯¹è±¡çš„æ‰€æœ‰æƒï¼Œå› æ­¤åœ¨å‘é€çº¿ç¨‹ä¸­ä¸èƒ½å†è®¿é—®è¯¥å¯¹è±¡ã€‚æ­¤å¤–ï¼Œåœ¨æ¥æ”¶çº¿ç¨‹ä¸­ä½¿ç”¨å¯è½¬ç§»å¯¹è±¡æ—¶ï¼Œä¹Ÿéœ€è¦æ ¹æ®éœ€æ±‚è¿›è¡Œæ˜¾å¼é‡Šæ”¾ï¼Œå¦åˆ™å¯èƒ½ä¼šå¯¼è‡´å†…å­˜æ³„æ¼å’Œå…¶ä»–é—®é¢˜ã€‚

```js
const originalObject = {
  set: new Set([1, 3, 3]),
  map: new Map([[1, 2]]),
  regex: /foo/,
  deep: { array: [new File(someBlobData, "file.txt")] },
  error: new Error("Hello!"),
};
originalObject.circular = originalObject;

const copied = structuredClone(originalObject);
```

- åœ¨ JavaScript ä¸­ï¼Œå¯è½¬ç§»å¯¹è±¡ï¼ˆTransferable Objectsï¼‰æ˜¯æŒ‡ ArrayBuffer å’Œ MessagePort ç­‰ç±»å‹çš„å¯¹è±¡ï¼Œå®ƒä»¬å¯ä»¥åœ¨ä¸»çº¿ç¨‹å’Œ Web Worker çº¿ç¨‹ä¹‹é—´ç›¸äº’ä¼ é€’ï¼ŒåŒæ—¶è¿˜å¯ä»¥å®ç°é›¶æ‹·è´å†…å­˜å…±äº«ï¼Œæé«˜æ€§èƒ½ã€‚è¿™æ˜¯ç”±äºå¯è½¬ç§»å¯¹è±¡å…·æœ‰ä¸¤ä¸ªç‰¹ç‚¹ï¼š

  1. å¯å…±äº«ï¼šå¯è½¬ç§»å¯¹è±¡æœ¬èº«æ²¡æœ‰æ‰€æœ‰æƒï¼Œå¯ä»¥åœ¨å¤šä¸ªçº¿ç¨‹ä¹‹é—´å…±äº«ï¼Œå®ç°é›¶æ‹·è´å†…å­˜å…±äº«ã€‚
  2. å¯è½¬ç§»ï¼šè°ƒç”¨ Transferable API æ—¶ï¼Œå¯è½¬ç§»å¯¹è±¡ä¼šä»å‘é€æ–¹ï¼ˆå‘é€çº¿ç¨‹ï¼‰è½¬ç§»åˆ°æ¥æ”¶æ–¹ï¼ˆæ¥æ”¶çº¿ç¨‹ï¼‰ï¼Œä¸å†å­˜åœ¨äºåŸå§‹çº¿ç¨‹ä¸­ï¼Œå› æ­¤å¯ä»¥é¿å…å†…å­˜æ‹·è´å’Œåˆ†é…ç­‰å¼€é”€ã€‚

7. `structuredClone()` ä¸èƒ½æ‹·è´çš„æ•°æ®ç±»å‹:

   1. å‡½æ•°æˆ–æ–¹æ³•ï¼Œä¼šæŠ›å‡ºå¼‚å¸¸ã€‚
   2. DOM èŠ‚ç‚¹ï¼Œä¹Ÿä¼šæŠ›å‡ºå¼‚å¸¸ã€‚
   3. å±æ€§æè¿°ç¬¦ã€setter å’Œ getterï¼Œä»¥åŠç±»ä¼¼çš„å…ƒæ•°æ®éƒ½ä¸èƒ½è¢«å…‹éš†ã€‚
   4. å¯¹è±¡åŸå‹ï¼ŒåŸå‹é“¾ä¸èƒ½è¢«éå†æˆ–æ‹·è´ã€‚æ‰€ä»¥å¦‚æœå…‹éš†ä¸€ä¸ªå®ä¾‹ MyClassï¼Œå…‹éš†çš„å¯¹è±¡å°†ä¸å†æ˜¯è¿™ä¸ªç±»çš„ä¸€ä¸ªå®ä¾‹ï¼ˆä½†æ˜¯è¿™ä¸ªç±»çš„æ‰€æœ‰æœ‰æ•ˆå±æ€§éƒ½å°†è¢«æ‹·è´ï¼‰ã€‚

8. æ”¯æŒæ‹·è´çš„ç±»å‹å¦‚ä¸‹ï¼š
   1. JS å†…ç½®å¯¹è±¡ï¼šArrayï¼ˆæ•°ç»„ï¼‰ã€ArrayBufferï¼ˆæ•°æ®ç¼“å†²åŒºï¼‰ã€Booleanï¼ˆå¸ƒå°”ç±»å‹ï¼‰ã€DataViewï¼ˆæ•°æ®è§†å›¾ï¼‰ã€Dateï¼ˆæ—¥æœŸç±»å‹ï¼‰ã€Errorï¼ˆé”™è¯¯ç±»å‹ï¼ŒåŒ…æ‹¬ä¸‹é¢åˆ—å‡ºçš„å…·ä½“ç±»å‹ï¼‰ã€Mapï¼ˆæ˜ å°„ç±»å‹ï¼‰ã€Object ï¼ˆä»…æŒ‡çº¯å¯¹è±¡ï¼Œå¦‚ä»å¯¹è±¡å­—é¢é‡ä¸­åˆ›å»ºçš„å¯¹è±¡ï¼‰ã€åŸå§‹ç±»å‹ï¼ˆé™¤ symbol å¤–ï¼Œå³ numberã€stringã€nullã€undefinedã€booleanã€BigIntï¼‰ã€RegExpï¼ˆæ­£åˆ™è¡¨è¾¾å¼ï¼‰ã€Setï¼ˆé›†åˆç±»å‹ï¼‰ã€TypedArrayï¼ˆç±»å‹åŒ–æ•°ç»„ï¼‰ã€‚
   2. Error ç±»å‹ï¼šErrorã€EvalErrorã€RangeErrorã€ReferenceErrorã€SyntaxErrorã€TypeErrorã€URIErrorã€‚
   3. Web/API ç±»å‹ï¼šAudioDataã€Blobã€CryptoKeyã€DOMExceptionã€DOMMatrixã€DOMMatrixReadOnlyã€DOMPointã€DomQuadã€DomRectã€Fileã€FileListã€FileSystemDirectoryHandleã€FileSystemFileHandleã€FileSystemHandleã€ImageBitmapã€ImageDataã€RTCCertificateã€VideoFrameã€‚
9. ç›®å‰ä¸»æµæµè§ˆå™¨éƒ½æ”¯æŒ structuredClone APIã€‚

#### MessageChannel

å¯ä»¥åˆ›å»ºä¸€ä¸ª MessageChannel å¹¶å‘é€æ¶ˆæ¯ã€‚åœ¨æ¥æ”¶ç«¯ï¼Œæ¶ˆæ¯åŒ…å«æˆ‘ä»¬åŸå§‹æ•°æ®å¯¹è±¡çš„ç»“æ„åŒ–å…‹éš†ã€‚

```javascript
function structuralClone(obj) {
   return new Promise(resolve => {
     const {port1, port2} = new MessageChannel();
     port2.onmessage = ev => resolve(ev.data);
     port1.postMessage(obj);
   });
 }

 const obj = /* ... */;
 const clone = await structuralClone(obj);
```

ç¼ºç‚¹æ˜¯å®ƒæ˜¯å¼‚æ­¥çš„ã€‚è™½ç„¶è¿™å¹¶æ— å¤§ç¢ï¼Œä½†æ˜¯æœ‰æ—¶å€™ä½ éœ€è¦ä½¿ç”¨åŒæ­¥çš„æ–¹å¼æ¥æ·±åº¦æ‹·è´ä¸€ä¸ªå¯¹è±¡ã€‚

#### History API

`history.pushState()`å¯ä»¥æä¾›ä¸€ä¸ªçŠ¶æ€å¯¹è±¡æ¥ä¿å­˜ URLã€‚è¿™ä¸ªçŠ¶æ€å¯¹è±¡ä½¿ç”¨ç»“æ„åŒ–å…‹éš† - è€Œä¸”æ˜¯åŒæ­¥çš„ã€‚

ä¸ºäº†é˜²æ­¢å‘ç”Ÿä»»ä½•æ„å¤–ï¼Œè¯·ä½¿ç”¨ `history.replaceState()` è€Œä¸æ˜¯ `history.pushState()`ã€‚

```javascript
 function structuralClone(obj) {
		const oldState = history.state;
		history.replaceState(obj, document.title);
		const copy = history.state;
		history.replaceState(oldState, document.title);
		return copy;
 }

 const obj = /* ... */;
 const clone = structuralClone(obj);
```

#### Notification API

```javascript
function structuralClone(obj) {
   return new Notification('', {data: obj, silent: true}).data;
 }

 const obj = /* ... */;
 const clone = structuralClone(obj);
```

æµè§ˆå™¨æ”¯æŒåº¦ä¸å¤Ÿã€‚

#### å¸¸è§„çš„éå†å¯¹è±¡å¹¶èµ‹å€¼

`for..in`+`Object.hasOwnProperty()`

#### æ€»ç»“

- å¦‚æœæ²¡æœ‰å¾ªç¯å¯¹è±¡ï¼Œå¹¶ä¸”ä¸éœ€è¦ä¿ç•™å†…ç½®ç±»å‹ï¼Œåˆ™å¯ä»¥ä½¿ç”¨è·¨æµè§ˆå™¨ `JSON.parse(JSON.stringify())` è·å¾—æœ€å¿«çš„å…‹éš†æ€§èƒ½ã€‚
- å¦‚æœä½ æƒ³è¦ä¸€ä¸ªé€‚å½“çš„ç»“æ„åŒ–å…‹éš†ï¼Œ`MessageChannel` æ˜¯ä½ å”¯ä¸€å¯é çš„è·¨æµè§ˆå™¨çš„é€‰æ‹©ã€‚

### console.log ä¸å†…å­˜æ³„æ¼

1. `console.log` åœ¨ devtools æ‰“å¼€çš„æ—¶å€™æ˜¯æœ‰å†…å­˜æ³„æ¼çš„ï¼Œå› ä¸ºæ§åˆ¶å°æ‰“å°çš„æ˜¯å¯¹è±¡å¼•ç”¨ï¼Œä½†æ˜¯ä¸æ‰“å¼€ devtools æ˜¯ä¸ä¼šæœ‰å†…å­˜æ³„æ¼çš„ã€‚
2. é€šè¿‡`performance.memory.totalJSHeapSize/1024/1024`ï¼Œé…åˆ `console.log` æ‰“å°å¯ä»¥éªŒè¯ã€‚
3. `string` åŸºæœ¬ç±»å‹å› ä¸ºå¸¸é‡æ± çš„å­˜åœ¨ï¼ŒåŒæ ·çš„å­—ç¬¦ä¸²å®é™…åªä¼šåˆ›å»ºä¸€æ¬¡ã€‚è€Œ `new String` çš„è¯æ‰ä¼šåœ¨å †ä¸­åˆ›å»ºä¸€ä¸ªå¯¹è±¡ï¼Œç„¶åæŒ‡å‘å¸¸é‡æ± ä¸­çš„å­—ç¬¦ä¸²å­—é¢é‡ã€‚
4. nodejs æ‰“å°çš„æ˜¯åºåˆ—åŒ–åçš„å¯¹è±¡ï¼Œæ‰€ä»¥æ²¡æœ‰å†…å­˜æ³„éœ²ã€‚
5. ç”Ÿäº§ç¯å¢ƒæ˜¯å¯ä»¥ä½¿ç”¨ `console.log` çš„ï¼Œæ²¡æœ‰å†…å­˜æ³„æ¼é—®é¢˜ã€‚

### peerDependency

peerDependency å¯ä»¥é¿å…æ ¸å¿ƒä¾èµ–åº“è¢«é‡å¤ä¸‹è½½çš„é—®é¢˜ã€‚æ¯”å¦‚ï¼š

```bash
...
â”œâ”€â”€ helloWorld
â”‚   â””â”€â”€ node_modules
â”‚       â”œâ”€â”€ packageA
â”‚       â”œâ”€â”€ plugin1
â”‚       â”‚   â””â”€â”€ nodule_modules
â”‚       â”‚       â””â”€â”€ packageA
â”‚       â””â”€â”€ plugin2
â”‚       â”‚   â””â”€â”€ nodule_modules
â”‚       â”‚       â””â”€â”€ packageA
...
```

1. æ­¤æ—¶ helloWorld æœ¬èº«å·²ç»å®‰è£…äº†ä¸€æ¬¡ packageAï¼Œä½†æ˜¯å› ä¸ºå› ä¸ºåœ¨ plugin1 å’Œ plugin2 ä¸­çš„ dependencies ä¹Ÿå£°æ˜äº† packageAï¼Œæ‰€ä»¥æœ€å packageA ä¼šè¢«å®‰è£…ä¸‰æ¬¡ï¼Œæœ‰ä¸¤æ¬¡å®‰è£…æ˜¯å†—ä½™çš„ã€‚
2. å¦‚æœåœ¨ plugin1 å’Œ plugin2 çš„ package.json ä¸­ä½¿ç”¨ peerDependency æ¥å£°æ˜æ ¸å¿ƒä¾èµ–åº“ï¼Œä¾‹å¦‚ï¼š

```js
// plugin1/package.json
{
	"peerDependencies": {
		"packageA": "1.0.1"
	}
}
// plugin2/package.json
{
  "peerDependencies": {
    "packageA": "1.0.1"
  }
}
// helloWorld/package.json
{
  "dependencies": {
    "packageA": "1.0.1"
  }
}
```

3. æ­¤æ—¶åœ¨ä¸»ç³»ç»Ÿä¸­æ‰§è¡Œ `npm install` ç”Ÿæˆçš„ä¾èµ–å›¾å°±æ˜¯è¿™æ ·çš„ï¼šå¯ä»¥çœ‹åˆ°è¿™æ—¶å€™ç”Ÿæˆçš„ä¾èµ–å›¾æ˜¯æ‰å¹³çš„ï¼ŒpackageA ä¹Ÿåªä¼šè¢«å®‰è£…ä¸€æ¬¡ã€‚

```bash
...
â”œâ”€â”€ helloWorld
â”‚   â””â”€â”€ node_modules
â”‚       â”œâ”€â”€ packageA
â”‚       â”œâ”€â”€ plugin1
â”‚       â””â”€â”€ plugin2
...
```

4. æ€»ç»“ï¼šåœ¨æ’ä»¶ä½¿ç”¨ dependencies å£°æ˜ä¾èµ–åº“çš„ç‰¹ç‚¹ï¼š
   - å¦‚æœç”¨æˆ·æ˜¾å¼ä¾èµ–äº†æ ¸å¿ƒåº“ï¼Œåˆ™å¯ä»¥å¿½ç•¥å„æ’ä»¶çš„ peerDependency å£°æ˜ï¼›
   - å¦‚æœç”¨æˆ·æ²¡æœ‰æ˜¾å¼ä¾èµ–æ ¸å¿ƒåº“ï¼Œåˆ™æŒ‰ç…§æ’ä»¶ peerDependencies ä¸­å£°æ˜çš„ç‰ˆæœ¬å°†åº“å®‰è£…åˆ°é¡¹ç›®æ ¹ç›®å½•ä¸­ï¼›
   - å½“ç”¨æˆ·ä¾èµ–çš„ç‰ˆæœ¬ã€å„æ’ä»¶ä¾èµ–çš„ç‰ˆæœ¬ä¹‹é—´ä¸ç›¸äº’å…¼å®¹ï¼Œä¼šæŠ¥é”™è®©ç”¨æˆ·è‡ªè¡Œä¿®å¤ï¼›

## WebGL

[DEMO ç½‘ç«™](http://js1k.com/2016-elemental/demo/2552)

## Vue3diff

[Vue3 diff](https://blog.csdn.net/zl_Alien/article/details/106595459)

## iframe é˜²æ­¢ä»–äººåµŒå¥—è‡ªå·±çš„ç½‘ç«™

TODO

1. é€šè¿‡ parent åˆ¤æ–­ origin

## å‡ ä¸ªæ¡†æ¶å¯¹æ¯”æ€»ç»“

1. ä¸åŒæ¡†æ¶ç¼–è¯‘ä¹‹åçš„å·®å¼‚ï¼š

- ğŸš€ React ç¼–è¯‘ä¹‹åæ˜¯ Jsx å‡½æ•°è¿”å›çš„è™šæ‹Ÿ DOM
- ğŸš€ Vue ç¼–è¯‘ä¹‹åæ˜¯ render å‡½æ•°è¿”å›çš„è™šæ‹Ÿ DOM
- ğŸš€ SolidJS ç¼–è¯‘ä¹‹åè¿”å›çš„çœŸå® DOM å­—ç¬¦ä¸²
- ğŸš€ Svelte ç¼–è¯‘ä¹‹åè¿”å›çš„æ˜¯çœŸå® DOM ç‰‡æ®µ

2. React ç”±äºæ¶æ„æœºåˆ¶å†³å®šäº†æ¯å½“çŠ¶æ€å‘ç”Ÿæ”¹å˜ï¼Œä»å½“å‰ç»„ä»¶å¼€å§‹ä¸€ç›´åˆ°å¶å­ç»„ä»¶é‡æ–°åŠ è½½ã€‚

3. Vue ç”±äºç»™æ¯ä¸ªç»„ä»¶å»ºç«‹äº† watchEffect ç›‘å¬æœºåˆ¶ï¼Œæ¯å½“ç»„ä»¶ä¾èµ–çš„çŠ¶æ€å‘ç”Ÿæ”¹å˜ï¼Œå½“å‰ç»„ä»¶é‡æ–°åŠ è½½ã€‚

4. SolidJS å’Œ Svelte ç”±äºåœ¨ç¼–è¯‘ä¹‹åå°±ç¡®å®šäº†å½“çŠ¶æ€å‘ç”Ÿæ”¹å˜ UI éšä¹‹å˜åŒ–çš„å…³ç³»ï¼Œæ‰€ä»¥ä»…ä»…æ˜¯å…·ä½“ DOM çš„é‡æ–°åŠ è½½ã€‚
5. ç›¸å¯¹æ¥è¯´ï¼Œreact æ›´æ–°ç²’åº¦æœ€ç²—ï¼Œä½†æ˜¯é…åˆ useMemo/memo ä¹‹åå¯ä»¥è·Ÿ Vue å·®ä¸å¤šï¼ŒVue æ›´æ–°ç²’åº¦ä¸­ç­‰ï¼ŒSolidJS å’Œ Svelte æ›´æ–°ç²’åº¦ç›¸å¯¹æœ€ç»†ã€‚
