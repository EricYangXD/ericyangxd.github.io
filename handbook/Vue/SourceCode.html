<!DOCTYPE html>
<html lang="zh-CN">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>Vue源码阅读笔记 | 木易的OT</title>
    <meta name="generator" content="VuePress 1.9.10">
    <script>
        (function() {
          if (location.href.indexOf('github.io') > -1 || location.href.indexOf('gitee.io') > -1) {
             location.href = 'https://ericyangxd.top'
           }
        })();
        </script><script type='application/ld+json'>
          {
            "@context": "https://schema.org",
            "@type": "Article",
            "headline": "Vue源码阅读笔记",
            "url": "https://ericyangxd.top/handbook/Vue/SourceCode.html",
            "image": [
              "https://ericyangxd.top/logo.png"
              ],
            "datePublished": "2021-12-28T00:00:00.000Z",
            "dateModified": "2022-11-21T00:00:00.000Z",
            "author": [{
                "@type": "Person",
                "name": "EricYangXD",
                "url": "https://github.com/EricYangXD/ericyangxd.github.io"
            }]
          }
      </script>
    <meta name="description" content="前端面试,React,Vue,JavaScript,CSS,HTML,HTTP,HTTPS,websocket,UDP,TCP,Webpack,算法,数据结构,LeetCode,小程序,油猴,计算机网络,NodeJs,Vite,Antdesign,EricYangXD,Eric,Chrome,Android,V8,Mac,git,网络安全,开发技巧,路由,router,诗歌,金句,源码,面试,Docker,Shell,clash,Windows">
    <meta name="keywords" content="Vue,Vue2,Vue3,vuejs">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    
    <link rel="preload" href="/assets/css/0.styles.82c89da6.css" as="style"><link rel="preload" href="/assets/js/app.dc65e826.js" as="script"><link rel="preload" href="/assets/js/4.e4331d91.js" as="script"><link rel="preload" href="/assets/js/3.561be8e5.js" as="script"><link rel="preload" href="/assets/js/2.b25d4684.js" as="script"><link rel="preload" href="/assets/js/1.c7cb60d4.js" as="script"><link rel="preload" href="/assets/js/128.dbe3f14f.js" as="script"><link rel="prefetch" href="/assets/js/10.26f8cbb6.js"><link rel="prefetch" href="/assets/js/100.7fae6247.js"><link rel="prefetch" href="/assets/js/101.ae508331.js"><link rel="prefetch" href="/assets/js/102.daf4b1af.js"><link rel="prefetch" href="/assets/js/103.dd41178a.js"><link rel="prefetch" href="/assets/js/104.c7ed69bb.js"><link rel="prefetch" href="/assets/js/105.4114372b.js"><link rel="prefetch" href="/assets/js/106.4e6efe42.js"><link rel="prefetch" href="/assets/js/107.1f6383cb.js"><link rel="prefetch" href="/assets/js/108.13530cca.js"><link rel="prefetch" href="/assets/js/109.f8314321.js"><link rel="prefetch" href="/assets/js/11.ec88ce3f.js"><link rel="prefetch" href="/assets/js/110.1e8fba06.js"><link rel="prefetch" href="/assets/js/111.7b8c0c60.js"><link rel="prefetch" href="/assets/js/112.6472474a.js"><link rel="prefetch" href="/assets/js/113.bd1177e6.js"><link rel="prefetch" href="/assets/js/114.2213830d.js"><link rel="prefetch" href="/assets/js/115.33093e00.js"><link rel="prefetch" href="/assets/js/116.c0ad0326.js"><link rel="prefetch" href="/assets/js/117.d62815dc.js"><link rel="prefetch" href="/assets/js/118.210eeb62.js"><link rel="prefetch" href="/assets/js/119.d25b30e3.js"><link rel="prefetch" href="/assets/js/120.2c702778.js"><link rel="prefetch" href="/assets/js/121.e2186a28.js"><link rel="prefetch" href="/assets/js/122.3db35d03.js"><link rel="prefetch" href="/assets/js/123.d510795a.js"><link rel="prefetch" href="/assets/js/124.3e1b9be7.js"><link rel="prefetch" href="/assets/js/125.7fb2c8e1.js"><link rel="prefetch" href="/assets/js/126.81d3c4e5.js"><link rel="prefetch" href="/assets/js/127.3ba58f0b.js"><link rel="prefetch" href="/assets/js/129.a5a70f0a.js"><link rel="prefetch" href="/assets/js/130.d034fbb6.js"><link rel="prefetch" href="/assets/js/131.461fc811.js"><link rel="prefetch" href="/assets/js/132.17038b4f.js"><link rel="prefetch" href="/assets/js/133.5c0652af.js"><link rel="prefetch" href="/assets/js/134.ad63a46d.js"><link rel="prefetch" href="/assets/js/14.0c7d0fae.js"><link rel="prefetch" href="/assets/js/15.b8e5af0a.js"><link rel="prefetch" href="/assets/js/16.ed296b89.js"><link rel="prefetch" href="/assets/js/17.d9e3ba74.js"><link rel="prefetch" href="/assets/js/18.8ddab221.js"><link rel="prefetch" href="/assets/js/19.57a74dfb.js"><link rel="prefetch" href="/assets/js/20.e3da0919.js"><link rel="prefetch" href="/assets/js/21.546b406c.js"><link rel="prefetch" href="/assets/js/22.9450f156.js"><link rel="prefetch" href="/assets/js/23.c854b682.js"><link rel="prefetch" href="/assets/js/24.877c6c49.js"><link rel="prefetch" href="/assets/js/25.1110b637.js"><link rel="prefetch" href="/assets/js/26.3f26d858.js"><link rel="prefetch" href="/assets/js/27.533548d8.js"><link rel="prefetch" href="/assets/js/28.98a340e2.js"><link rel="prefetch" href="/assets/js/29.edf59bdf.js"><link rel="prefetch" href="/assets/js/30.b7cf2b52.js"><link rel="prefetch" href="/assets/js/31.1fe66269.js"><link rel="prefetch" href="/assets/js/32.e46a6d14.js"><link rel="prefetch" href="/assets/js/33.db6ae149.js"><link rel="prefetch" href="/assets/js/34.66c83798.js"><link rel="prefetch" href="/assets/js/35.1f8028c0.js"><link rel="prefetch" href="/assets/js/36.86d9fc47.js"><link rel="prefetch" href="/assets/js/37.c2037205.js"><link rel="prefetch" href="/assets/js/38.334016b8.js"><link rel="prefetch" href="/assets/js/39.a4f75b3a.js"><link rel="prefetch" href="/assets/js/40.89908c21.js"><link rel="prefetch" href="/assets/js/41.93437118.js"><link rel="prefetch" href="/assets/js/42.6cf34dad.js"><link rel="prefetch" href="/assets/js/43.7a46793a.js"><link rel="prefetch" href="/assets/js/44.c1702fc4.js"><link rel="prefetch" href="/assets/js/45.6316ed79.js"><link rel="prefetch" href="/assets/js/46.439e5202.js"><link rel="prefetch" href="/assets/js/47.87681d15.js"><link rel="prefetch" href="/assets/js/48.c340068e.js"><link rel="prefetch" href="/assets/js/49.0a3f6b91.js"><link rel="prefetch" href="/assets/js/5.41516153.js"><link rel="prefetch" href="/assets/js/50.cbd9d193.js"><link rel="prefetch" href="/assets/js/51.b5ffd127.js"><link rel="prefetch" href="/assets/js/52.ea752ffd.js"><link rel="prefetch" href="/assets/js/53.e988f540.js"><link rel="prefetch" href="/assets/js/54.04880f81.js"><link rel="prefetch" href="/assets/js/55.fac0a3ee.js"><link rel="prefetch" href="/assets/js/56.b98506d7.js"><link rel="prefetch" href="/assets/js/57.98cfb129.js"><link rel="prefetch" href="/assets/js/58.c40a7c90.js"><link rel="prefetch" href="/assets/js/59.e72acdce.js"><link rel="prefetch" href="/assets/js/6.dca3a5c8.js"><link rel="prefetch" href="/assets/js/60.b51e1255.js"><link rel="prefetch" href="/assets/js/61.a27e3f44.js"><link rel="prefetch" href="/assets/js/62.6cbb8d14.js"><link rel="prefetch" href="/assets/js/63.ac580b74.js"><link rel="prefetch" href="/assets/js/64.e563f145.js"><link rel="prefetch" href="/assets/js/65.ebae5779.js"><link rel="prefetch" href="/assets/js/66.5565eb64.js"><link rel="prefetch" href="/assets/js/67.fa38a7b6.js"><link rel="prefetch" href="/assets/js/68.54ada60c.js"><link rel="prefetch" href="/assets/js/69.4910cca7.js"><link rel="prefetch" href="/assets/js/7.8f6e299c.js"><link rel="prefetch" href="/assets/js/70.60e53528.js"><link rel="prefetch" href="/assets/js/71.5c6efcd7.js"><link rel="prefetch" href="/assets/js/72.87408f22.js"><link rel="prefetch" href="/assets/js/73.350cd6e5.js"><link rel="prefetch" href="/assets/js/74.7bc03c8e.js"><link rel="prefetch" href="/assets/js/75.a67962d6.js"><link rel="prefetch" href="/assets/js/76.e42e2a81.js"><link rel="prefetch" href="/assets/js/77.3d1a7c23.js"><link rel="prefetch" href="/assets/js/78.9655f8b0.js"><link rel="prefetch" href="/assets/js/79.450eac23.js"><link rel="prefetch" href="/assets/js/8.41d4a20d.js"><link rel="prefetch" href="/assets/js/80.87005869.js"><link rel="prefetch" href="/assets/js/81.48731aed.js"><link rel="prefetch" href="/assets/js/82.ec4d1c90.js"><link rel="prefetch" href="/assets/js/83.6e34373d.js"><link rel="prefetch" href="/assets/js/84.fdfdb3e0.js"><link rel="prefetch" href="/assets/js/85.b929e816.js"><link rel="prefetch" href="/assets/js/86.62e2e4e6.js"><link rel="prefetch" href="/assets/js/87.aa0d55ff.js"><link rel="prefetch" href="/assets/js/88.8da69483.js"><link rel="prefetch" href="/assets/js/89.adfa0429.js"><link rel="prefetch" href="/assets/js/9.492c22f0.js"><link rel="prefetch" href="/assets/js/90.ab647d23.js"><link rel="prefetch" href="/assets/js/91.6fd66c60.js"><link rel="prefetch" href="/assets/js/92.85be695d.js"><link rel="prefetch" href="/assets/js/93.94c6f5d5.js"><link rel="prefetch" href="/assets/js/94.dafb7d5d.js"><link rel="prefetch" href="/assets/js/95.f10f9dc5.js"><link rel="prefetch" href="/assets/js/96.2b49983d.js"><link rel="prefetch" href="/assets/js/97.2ce141e1.js"><link rel="prefetch" href="/assets/js/98.dfaa0c18.js"><link rel="prefetch" href="/assets/js/99.988edad3.js"><link rel="prefetch" href="/assets/js/vendors~docsearch.bd007aa5.js">
    <link rel="stylesheet" href="/assets/css/0.styles.82c89da6.css">
  </head>
  <body>
    <div id="app" data-server-rendered="true"><div class="theme-container" data-v-130b300a><div data-v-130b300a><div class="password-shadow password-wrapper-out" style="display:none;" data-v-25ba6db2 data-v-130b300a data-v-130b300a><h3 class="title" data-v-25ba6db2 data-v-25ba6db2>木易的OT</h3> <p class="description" data-v-25ba6db2 data-v-25ba6db2>前端面试,React,Vue,JavaScript,CSS,HTML,HTTP,HTTPS,websocket,UDP,TCP,Webpack,算法,数据结构,LeetCode,小程序,油猴,计算机网络,NodeJs,Vite,Antdesign,EricYangXD,Eric,Chrome,Android,V8,Mac,git,网络安全,开发技巧,路由,router,诗歌,金句,源码,面试,Docker,Shell,clash,Windows</p> <label id="box" class="inputBox" data-v-25ba6db2 data-v-25ba6db2><input type="password" value="" data-v-25ba6db2> <span data-v-25ba6db2>Konck! Knock!</span> <button data-v-25ba6db2>OK</button></label> <div class="footer" data-v-25ba6db2 data-v-25ba6db2><span data-v-25ba6db2><i class="iconfont reco-theme" data-v-25ba6db2></i> <a target="blank" href="https://vuepress-theme-reco.recoluan.com" data-v-25ba6db2>vuePress-theme-reco</a></span> <span data-v-25ba6db2><i class="iconfont reco-copyright" data-v-25ba6db2></i> <a data-v-25ba6db2><span data-v-25ba6db2>EricYangXD</span>
            
          <!---->
          2024
        </a></span></div></div> <div class="hide" data-v-130b300a><header class="navbar" data-v-130b300a><div class="sidebar-button"><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" role="img" viewBox="0 0 448 512" class="icon"><path fill="currentColor" d="M436 124H12c-6.627 0-12-5.373-12-12V80c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12z"></path></svg></div> <a href="/" class="home-link router-link-active"><!----> <span class="site-name">木易的OT</span></a> <div class="links"><div class="color-picker"><a class="color-button"><i class="iconfont reco-color"></i></a> <div class="color-picker-menu" style="display:none;"><div class="mode-options"><h4 class="title">Choose mode</h4> <ul class="color-mode-options"><li class="dark">dark</li><li class="auto active">auto</li><li class="light">light</li></ul></div></div></div> <div class="search-box"><input aria-label="Search" autocomplete="off" spellcheck="false" value=""> <!----></div> <nav class="nav-links can-hide"><div class="nav-item"><a href="/" class="nav-link"><i class="undefined"></i>
  首页
</a></div><div class="nav-item"><div class="dropdown-wrapper"><a class="dropdown-title"><span class="title"><i class="undefined"></i>
      木易的OT
    </span> <span class="arrow right"></span></a> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="https://github.com/EricYangXD" target="_blank" rel="noopener noreferrer" class="nav-link external"><i class="undefined"></i>
  Github
  <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></li><li class="dropdown-item"><!----> <a href="https://juejin.cn/user/2295436007445021" target="_blank" rel="noopener noreferrer" class="nav-link external"><i class="undefined"></i>
  掘金
  <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></li></ul></div></div> <!----></nav></div></header> <div class="sidebar-mask" data-v-130b300a></div> <aside class="sidebar" data-v-130b300a><div class="personal-info-wrapper" data-v-39576ba9 data-v-130b300a><!----> <h3 class="name" data-v-39576ba9>
    EricYangXD
  </h3> <div class="num" data-v-39576ba9><div data-v-39576ba9><h3 data-v-39576ba9>96</h3> <h6 data-v-39576ba9>文章</h6></div> <div data-v-39576ba9><h3 data-v-39576ba9>0</h3> <h6 data-v-39576ba9>标签</h6></div></div> <ul class="social-links" data-v-39576ba9></ul> <hr data-v-39576ba9></div> <nav class="nav-links"><div class="nav-item"><a href="/" class="nav-link"><i class="undefined"></i>
  首页
</a></div><div class="nav-item"><div class="dropdown-wrapper"><a class="dropdown-title"><span class="title"><i class="undefined"></i>
      木易的OT
    </span> <span class="arrow right"></span></a> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="https://github.com/EricYangXD" target="_blank" rel="noopener noreferrer" class="nav-link external"><i class="undefined"></i>
  Github
  <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></li><li class="dropdown-item"><!----> <a href="https://juejin.cn/user/2295436007445021" target="_blank" rel="noopener noreferrer" class="nav-link external"><i class="undefined"></i>
  掘金
  <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></li></ul></div></div> <!----></nav> <ul class="sidebar-links"><li><section class="sidebar-group collapsable depth-0"><a href="/" class="sidebar-heading clickable router-link-active"><span>About</span> <span class="arrow right"></span></a> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>React</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading open"><span>Vue</span> <span class="arrow down"></span></p> <ul class="sidebar-links sidebar-group-items"><li><a href="/handbook/Vue/SourceCode.html" aria-current="page" class="active sidebar-link">Vue源码</a></li><li><a href="/handbook/Vue/ElementUI.html" class="sidebar-link">ElementUI踩坑记录</a></li><li><a href="/handbook/Vue/Skills.html" class="sidebar-link">Vue开发体会</a></li></ul></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>LeetCode</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>JavaScript</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>CSS</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>AntDesign</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>小程序</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>Webpack</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>开发技巧</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>Angular</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>Backend（Java Based）</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>Docker</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>油猴</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>计算机网络</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>Nodejs</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>Vite</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>Web安全</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>Google Chrome V8</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>Git</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>Mac使用记录</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>文章诗句</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>Office软件</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>股海沉浮</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>打工人须知</span> <span class="arrow right"></span></p> <!----></section></li></ul> </aside> <div class="password-shadow password-wrapper-in" style="display:none;" data-v-25ba6db2 data-v-130b300a><h3 class="title" data-v-25ba6db2 data-v-25ba6db2>Vue源码阅读笔记</h3> <!----> <label id="box" class="inputBox" data-v-25ba6db2 data-v-25ba6db2><input type="password" value="" data-v-25ba6db2> <span data-v-25ba6db2>Konck! Knock!</span> <button data-v-25ba6db2>OK</button></label> <div class="footer" data-v-25ba6db2 data-v-25ba6db2><span data-v-25ba6db2><i class="iconfont reco-theme" data-v-25ba6db2></i> <a target="blank" href="https://vuepress-theme-reco.recoluan.com" data-v-25ba6db2>vuePress-theme-reco</a></span> <span data-v-25ba6db2><i class="iconfont reco-copyright" data-v-25ba6db2></i> <a data-v-25ba6db2><span data-v-25ba6db2>EricYangXD</span>
            
          <!---->
          2024
        </a></span></div></div> <div data-v-130b300a><main class="page"><section><div class="page-title"><h1 class="title">Vue源码阅读笔记</h1> <div data-v-f875f3fc><i class="iconfont reco-account" data-v-f875f3fc><span data-v-f875f3fc>EricYangXD</span></i> <i class="iconfont reco-date" data-v-f875f3fc><span data-v-f875f3fc>2021/12/28</span></i> <i class="iconfont reco-eye" data-v-f875f3fc><span id="/handbook/Vue/SourceCode.html" data-flag-title="Your Article Title" class="leancloud-visitors" data-v-f875f3fc><a class="leancloud-visitors-count" style="font-size:.9rem;font-weight:normal;color:#999;"></a></span></i> <!----></div></div> <div class="theme-reco-content content__default"><h2 id="生命周期"><a href="#生命周期" class="header-anchor">#</a> 生命周期</h2> <h3 id="vue3-0"><a href="#vue3-0" class="header-anchor">#</a> Vue3.0</h3> <ul><li><p>如图：<img src="https://cdn.jsdelivr.net/gh/EricYangXD/vital-images@master/imgs/lifecycle.svg" alt="生命周期"></p></li> <li><p>生命周期钩子</p></li></ul> <ol><li><code>Vue.createApp(options).mount(el)</code>；</li> <li><code>init events &amp; lifecycle</code>；</li> <li>beforeCreate 钩子：此时创建了一个空白的 Vue 实例；data、methods 尚未初始化，不可用；</li> <li><code>init injections &amp; reactivity</code>；</li> <li>created 钩子：此时 Vue 实例初始化完成，完成响应式绑定；data、methods 都已经初始化完成，可以调用；尚未开始渲染模板；</li> <li>判断<code>options</code>里面是否有<code>template</code>属性？如果有<code>template</code>，则把<code>template</code>编译成 render 函数，否则把 el 的 innerHTML 编译成模板；</li> <li>beforeMount 钩子：此时编译模板，调用 render 生成 vdom；还没有开始渲染 dom；dom 不可用；</li> <li><code>create app.$el and append it to el</code>；</li> <li>mounted 钩子：此时已经把 vdom 转化成真实的 dom 节点并挂载到 el 上，完成 dom 渲染；组件就创建完成了；此时可以操作 dom，并由「创建阶段」进入「运行阶段」。</li> <li>在 Mounted 之后进入运行阶段，当 data 发生变化时，进入 Update 更新阶段；</li> <li>beforeUpdate 钩子：此时 data 发生变化，准备更新 dom；</li> <li><code>vdom diff、re-rendered and patch</code>；</li> <li>updated 钩子：此时 dom 已完成更新，data 的变化已反映在 dom 上；不要在此时修改 data，否则会死循环！</li> <li>然后进入「销毁阶段」时：即触发<code>app.unmount()</code>之后；</li> <li>beforeUnmount 钩子：组件卸载之前，组件尚未销毁依然可正常使用，此时可以清理一些全局事件、自定义事件，如定时器、事件监听等；</li> <li>unmounted 钩子：组件包括所有的子组件都已卸载/销毁；</li> <li>被<code>keep-alive</code>包裹的组件的生命周期：activated 和 deactivated，激活和未激活；</li> <li>activated：初次渲染，先 created，然后 activated；之后切换时，只会触发 deactivated（先，要隐藏的） 和 activated（后，要激活的）；</li></ol> <ul><li>Vue3 Composition API 生命周期的变化：</li></ul> <ol><li>用 setup 代替了 beforeCreate 和 created；</li> <li>使用 Hooks 函数的形式，如 mounted 改为 onMounted()；</li></ol> <h3 id="vue-中的-render-函数"><a href="#vue-中的-render-函数" class="header-anchor">#</a> Vue 中的 render 函数</h3> <ol><li>h，即 createElement，是 Render 函数的核心。</li> <li>h 有 3 个参数，分别是：
<ol><li>要渲染的元素或组件，可以是一个 html 标签、组件选项或一个函数（不常用），该参数为必填项。</li> <li>对应属性的数据对象，比如组件的 props、元素的 class、绑定的事件、slot、自定义指令等。</li> <li>子节点，可选，String 或 Array，它同样是一个 h。</li></ol></li> <li>Functional Render：Vue.js 提供了一个 functional 的布尔值选项，设置为 true 可以使组件无状态和无实例，也就是没有 data 和 this 上下文。这样用 Render 函数返回虚拟节点可以更容易渲染，因为函数化组件（Functional Render）只是一个函数，渲染开销要小很多。</li></ol> <h3 id="什么时候操作-dom-更合适"><a href="#什么时候操作-dom-更合适" class="header-anchor">#</a> 什么时候操作 dom 更合适</h3> <ol><li>mounted 和 updated 都不能保证子组件全部挂载完成；</li> <li>使用<code>$nextTick</code>渲染 dom；</li></ol> <h3 id="nexttick-的原理"><a href="#nexttick-的原理" class="header-anchor">#</a> nextTick 的原理</h3> <ol><li>nextTick 中的回调是在下次 Dom 更新循环结束之后执行的延迟回调</li> <li>可以用于获取更新后的 Dom</li> <li>Vue 中的数据更新是异步的，使用 nextTick 可以保证用户定义的逻辑在更新之后执行</li></ol> <h3 id="什么时候操作-ajax"><a href="#什么时候操作-ajax" class="header-anchor">#</a> 什么时候操作 ajax</h3> <ol><li>created 和 mounted 钩子里都可以；</li> <li>推荐 mounted；因为 created 到 mounted 中间间隔的时间一般都很短暂，体验不出区别；</li></ol> <h3 id="vue2-vue3-react-三者-diff-算法的区别"><a href="#vue2-vue3-react-三者-diff-算法的区别" class="header-anchor">#</a> Vue2/Vue3/React 三者 diff 算法的区别</h3> <blockquote><p>diff 算法是搭配 vdom 的，vdom 可以保证性能的下限不会太低。</p></blockquote> <p>tree diff 的优化：时间复杂度 O(n)：</p> <ol><li>只比较同一层级，不跨层级比较；</li> <li>tag 不同则删掉重建，不再去比较内部的细节；</li> <li>子节点通过 key 区分唯一性；</li></ol> <ul><li>Vue2</li></ul> <ol><li>双端相互 比较</li></ol> <ul><li>Vue3</li></ul> <ol><li>最长递增子序列</li></ol> <ul><li>React</li></ul> <ol><li>仅右移</li></ol> <h3 id="vue-react-为何循环时必须使用-key"><a href="#vue-react-为何循环时必须使用-key" class="header-anchor">#</a> Vue/React 为何循环时必须使用 key</h3> <ol><li>vdom diff 算法会根据 key 判断元素是否要删除</li> <li>匹配了 key，则只移动元素，性能较好</li> <li>未匹配 key，则删除重建，性能较差</li> <li>最大程度的复用已有的 dom 节点</li></ol> <h3 id="vue-router-的三种模式"><a href="#vue-router-的三种模式" class="header-anchor">#</a> Vue-Router 的三种模式</h3> <ol><li>createHashHistory: location.hash &amp; window.onhashchange</li> <li>createWebHistory: history.pushState/history.replaceState &amp; window.onpopstate</li> <li>createMemoryHistory/abstractHistory: 路由状态存在内存中，不会改变 url，适用于 SSR</li></ol> <h3 id="组件之间的通信方式"><a href="#组件之间的通信方式" class="header-anchor">#</a> 组件之间的通信方式</h3> <h4 id="父子组件"><a href="#父子组件" class="header-anchor">#</a> 父子组件</h4> <ol><li><code>props</code>/<code>$emit</code>&amp;<code>$on</code>、<code>@on</code></li> <li><code>$refs</code></li> <li><code>$parent</code>&amp;<code>$children</code></li> <li><code>.sync</code>修饰符配合<code>v-bind:update:</code></li> <li>派发与广播——自行实现<code>dispatch</code> 和 <code>broadcast</code>方法:</li></ol> <div class="language-js line-numbers-mode"><pre class="language-js"><code><span class="token keyword">function</span> <span class="token function">broadcast</span><span class="token punctuation">(</span><span class="token parameter">componentName<span class="token punctuation">,</span> eventName<span class="token punctuation">,</span> params</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
	<span class="token keyword">this</span><span class="token punctuation">.</span>$children<span class="token punctuation">.</span><span class="token function">forEach</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">child</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
		<span class="token keyword">const</span> name <span class="token operator">=</span> child<span class="token punctuation">.</span>$options<span class="token punctuation">.</span>name<span class="token punctuation">;</span>

		<span class="token keyword">if</span> <span class="token punctuation">(</span>name <span class="token operator">===</span> componentName<span class="token punctuation">)</span> <span class="token punctuation">{</span>
			child<span class="token punctuation">.</span><span class="token function">$emit</span><span class="token punctuation">.</span><span class="token function">apply</span><span class="token punctuation">(</span>child<span class="token punctuation">,</span> <span class="token punctuation">[</span>eventName<span class="token punctuation">]</span><span class="token punctuation">.</span><span class="token function">concat</span><span class="token punctuation">(</span>params<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
		<span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>
			<span class="token function">broadcast</span><span class="token punctuation">.</span><span class="token function">apply</span><span class="token punctuation">(</span>child<span class="token punctuation">,</span> <span class="token punctuation">[</span>componentName<span class="token punctuation">,</span> eventName<span class="token punctuation">]</span><span class="token punctuation">.</span><span class="token function">concat</span><span class="token punctuation">(</span><span class="token punctuation">[</span>params<span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
		<span class="token punctuation">}</span>
	<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
<span class="token keyword">export</span> <span class="token keyword">default</span> <span class="token punctuation">{</span>
	<span class="token literal-property property">methods</span><span class="token operator">:</span> <span class="token punctuation">{</span>
		<span class="token function">dispatch</span><span class="token punctuation">(</span><span class="token parameter">componentName<span class="token punctuation">,</span> eventName<span class="token punctuation">,</span> params</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
			<span class="token keyword">let</span> parent <span class="token operator">=</span> <span class="token keyword">this</span><span class="token punctuation">.</span>$parent <span class="token operator">||</span> <span class="token keyword">this</span><span class="token punctuation">.</span>$root<span class="token punctuation">;</span>
			<span class="token keyword">let</span> name <span class="token operator">=</span> parent<span class="token punctuation">.</span>$options<span class="token punctuation">.</span>name<span class="token punctuation">;</span>

			<span class="token keyword">while</span> <span class="token punctuation">(</span>parent <span class="token operator">&amp;&amp;</span> <span class="token punctuation">(</span><span class="token operator">!</span>name <span class="token operator">||</span> name <span class="token operator">!==</span> componentName<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
				parent <span class="token operator">=</span> parent<span class="token punctuation">.</span>$parent<span class="token punctuation">;</span>

				<span class="token keyword">if</span> <span class="token punctuation">(</span>parent<span class="token punctuation">)</span> <span class="token punctuation">{</span>
					name <span class="token operator">=</span> parent<span class="token punctuation">.</span>$options<span class="token punctuation">.</span>name<span class="token punctuation">;</span>
				<span class="token punctuation">}</span>
			<span class="token punctuation">}</span>
			<span class="token keyword">if</span> <span class="token punctuation">(</span>parent<span class="token punctuation">)</span> <span class="token punctuation">{</span>
				parent<span class="token punctuation">.</span><span class="token function">$emit</span><span class="token punctuation">.</span><span class="token function">apply</span><span class="token punctuation">(</span>parent<span class="token punctuation">,</span> <span class="token punctuation">[</span>eventName<span class="token punctuation">]</span><span class="token punctuation">.</span><span class="token function">concat</span><span class="token punctuation">(</span>params<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
			<span class="token punctuation">}</span>
		<span class="token punctuation">}</span><span class="token punctuation">,</span>
		<span class="token function">broadcast</span><span class="token punctuation">(</span><span class="token parameter">componentName<span class="token punctuation">,</span> eventName<span class="token punctuation">,</span> params</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
			<span class="token function">broadcast</span><span class="token punctuation">.</span><span class="token function">call</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">,</span> componentName<span class="token punctuation">,</span> eventName<span class="token punctuation">,</span> params<span class="token punctuation">)</span><span class="token punctuation">;</span>
		<span class="token punctuation">}</span><span class="token punctuation">,</span>
	<span class="token punctuation">}</span><span class="token punctuation">,</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br><span class="line-number">28</span><br><span class="line-number">29</span><br><span class="line-number">30</span><br><span class="line-number">31</span><br><span class="line-number">32</span><br><span class="line-number">33</span><br></div></div><h4 id="兄弟组件"><a href="#兄弟组件" class="header-anchor">#</a> 兄弟组件</h4> <h4 id="隔代-跨级组件"><a href="#隔代-跨级组件" class="header-anchor">#</a> 隔代/跨级组件</h4> <ol><li>provide/inject: provide 和 inject 绑定并不是可响应的。这是刻意为之的。然而，如果你传入了一个可监听的对象，那么其对象的属性还是可响应的。</li></ol> <p>骚操作：使用 provide / inject 替代 Vuex，就是在这个 app.vue 文件上做文章。我们把 app.vue 理解为一个最外层的根组件，用来存储所有需要的全局数据和状态，甚至是计算属性（computed）、方法（methods）等。因为你的项目中所有的组件（包含路由），它的父组件（或根组件）都是 app.vue，所以我们把整个 app.vue 实例通过 provide 对外提供。如下，我们把整个 app.vue 的实例 this 对外提供，命名为 app（这个名字可以自定义，推荐使用 app，使用这个名字后，子组件不能再使用它作为局部属性）。接下来，任何组件（或路由）只要通过 inject 注入 app.vue 的 app 的话，都可以直接通过 this.app.xxx 来访问 app.vue 的 data、computed、methods 等内容。app.vue 是整个项目第一个被渲染的组件，而且只会渲染一次（即使切换路由，app.vue 也不会被再次渲染），利用这个特性，很适合做一次性全局的状态数据管理，例如，我们将用户的登录信息保存起来。</p> <div class="language-vue line-numbers-mode"><pre class="language-vue"><code><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>template</span><span class="token punctuation">&gt;</span></span>
	<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>div</span><span class="token punctuation">&gt;</span></span>
		<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>router-view</span><span class="token punctuation">&gt;</span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>router-view</span><span class="token punctuation">&gt;</span></span>
	<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>div</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>template</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>script</span><span class="token punctuation">&gt;</span></span><span class="token script"><span class="token language-javascript">
<span class="token keyword">export</span> <span class="token keyword">default</span> <span class="token punctuation">{</span>
	<span class="token function">provide</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
		<span class="token keyword">return</span> <span class="token punctuation">{</span>
			<span class="token literal-property property">app</span><span class="token operator">:</span> <span class="token keyword">this</span><span class="token punctuation">,</span>
		<span class="token punctuation">}</span><span class="token punctuation">;</span>
	<span class="token punctuation">}</span><span class="token punctuation">,</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>
</span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>script</span><span class="token punctuation">&gt;</span></span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br></div></div><h4 id="通用方式"><a href="#通用方式" class="header-anchor">#</a> 通用方式</h4> <ol><li>Vuex/Pinia: 最主要的目的是跨组件通信、全局数据维护、多人协同开发。</li> <li>EventBus: 使用一个 Vue 实例做载体，通过实例上的<code>$on</code>/<code>$emit</code>进行通信。(Vue3 中不能用了，可以用 tiny-emtter 代替)</li> <li>大而全：自定义 findComponent 方法：
<ul><li>由一个组件，向上找到最近的指定组件；</li> <li>由一个组件，向上找到所有的指定组件；</li> <li>由一个组件，向下找到最近的指定组件；</li> <li>由一个组件，向下找到所有指定的组件；</li> <li>由一个组件，找到指定组件的兄弟组件。</li></ul></li></ol> <p>5 个函数的原理，都是通过递归、遍历，找到指定组件的 name 选项匹配的组件实例并返回。</p> <div class="language-js line-numbers-mode"><pre class="language-js"><code><span class="token comment">// 由一个组件，向上找到最近的指定组件</span>
<span class="token keyword">function</span> <span class="token function">findComponentUpward</span><span class="token punctuation">(</span><span class="token parameter">context<span class="token punctuation">,</span> componentName</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
	<span class="token keyword">let</span> parent <span class="token operator">=</span> context<span class="token punctuation">.</span>$parent<span class="token punctuation">;</span>
	<span class="token keyword">let</span> name <span class="token operator">=</span> parent<span class="token punctuation">.</span>$options<span class="token punctuation">.</span>name<span class="token punctuation">;</span>

	<span class="token keyword">while</span> <span class="token punctuation">(</span>parent <span class="token operator">&amp;&amp;</span> <span class="token punctuation">(</span><span class="token operator">!</span>name <span class="token operator">||</span> <span class="token punctuation">[</span>componentName<span class="token punctuation">]</span><span class="token punctuation">.</span><span class="token function">indexOf</span><span class="token punctuation">(</span>name<span class="token punctuation">)</span> <span class="token operator">&lt;</span> <span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
		parent <span class="token operator">=</span> parent<span class="token punctuation">.</span>$parent<span class="token punctuation">;</span>
		<span class="token keyword">if</span> <span class="token punctuation">(</span>parent<span class="token punctuation">)</span> name <span class="token operator">=</span> parent<span class="token punctuation">.</span>$options<span class="token punctuation">.</span>name<span class="token punctuation">;</span>
	<span class="token punctuation">}</span>
	<span class="token keyword">return</span> parent<span class="token punctuation">;</span>
<span class="token punctuation">}</span>
<span class="token keyword">export</span> <span class="token punctuation">{</span> findComponentUpward <span class="token punctuation">}</span><span class="token punctuation">;</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br></div></div><div class="language-js line-numbers-mode"><pre class="language-js"><code><span class="token comment">// 由一个组件，向上找到所有的指定组件</span>
<span class="token keyword">function</span> <span class="token function">findComponentsUpward</span><span class="token punctuation">(</span><span class="token parameter">context<span class="token punctuation">,</span> componentName</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
	<span class="token keyword">let</span> parents <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">;</span>
	<span class="token keyword">const</span> parent <span class="token operator">=</span> context<span class="token punctuation">.</span>$parent<span class="token punctuation">;</span>

	<span class="token keyword">if</span> <span class="token punctuation">(</span>parent<span class="token punctuation">)</span> <span class="token punctuation">{</span>
		<span class="token keyword">if</span> <span class="token punctuation">(</span>parent<span class="token punctuation">.</span>$options<span class="token punctuation">.</span>name <span class="token operator">===</span> componentName<span class="token punctuation">)</span> parents<span class="token punctuation">.</span><span class="token function">push</span><span class="token punctuation">(</span>parent<span class="token punctuation">)</span><span class="token punctuation">;</span>
		<span class="token keyword">return</span> parents<span class="token punctuation">.</span><span class="token function">concat</span><span class="token punctuation">(</span><span class="token function">findComponentsUpward</span><span class="token punctuation">(</span>parent<span class="token punctuation">,</span> componentName<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
	<span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>
		<span class="token keyword">return</span> <span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">;</span>
	<span class="token punctuation">}</span>
<span class="token punctuation">}</span>
<span class="token keyword">export</span> <span class="token punctuation">{</span> findComponentsUpward <span class="token punctuation">}</span><span class="token punctuation">;</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br></div></div><div class="language-js line-numbers-mode"><pre class="language-js"><code><span class="token comment">// 由一个组件，向下找到最近的指定组件</span>
<span class="token keyword">function</span> <span class="token function">findComponentDownward</span><span class="token punctuation">(</span><span class="token parameter">context<span class="token punctuation">,</span> componentName</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
	<span class="token keyword">const</span> childrens <span class="token operator">=</span> context<span class="token punctuation">.</span>$children<span class="token punctuation">;</span>
	<span class="token keyword">let</span> children <span class="token operator">=</span> <span class="token keyword">null</span><span class="token punctuation">;</span>

	<span class="token keyword">if</span> <span class="token punctuation">(</span>childrens<span class="token punctuation">.</span>length<span class="token punctuation">)</span> <span class="token punctuation">{</span>
		<span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">const</span> child <span class="token keyword">of</span> childrens<span class="token punctuation">)</span> <span class="token punctuation">{</span>
			<span class="token keyword">const</span> name <span class="token operator">=</span> child<span class="token punctuation">.</span>$options<span class="token punctuation">.</span>name<span class="token punctuation">;</span>

			<span class="token keyword">if</span> <span class="token punctuation">(</span>name <span class="token operator">===</span> componentName<span class="token punctuation">)</span> <span class="token punctuation">{</span>
				children <span class="token operator">=</span> child<span class="token punctuation">;</span>
				<span class="token keyword">break</span><span class="token punctuation">;</span>
			<span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>
				children <span class="token operator">=</span> <span class="token function">findComponentDownward</span><span class="token punctuation">(</span>child<span class="token punctuation">,</span> componentName<span class="token punctuation">)</span><span class="token punctuation">;</span>
				<span class="token keyword">if</span> <span class="token punctuation">(</span>children<span class="token punctuation">)</span> <span class="token keyword">break</span><span class="token punctuation">;</span>
			<span class="token punctuation">}</span>
		<span class="token punctuation">}</span>
	<span class="token punctuation">}</span>
	<span class="token keyword">return</span> children<span class="token punctuation">;</span>
<span class="token punctuation">}</span>
<span class="token keyword">export</span> <span class="token punctuation">{</span> findComponentDownward <span class="token punctuation">}</span><span class="token punctuation">;</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br></div></div><div class="language-js line-numbers-mode"><pre class="language-js"><code><span class="token comment">// 由一个组件，向下找到所有指定的组件</span>
<span class="token keyword">function</span> <span class="token function">findComponentsDownward</span><span class="token punctuation">(</span><span class="token parameter">context<span class="token punctuation">,</span> componentName</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
	<span class="token keyword">return</span> context<span class="token punctuation">.</span>$children<span class="token punctuation">.</span><span class="token function">reduce</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">components<span class="token punctuation">,</span> child</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
		<span class="token keyword">if</span> <span class="token punctuation">(</span>child<span class="token punctuation">.</span>$options<span class="token punctuation">.</span>name <span class="token operator">===</span> componentName<span class="token punctuation">)</span> components<span class="token punctuation">.</span><span class="token function">push</span><span class="token punctuation">(</span>child<span class="token punctuation">)</span><span class="token punctuation">;</span>
		<span class="token keyword">const</span> foundChilds <span class="token operator">=</span> <span class="token function">findComponentsDownward</span><span class="token punctuation">(</span>child<span class="token punctuation">,</span> componentName<span class="token punctuation">)</span><span class="token punctuation">;</span>
		<span class="token keyword">return</span> components<span class="token punctuation">.</span><span class="token function">concat</span><span class="token punctuation">(</span>foundChilds<span class="token punctuation">)</span><span class="token punctuation">;</span>
	<span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
<span class="token keyword">export</span> <span class="token punctuation">{</span> findComponentsDownward <span class="token punctuation">}</span><span class="token punctuation">;</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br></div></div><div class="language-js line-numbers-mode"><pre class="language-js"><code><span class="token comment">// 由一个组件，找到指定组件的兄弟组件</span>
<span class="token keyword">function</span> <span class="token function">findBrothersComponents</span><span class="token punctuation">(</span><span class="token parameter">context<span class="token punctuation">,</span> componentName<span class="token punctuation">,</span> exceptMe <span class="token operator">=</span> <span class="token boolean">true</span></span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
	<span class="token keyword">let</span> res <span class="token operator">=</span> context<span class="token punctuation">.</span>$parent<span class="token punctuation">.</span>$children<span class="token punctuation">.</span><span class="token function">filter</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">item</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
		<span class="token keyword">return</span> item<span class="token punctuation">.</span>$options<span class="token punctuation">.</span>name <span class="token operator">===</span> componentName<span class="token punctuation">;</span>
	<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
	<span class="token keyword">let</span> index <span class="token operator">=</span> res<span class="token punctuation">.</span><span class="token function">findIndex</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">item</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> item<span class="token punctuation">.</span>_uid <span class="token operator">===</span> context<span class="token punctuation">.</span>_uid<span class="token punctuation">)</span><span class="token punctuation">;</span>
	<span class="token keyword">if</span> <span class="token punctuation">(</span>exceptMe<span class="token punctuation">)</span> res<span class="token punctuation">.</span><span class="token function">splice</span><span class="token punctuation">(</span>index<span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
	<span class="token keyword">return</span> res<span class="token punctuation">;</span>
<span class="token punctuation">}</span>
<span class="token keyword">export</span> <span class="token punctuation">{</span> findBrothersComponents <span class="token punctuation">}</span><span class="token punctuation">;</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br></div></div><h3 id="vue-的构造器-extend-与手动挂载-mount"><a href="#vue-的构造器-extend-与手动挂载-mount" class="header-anchor">#</a> Vue 的构造器——extend 与手动挂载——$mount</h3> <p>Vue.extend 的作用，就是基于 Vue 构造器，创建一个“子类”，它的参数跟 new Vue 的基本一样，但 data 要跟组件一样，是个函数，再配合 $mount ，就可以让组件渲染，并且挂载到任意指定的节点上，比如 body。</p> <div class="language-js line-numbers-mode"><pre class="language-js"><code><span class="token keyword">import</span> Vue <span class="token keyword">from</span> <span class="token string">&quot;vue&quot;</span><span class="token punctuation">;</span>

<span class="token keyword">const</span> AlertComponent <span class="token operator">=</span> Vue<span class="token punctuation">.</span><span class="token function">extend</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
	<span class="token literal-property property">template</span><span class="token operator">:</span> <span class="token string">&quot;&lt;div&gt;{{ message }}&lt;/div&gt;&quot;</span><span class="token punctuation">,</span>
	<span class="token function">data</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
		<span class="token keyword">return</span> <span class="token punctuation">{</span>
			<span class="token literal-property property">message</span><span class="token operator">:</span> <span class="token string">&quot;Hello, Aresn&quot;</span><span class="token punctuation">,</span>
		<span class="token punctuation">}</span><span class="token punctuation">;</span>
	<span class="token punctuation">}</span><span class="token punctuation">,</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token comment">// 这一步，我们创建了一个构造器，这个过程就可以解决异步获取 template 模板的问题，下面要手动渲染组件，并把它挂载到 body 下：</span>
<span class="token keyword">const</span> component <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">AlertComponent</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">$mount</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token comment">// 这一步，我们调用了 $mount 方法对组件进行了手动渲染，但它仅仅是被渲染好了，并没有挂载到节点上，也就显示不了组件。此时的 component 已经是一个标准的 Vue 组件实例，因此它的 $el 属性也可以被访问：当然，除了 body，你还可以挂载到其它节点上。</span>
document<span class="token punctuation">.</span>body<span class="token punctuation">.</span><span class="token function">appendChild</span><span class="token punctuation">(</span>component<span class="token punctuation">.</span>$el<span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment">// $mount 也有一些快捷的挂载方式，以下两种都是可以的：</span>
<span class="token comment">// 在 $mount 里写参数来指定挂载的节点</span>
<span class="token keyword">new</span> <span class="token class-name">AlertComponent</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">$mount</span><span class="token punctuation">(</span><span class="token string">&quot;#app&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token comment">// 不用 $mount，直接在创建实例时指定 el 选项</span>
<span class="token keyword">new</span> <span class="token class-name">AlertComponent</span><span class="token punctuation">(</span><span class="token punctuation">{</span> <span class="token literal-property property">el</span><span class="token operator">:</span> <span class="token string">&quot;#app&quot;</span> <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br></div></div><p>实现同样的效果，除了用 extend 外，也可以直接创建 Vue 实例，并且用一个 Render 函数来渲染一个 .vue 文件：</p> <div class="language-js line-numbers-mode"><pre class="language-js"><code><span class="token keyword">import</span> Vue <span class="token keyword">from</span> <span class="token string">&quot;vue&quot;</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> Notification <span class="token keyword">from</span> <span class="token string">&quot;./notification.vue&quot;</span><span class="token punctuation">;</span>

<span class="token keyword">const</span> props <span class="token operator">=</span> <span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token punctuation">;</span> <span class="token comment">// 这里可以传入一些组件的 props 选项</span>

<span class="token keyword">const</span> Instance <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Vue</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
	<span class="token function">render</span><span class="token punctuation">(</span><span class="token parameter">h</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
		<span class="token keyword">return</span> <span class="token function">h</span><span class="token punctuation">(</span>Notification<span class="token punctuation">,</span> <span class="token punctuation">{</span>
			<span class="token literal-property property">props</span><span class="token operator">:</span> props<span class="token punctuation">,</span>
		<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
	<span class="token punctuation">}</span><span class="token punctuation">,</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token keyword">const</span> component <span class="token operator">=</span> Instance<span class="token punctuation">.</span><span class="token function">$mount</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
document<span class="token punctuation">.</span>body<span class="token punctuation">.</span><span class="token function">appendChild</span><span class="token punctuation">(</span>component<span class="token punctuation">.</span>$el<span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment">// 渲染后，如果想操作 Render 的 Notification 实例，也是很简单的：</span>
<span class="token keyword">const</span> notification <span class="token operator">=</span> Instance<span class="token punctuation">.</span>$children<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">;</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br></div></div><p>需要注意的是，我们是用 <code>$mount</code> 手动渲染的组件，如果要销毁，也要用 <code>$destroy</code> 来手动销毁实例，必要时，也可以用 removeChild 把节点从 DOM 中移除。</p> <h3 id="vue-响应式原理"><a href="#vue-响应式原理" class="header-anchor">#</a> Vue 响应式原理</h3> <p>Vue 采用数据劫持结合发布者-订阅者模式的方式，通过 Object.defineProperty/Proxy 来劫持各个属性的 setter、getter，访问数据时添加订阅者到依赖收集器里，在数据变动时通过依赖收集器通知订阅者，触发订阅者的监听回调，去完成数据的更新和页面的渲染等工作。</p> <ul><li>Observer 负责将数据转换成 getter/setter 形式；</li> <li>Dep 负责管理数据的依赖列表，是一个发布订阅模式，上游对接 Observer，下游对接 Watcher；</li> <li>Watcher 是实际上的数据依赖，负责将数据的变化转发到外界(渲染、回调)；</li></ul> <ol><li>首先 Vue 将 data 初始化为一个 Observer，并通过 Object.defineProperty/Proxy ，循环遍历「对象」的所有属性，为对象中的每个属性设置 getter、setter，以达到拦截访问和设置的目的，如果属性值依旧为对象，则递归为属性值上的每个 key 设置 getter、setter；</li> <li>对于 data 中的每个值，都对应一个独立的依赖收集器 Dep；</li> <li>在 mount 时，实例了一个 Watcher，将收集器的目标指向了当前 Watcher；</li> <li>在 getter 中，即访问数据时（obj.key)进行依赖收集，在依赖收集器 dep 中添加相关的监听 watcher；</li> <li>在 data 值发生变更时，触发 setter，判断是否真的发生了变化，然后会去触发依赖收集器中的所有监听的更新 dep.notify()，来触发 Watcher.update；</li> <li>对「数组」，增强数组的那 7 个可以更改自身的原型方法，然后拦截对这些方法的操作；「'push','pop','shift','unshift','splice','sort','reverse'」：
<ol><li>添加新数据时进行响应式处理，然后由 dep 通知 watcher 去更新；</li> <li>删除数据时，也要由 dep 通知 watcher 去更新</li></ol></li></ol> <ul><li>Object.defineProperty 只对初始对象里的属性有监听作用，而对新增的属性无效。这也是为什么 Vue2 中对象新增属性的修改需要使用 Vue.$set 来设值的原因。</li></ul> <h3 id="object-defineproperty-的不足之处"><a href="#object-defineproperty-的不足之处" class="header-anchor">#</a> Object.defineProperty 的不足之处</h3> <ol><li>对普通对象的监听需要遍历每一个属性</li> <li>无法监听数组的变动</li> <li>无法监听 Map/Set 数据结构的变动</li> <li>无法对对象新增/删除的属性进行监听</li></ol> <h3 id="vue-数据双向绑定原理"><a href="#vue-数据双向绑定原理" class="header-anchor">#</a> Vue 数据双向绑定原理</h3> <p>响应式原理基本就是数据到 DOM 的绑定，双向绑定还需要监听 input 或其他 DOM 的变化，当 DOM 的 value 发生变化之后，触发 change 事件，去修改对应的属性的值，实现了页面驱动数据。</p> <p>Vue 接收一个模板和 data 参数。</p> <ol><li>首先将 data 中的数据进行递归遍历，对每个属性执行 Object.defineProperty，定义 get 和 set 函数。并为每个属性添加一个 dep 数组。当 get 执行时，会为调用的 dom 节点创建一个 watcher 存放在该数组中。当 set 执行时，重新赋值，并调用 dep 数组的 notify 方法，通知所有使用了该属性 watcher，并更新对应 dom 的内容。</li> <li>将模板加载到内存中，递归模板中的元素，检测到元素有 v-开头的命令或者双大括号的指令，就会从 data 中取对应的值去修改模板内容，这个时候就将该 dom 元素添加到了该属性的 dep 数组中。这就实现了数据驱动视图。</li> <li>在处理 v-model 指令的时候，为该 dom 添加 input 事件（或 change），输入时就去修改对应的属性的值，实现了页面驱动数据。</li> <li>将模板与数据进行绑定后，将模板添加到真实 dom 树中。</li></ol> <h3 id="v-model-语法糖模拟"><a href="#v-model-语法糖模拟" class="header-anchor">#</a> v-model 语法糖模拟</h3> <ol><li>原生 dom:<code>&lt;input v-bind:value=&quot;test&quot; v-on:input=&quot;test=$event.target.value&quot;&gt;</code>==<code>&lt;input v-model=&quot;test&quot;&gt;</code></li> <li>自定义组件:
<ul><li>父组件：<code>&lt;son v-model=&quot;num&quot; @input=&quot;val=&gt;num=val&quot; /&gt;</code></li> <li>子组件：<code>$emit('input',888)</code></li></ul></li></ol> <p>input 元素本身有个 input 事件，这是 HTML5 新增加的，类似 onchange ，每当输入框内容发生变化，就会触发 input 事件，把最新的 value 值传给传递给 val ,完成双向数据绑定的效果 。</p> <p>注意: 不是所有能进行双向绑定的元素都有 input 事件。</p> <h3 id="sync-修饰符"><a href="#sync-修饰符" class="header-anchor">#</a> .sync 修饰符</h3> <p>.sync 修饰符可以实现子组件与父组件的双向绑定，并且可以实现子组件同步修改父组件的值。</p> <div class="language-html line-numbers-mode"><pre class="language-html"><code>// 正常父传子：
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>son</span> <span class="token attr-name">:a</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>num<span class="token punctuation">&quot;</span></span> <span class="token attr-name">:b</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>num2<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>son</span><span class="token punctuation">&gt;</span></span>

// 加上sync之后父传子：
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>son</span> <span class="token attr-name">:a.sync</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>num<span class="token punctuation">&quot;</span></span> <span class="token attr-name">:b.sync</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>num2<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>son</span><span class="token punctuation">&gt;</span></span>

// 它等价于
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>son</span>
	<span class="token attr-name">:a</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>num<span class="token punctuation">&quot;</span></span>
	<span class="token attr-name"><span class="token namespace">@update:</span>a</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>val=&gt;num=val<span class="token punctuation">&quot;</span></span>
	<span class="token attr-name">:b</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>num2<span class="token punctuation">&quot;</span></span>
	<span class="token attr-name"><span class="token namespace">@update:</span>b</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>val=&gt;num2=val<span class="token punctuation">&quot;</span></span>
<span class="token punctuation">&gt;</span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>son</span><span class="token punctuation">&gt;</span></span>

//
相当于多了一个事件监听，事件名是update:a，回调函数中，会把接收到的值赋值给属性绑定的数据项中。
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br></div></div><ol><li><p>这里面的传值与接收与正常的父向子传值没有区别，唯一的区别在于往回传值的时候$emit 所调用的事件名必须是 @update:属性名，事件名写错不会报错，但是也不会有任何的改变，这点需要多注意。</p></li> <li><p>除了写法不同，另外需要特别注意的是: v-model 一个组件中只能用一次；.sync 则可以有多个。</p></li> <li><p>.sync 和 v-model 都是语法糖，都可以实现父子组件中的数据双向通信。</p></li></ol> <h2 id="vue-项目本地开发完成后部署到服务器后报-404-是什么原因呢"><a href="#vue-项目本地开发完成后部署到服务器后报-404-是什么原因呢" class="header-anchor">#</a> Vue 项目本地开发完成后部署到服务器后报 404 是什么原因呢？</h2> <h3 id="为什么只有-history-模式下会出现这个问题"><a href="#为什么只有-history-模式下会出现这个问题" class="header-anchor">#</a> 为什么只有 history 模式下会出现这个问题？</h3> <p>可能是 Nginx 配置有问题，比如当我们在地址栏输入 <code>www.website.com</code> 时，这时会打开我们 dist 目录下的 <code>index.html</code> 文件，然后我们在跳转路由进入到 <code>www.website.com/login</code>，此时在 <code>www.website.com/login</code> 页执行刷新操作，<code>nginx location</code> 如果没有相关的配置，那么就会出现 404 的情况。</p> <p>产生问题的<strong>本质是因为我们的路由是通过 JS 来执行视图切换的</strong>。当我们进入到子路由时刷新页面，web 容器没有相对应的页面此时会出现 404。</p> <p>所以我们只需要<strong>配置将任意页面都重定向到 index.html，把路由交由前端处理</strong>。</p> <div class="language-sh line-numbers-mode"><pre class="language-sh"><code>server <span class="token punctuation">{</span>
  listen  <span class="token number">80</span><span class="token punctuation">;</span>
  server_name  www.website.com<span class="token punctuation">;</span>

  location / <span class="token punctuation">{</span>
    index  /data/dist/index.html<span class="token punctuation">;</span>
    try_files <span class="token variable">$uri</span> <span class="token variable">$uri</span>/ /index.html<span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br></div></div><p>另外，为了避免这种情况，应该在 Vue 应用里面覆盖所有的路由情况，然后在给出一个 404 页面。</p> <h3 id="为什么-hash-模式下没有问题"><a href="#为什么-hash-模式下没有问题" class="header-anchor">#</a> 为什么 hash 模式下没有问题？</h3> <p>router hash 模式它的特点在于：hash 虽然出现在 URL 中，但不会被包括在 HTTP 请求中，对服务端完全没有影响，因此改变 hash 不会重新加载页面。</p> <p>hash 模式下，仅 hash 符号之前的内容会被包含在请求中，如 <code>website.com/#/login</code> 只有 <code>website.com</code> 会被包含在请求中 ，因此对于服务端来说，即使没有配置 location，也不会返回 404 错误。</p> <h2 id="vue-中的模板编译原理"><a href="#vue-中的模板编译原理" class="header-anchor">#</a> Vue 中的模板编译原理</h2> <p>这个问题的核心是如何将 template 转换成 render 函数。</p> <ol><li>将 template 模版转换成 ast 语法树 - parserHTML</li> <li>对静态语法做标记（某些节点不改变）</li> <li>重新生成代码 - codeGen，使用 with 语法包裹字符串</li> <li>执行 render 函数，此时初次渲染的话会触发 data 属性的 getter，进行依赖收集，同时生成虚拟 dom 树</li> <li>然后把 vdom 树生成真实 dom 树并 patch 到页面根节点上</li></ol> <h2 id="vue-set-方法是如何实现的"><a href="#vue-set-方法是如何实现的" class="header-anchor">#</a> Vue.$set 方法是如何实现的</h2> <ul><li>vue 给对象和数组本身都增加了 dep 属性</li> <li>当给对象新增不存在的属性的时候，就会触发对象依赖的 watcher 去更新</li> <li>当修改数组索引的时候，就调用数组本身的 splice 方法去更新数组</li></ul> <h2 id="v-model"><a href="#v-model" class="header-anchor">#</a> v-model</h2> <ol><li>v-model 会根据不同的元素来触发不同的事件：</li></ol> <ul><li>text 和 textarea 元素使用 input 事件；</li> <li>checkbox / radio 和 select 使用 change 事件；</li></ul> <h2 id="vue-config-errorhandler"><a href="#vue-config-errorhandler" class="header-anchor">#</a> Vue.config.errorHandler</h2> <h3 id="todo"><a href="#todo" class="header-anchor">#</a> TODO</h3> <h2 id="全局捕获promise错误"><a href="#全局捕获promise错误" class="header-anchor">#</a> 全局捕获Promise错误</h2> <ol><li>babel插件，<a href="https://juejin.cn/post/7155434131831128094" target="_blank" rel="nofollow noopener noreferrer">参考<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></li> <li>addEventListener监听unhandledrejection</li></ol> <div class="language-js line-numbers-mode"><pre class="language-js"><code>window<span class="token punctuation">.</span><span class="token function">addEventListener</span><span class="token punctuation">(</span><span class="token string">'unhandledrejection'</span><span class="token punctuation">,</span> <span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token parameter">event</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">&quot;event&quot;</span><span class="token punctuation">,</span>event<span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token comment">// 处理事件对象</span>
  console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token number">111</span><span class="token punctuation">,</span>event<span class="token punctuation">.</span>reason<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">//获取到catch的err的原因(内容) 与控制台报错一致</span>
  console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token number">222</span><span class="token punctuation">,</span>event<span class="token punctuation">.</span>promise<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">//获取到未处理的promise对象</span>
  event<span class="token punctuation">.</span><span class="token function">preventDefault</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br></div></div><ol start="3"><li>封装接口的时候全部resolve掉，然后处理错误信息</li></ol> <h2 id="关于sourcemap"><a href="#关于sourcemap" class="header-anchor">#</a> 关于sourcemap</h2> <ol><li>开发环境不会混淆和压缩代码，开发时可直接定位位置</li> <li>sourcemap文件上传到异常收集系统，比如sentry，然后把前端捕获的异常信息上报到系统中，系统会用sourcemap文件自动定位到原始代码位置。记住别把sourcemap文件也一起发到部署到服务器中，浏览器可以解析出源代码，相当于没混淆压缩</li></ol></div></section> <footer class="page-edit"><!----> <div class="last-updated"><span class="prefix">上次更新: </span> <span class="time">11/21/2022</span></div></footer> <div class="page-nav"><p class="inner"><span class="prev"><a href="/handbook/React/React-Router.html" class="prev">
            React-Router
          </a></span> <span class="next"><a href="/handbook/Vue/ElementUI.html">
            ElementUI踩坑记录
          </a></span></p></div> <div class="comments-wrapper"><!----></div> <ul class="side-bar sub-sidebar-wrapper" style="width:12rem;" data-v-cb1513f6><li class="level-2" data-v-cb1513f6><a href="/handbook/Vue/SourceCode.html#生命周期" class="sidebar-link reco-side-生命周期" data-v-cb1513f6>生命周期</a></li><li class="level-3" data-v-cb1513f6><a href="/handbook/Vue/SourceCode.html#vue3-0" class="sidebar-link reco-side-vue3-0" data-v-cb1513f6>Vue3.0</a></li><li class="level-3" data-v-cb1513f6><a href="/handbook/Vue/SourceCode.html#vue-中的-render-函数" class="sidebar-link reco-side-vue-中的-render-函数" data-v-cb1513f6>Vue 中的 render 函数</a></li><li class="level-3" data-v-cb1513f6><a href="/handbook/Vue/SourceCode.html#什么时候操作-dom-更合适" class="sidebar-link reco-side-什么时候操作-dom-更合适" data-v-cb1513f6>什么时候操作 dom 更合适</a></li><li class="level-3" data-v-cb1513f6><a href="/handbook/Vue/SourceCode.html#nexttick-的原理" class="sidebar-link reco-side-nexttick-的原理" data-v-cb1513f6>nextTick 的原理</a></li><li class="level-3" data-v-cb1513f6><a href="/handbook/Vue/SourceCode.html#什么时候操作-ajax" class="sidebar-link reco-side-什么时候操作-ajax" data-v-cb1513f6>什么时候操作 ajax</a></li><li class="level-3" data-v-cb1513f6><a href="/handbook/Vue/SourceCode.html#vue2-vue3-react-三者-diff-算法的区别" class="sidebar-link reco-side-vue2-vue3-react-三者-diff-算法的区别" data-v-cb1513f6>Vue2/Vue3/React 三者 diff 算法的区别</a></li><li class="level-3" data-v-cb1513f6><a href="/handbook/Vue/SourceCode.html#vue-react-为何循环时必须使用-key" class="sidebar-link reco-side-vue-react-为何循环时必须使用-key" data-v-cb1513f6>Vue/React 为何循环时必须使用 key</a></li><li class="level-3" data-v-cb1513f6><a href="/handbook/Vue/SourceCode.html#vue-router-的三种模式" class="sidebar-link reco-side-vue-router-的三种模式" data-v-cb1513f6>Vue-Router 的三种模式</a></li><li class="level-3" data-v-cb1513f6><a href="/handbook/Vue/SourceCode.html#组件之间的通信方式" class="sidebar-link reco-side-组件之间的通信方式" data-v-cb1513f6>组件之间的通信方式</a></li><li class="level-3" data-v-cb1513f6><a href="/handbook/Vue/SourceCode.html#vue-的构造器-extend-与手动挂载-mount" class="sidebar-link reco-side-vue-的构造器-extend-与手动挂载-mount" data-v-cb1513f6>Vue 的构造器——extend 与手动挂载——$mount</a></li><li class="level-3" data-v-cb1513f6><a href="/handbook/Vue/SourceCode.html#vue-响应式原理" class="sidebar-link reco-side-vue-响应式原理" data-v-cb1513f6>Vue 响应式原理</a></li><li class="level-3" data-v-cb1513f6><a href="/handbook/Vue/SourceCode.html#object-defineproperty-的不足之处" class="sidebar-link reco-side-object-defineproperty-的不足之处" data-v-cb1513f6>Object.defineProperty 的不足之处</a></li><li class="level-3" data-v-cb1513f6><a href="/handbook/Vue/SourceCode.html#vue-数据双向绑定原理" class="sidebar-link reco-side-vue-数据双向绑定原理" data-v-cb1513f6>Vue 数据双向绑定原理</a></li><li class="level-3" data-v-cb1513f6><a href="/handbook/Vue/SourceCode.html#v-model-语法糖模拟" class="sidebar-link reco-side-v-model-语法糖模拟" data-v-cb1513f6>v-model 语法糖模拟</a></li><li class="level-3" data-v-cb1513f6><a href="/handbook/Vue/SourceCode.html#sync-修饰符" class="sidebar-link reco-side-sync-修饰符" data-v-cb1513f6>.sync 修饰符</a></li><li class="level-2" data-v-cb1513f6><a href="/handbook/Vue/SourceCode.html#vue-项目本地开发完成后部署到服务器后报-404-是什么原因呢" class="sidebar-link reco-side-vue-项目本地开发完成后部署到服务器后报-404-是什么原因呢" data-v-cb1513f6>Vue 项目本地开发完成后部署到服务器后报 404 是什么原因呢？</a></li><li class="level-3" data-v-cb1513f6><a href="/handbook/Vue/SourceCode.html#为什么只有-history-模式下会出现这个问题" class="sidebar-link reco-side-为什么只有-history-模式下会出现这个问题" data-v-cb1513f6>为什么只有 history 模式下会出现这个问题？</a></li><li class="level-3" data-v-cb1513f6><a href="/handbook/Vue/SourceCode.html#为什么-hash-模式下没有问题" class="sidebar-link reco-side-为什么-hash-模式下没有问题" data-v-cb1513f6>为什么 hash 模式下没有问题？</a></li><li class="level-2" data-v-cb1513f6><a href="/handbook/Vue/SourceCode.html#vue-中的模板编译原理" class="sidebar-link reco-side-vue-中的模板编译原理" data-v-cb1513f6>Vue 中的模板编译原理</a></li><li class="level-2" data-v-cb1513f6><a href="/handbook/Vue/SourceCode.html#vue-set-方法是如何实现的" class="sidebar-link reco-side-vue-set-方法是如何实现的" data-v-cb1513f6>Vue.$set 方法是如何实现的</a></li><li class="level-2" data-v-cb1513f6><a href="/handbook/Vue/SourceCode.html#v-model" class="sidebar-link reco-side-v-model" data-v-cb1513f6>v-model</a></li><li class="level-2" data-v-cb1513f6><a href="/handbook/Vue/SourceCode.html#vue-config-errorhandler" class="sidebar-link reco-side-vue-config-errorhandler" data-v-cb1513f6>Vue.config.errorHandler</a></li><li class="level-3" data-v-cb1513f6><a href="/handbook/Vue/SourceCode.html#todo" class="sidebar-link reco-side-todo" data-v-cb1513f6>TODO</a></li><li class="level-2" data-v-cb1513f6><a href="/handbook/Vue/SourceCode.html#全局捕获promise错误" class="sidebar-link reco-side-全局捕获promise错误" data-v-cb1513f6>全局捕获Promise错误</a></li><li class="level-2" data-v-cb1513f6><a href="/handbook/Vue/SourceCode.html#关于sourcemap" class="sidebar-link reco-side-关于sourcemap" data-v-cb1513f6>关于sourcemap</a></li></ul></main> <!----></div></div></div></div><div class="global-ui"><div class="back-to-ceiling" style="right:1rem;bottom:6rem;width:2.5rem;height:2.5rem;border-radius:.25rem;line-height:2.5rem;display:none;" data-v-c6073ba8 data-v-c6073ba8><svg t="1574745035067" viewBox="0 0 1024 1024" version="1.1" xmlns="http://www.w3.org/2000/svg" p-id="5404" class="icon" data-v-c6073ba8><path d="M526.60727968 10.90185116a27.675 27.675 0 0 0-29.21455937 0c-131.36607665 82.28402758-218.69155461 228.01873535-218.69155402 394.07834331a462.20625001 462.20625001 0 0 0 5.36959153 69.94390903c1.00431239 6.55289093-0.34802892 13.13561351-3.76865779 18.80351572-32.63518765 54.11355614-51.75690182 118.55860487-51.7569018 187.94566865a371.06718723 371.06718723 0 0 0 11.50484808 91.98906777c6.53300375 25.50556257 41.68394495 28.14064038 52.69160883 4.22606766 17.37162448-37.73630017 42.14135425-72.50938081 72.80769204-103.21549295 2.18761121 3.04276886 4.15646224 6.24463696 6.40373557 9.22774369a1871.4375 1871.4375 0 0 0 140.04691725 5.34970492 1866.36093723 1866.36093723 0 0 0 140.04691723-5.34970492c2.24727335-2.98310674 4.21612437-6.18497483 6.3937923-9.2178004 30.66633723 30.70611158 55.4360664 65.4791928 72.80769147 103.21549355 11.00766384 23.91457269 46.15860503 21.27949489 52.69160879-4.22606768a371.15156223 371.15156223 0 0 0 11.514792-91.99901164c0-69.36717486-19.13165746-133.82216804-51.75690182-187.92578088-3.42062944-5.66790279-4.76302748-12.26056868-3.76865837-18.80351632a462.20625001 462.20625001 0 0 0 5.36959269-69.943909c-0.00994388-166.08943902-87.32547796-311.81420293-218.6915546-394.09823051zM605.93803103 357.87693858a93.93749974 93.93749974 0 1 1-187.89594924 6.1e-7 93.93749974 93.93749974 0 0 1 187.89594924-6.1e-7z" p-id="5405" data-v-c6073ba8></path><path d="M429.50777625 765.63860547C429.50777625 803.39355007 466.44236686 1000.39046097 512.00932183 1000.39046097c45.56695499 0 82.4922232-197.00623328 82.5015456-234.7518555 0-37.75494459-36.9345906-68.35043303-82.4922232-68.34111062-45.57627738-0.00932239-82.52019037 30.59548842-82.51086798 68.34111062z" p-id="5406" data-v-c6073ba8></path></svg></div><div></div></div></div>
    <script src="/assets/js/app.dc65e826.js" defer></script><script src="/assets/js/4.e4331d91.js" defer></script><script src="/assets/js/3.561be8e5.js" defer></script><script src="/assets/js/2.b25d4684.js" defer></script><script src="/assets/js/1.c7cb60d4.js" defer></script><script src="/assets/js/128.dbe3f14f.js" defer></script>
  </body>
</html>
