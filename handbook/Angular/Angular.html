<!DOCTYPE html>
<html lang="zh-CN">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>Angular学习使用记录 | 木易的OT</title>
    <meta name="generator" content="VuePress 1.9.10">
    <script>
        (function() {
          if (location.href.indexOf('github.io') > -1 || location.href.indexOf('gitee.io') > -1) {
             location.href = 'https://ericyangxd.top'
           }
        })();
        </script><script type='application/ld+json'>
          {
            "@context": "https://schema.org",
            "@type": "Article",
            "headline": "Angular学习使用记录",
            "url": "https://ericyangxd.top/handbook/Angular/Angular.html",
            "image": [
              "https://ericyangxd.top/logo.png"
              ],
            "datePublished": "2022-07-12T00:00:00.000Z",
            "dateModified": "2025-04-13T00:00:00.000Z",
            "author": [{
                "@type": "Person",
                "name": "EricYangXD",
                "url": "https://github.com/EricYangXD/ericyangxd.github.io"
            }]
          }
      </script>
    <meta name="description" content="前端面试,React,Vue,JavaScript,CSS,HTML,HTTP,HTTPS,websocket,UDP,TCP,Webpack,算法,数据结构,LeetCode,小程序,油猴,计算机网络,NodeJs,Vite,Antdesign,EricYangXD,Eric,Chrome,Android,V8,Mac,git,网络安全,开发技巧,路由,router,诗歌,金句,源码,面试,Docker,Shell,clash,Windows">
    <meta name="keywords" content="Angular">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    
    <link rel="preload" href="/assets/css/0.styles.82c89da6.css" as="style"><link rel="preload" href="/assets/js/app.ad4d8bf3.js" as="script"><link rel="preload" href="/assets/js/4.e4a90c70.js" as="script"><link rel="preload" href="/assets/js/3.ad1ccd56.js" as="script"><link rel="preload" href="/assets/js/2.0240bc78.js" as="script"><link rel="preload" href="/assets/js/1.b94e320b.js" as="script"><link rel="preload" href="/assets/js/44.f91643b9.js" as="script"><link rel="prefetch" href="/assets/js/10.d09001be.js"><link rel="prefetch" href="/assets/js/100.bacdc9e0.js"><link rel="prefetch" href="/assets/js/101.3e7c0a76.js"><link rel="prefetch" href="/assets/js/102.6bfe7c21.js"><link rel="prefetch" href="/assets/js/103.3c909d5a.js"><link rel="prefetch" href="/assets/js/104.6e6a1c5d.js"><link rel="prefetch" href="/assets/js/105.424d0a4d.js"><link rel="prefetch" href="/assets/js/106.7751e695.js"><link rel="prefetch" href="/assets/js/107.a9a469f0.js"><link rel="prefetch" href="/assets/js/108.bf409bfd.js"><link rel="prefetch" href="/assets/js/109.9bfdd2d4.js"><link rel="prefetch" href="/assets/js/11.74c854af.js"><link rel="prefetch" href="/assets/js/110.6dc35bc5.js"><link rel="prefetch" href="/assets/js/111.6b2fc27b.js"><link rel="prefetch" href="/assets/js/112.7d73a986.js"><link rel="prefetch" href="/assets/js/113.37ce9e7c.js"><link rel="prefetch" href="/assets/js/114.c5364020.js"><link rel="prefetch" href="/assets/js/115.f93a00d2.js"><link rel="prefetch" href="/assets/js/116.149eead1.js"><link rel="prefetch" href="/assets/js/117.66073247.js"><link rel="prefetch" href="/assets/js/118.63ab35fe.js"><link rel="prefetch" href="/assets/js/119.ba8a9f01.js"><link rel="prefetch" href="/assets/js/120.7ff2b0fe.js"><link rel="prefetch" href="/assets/js/121.7aa3ded2.js"><link rel="prefetch" href="/assets/js/122.4abc9b14.js"><link rel="prefetch" href="/assets/js/123.75128dc1.js"><link rel="prefetch" href="/assets/js/124.ff99bc91.js"><link rel="prefetch" href="/assets/js/125.5e12212f.js"><link rel="prefetch" href="/assets/js/126.7605ea3b.js"><link rel="prefetch" href="/assets/js/127.d2935dee.js"><link rel="prefetch" href="/assets/js/128.67b97037.js"><link rel="prefetch" href="/assets/js/129.ba250a15.js"><link rel="prefetch" href="/assets/js/130.771f815a.js"><link rel="prefetch" href="/assets/js/131.ad769f32.js"><link rel="prefetch" href="/assets/js/132.50416332.js"><link rel="prefetch" href="/assets/js/133.52b05b44.js"><link rel="prefetch" href="/assets/js/134.49fe8c18.js"><link rel="prefetch" href="/assets/js/135.eb55846a.js"><link rel="prefetch" href="/assets/js/136.e06381cf.js"><link rel="prefetch" href="/assets/js/137.bb5bbc62.js"><link rel="prefetch" href="/assets/js/138.f70e22fb.js"><link rel="prefetch" href="/assets/js/139.9ec1ac97.js"><link rel="prefetch" href="/assets/js/14.6852c925.js"><link rel="prefetch" href="/assets/js/140.fb81fadf.js"><link rel="prefetch" href="/assets/js/141.b03017b6.js"><link rel="prefetch" href="/assets/js/142.e00f7107.js"><link rel="prefetch" href="/assets/js/143.4d070fee.js"><link rel="prefetch" href="/assets/js/144.17db7037.js"><link rel="prefetch" href="/assets/js/145.577b18f0.js"><link rel="prefetch" href="/assets/js/146.996ff0cc.js"><link rel="prefetch" href="/assets/js/147.cc683717.js"><link rel="prefetch" href="/assets/js/148.f446bacb.js"><link rel="prefetch" href="/assets/js/15.13cca212.js"><link rel="prefetch" href="/assets/js/16.4899876e.js"><link rel="prefetch" href="/assets/js/17.13bc3b8f.js"><link rel="prefetch" href="/assets/js/18.76e876d7.js"><link rel="prefetch" href="/assets/js/19.b5d33ae1.js"><link rel="prefetch" href="/assets/js/20.29dbec92.js"><link rel="prefetch" href="/assets/js/21.96fceba8.js"><link rel="prefetch" href="/assets/js/22.d2b3e267.js"><link rel="prefetch" href="/assets/js/23.64c64b94.js"><link rel="prefetch" href="/assets/js/24.b558a260.js"><link rel="prefetch" href="/assets/js/25.bb57ebb2.js"><link rel="prefetch" href="/assets/js/26.47cd7229.js"><link rel="prefetch" href="/assets/js/27.8d7938d4.js"><link rel="prefetch" href="/assets/js/28.f894eb36.js"><link rel="prefetch" href="/assets/js/29.525cb35a.js"><link rel="prefetch" href="/assets/js/30.cbeef5b7.js"><link rel="prefetch" href="/assets/js/31.51f58f47.js"><link rel="prefetch" href="/assets/js/32.3f80a1ce.js"><link rel="prefetch" href="/assets/js/33.418aa3e9.js"><link rel="prefetch" href="/assets/js/34.ce30b292.js"><link rel="prefetch" href="/assets/js/35.097a405e.js"><link rel="prefetch" href="/assets/js/36.2bca446e.js"><link rel="prefetch" href="/assets/js/37.03c8c74a.js"><link rel="prefetch" href="/assets/js/38.06c1896e.js"><link rel="prefetch" href="/assets/js/39.631eea29.js"><link rel="prefetch" href="/assets/js/40.aefbd995.js"><link rel="prefetch" href="/assets/js/41.34037413.js"><link rel="prefetch" href="/assets/js/42.dabe6816.js"><link rel="prefetch" href="/assets/js/43.ce7cd2e6.js"><link rel="prefetch" href="/assets/js/45.a7dc3cc9.js"><link rel="prefetch" href="/assets/js/46.1c3faa0c.js"><link rel="prefetch" href="/assets/js/47.d484bee0.js"><link rel="prefetch" href="/assets/js/48.72f5dac3.js"><link rel="prefetch" href="/assets/js/49.94e30036.js"><link rel="prefetch" href="/assets/js/5.73d03319.js"><link rel="prefetch" href="/assets/js/50.7471e53f.js"><link rel="prefetch" href="/assets/js/51.ee8f2cc5.js"><link rel="prefetch" href="/assets/js/52.2d014a7e.js"><link rel="prefetch" href="/assets/js/53.c666929c.js"><link rel="prefetch" href="/assets/js/54.a8079928.js"><link rel="prefetch" href="/assets/js/55.5374dfb1.js"><link rel="prefetch" href="/assets/js/56.3cc2a7bf.js"><link rel="prefetch" href="/assets/js/57.49529e3f.js"><link rel="prefetch" href="/assets/js/58.9c84fe43.js"><link rel="prefetch" href="/assets/js/59.9e99ce46.js"><link rel="prefetch" href="/assets/js/6.ef81b8ef.js"><link rel="prefetch" href="/assets/js/60.9555c624.js"><link rel="prefetch" href="/assets/js/61.f1763db0.js"><link rel="prefetch" href="/assets/js/62.40e2c412.js"><link rel="prefetch" href="/assets/js/63.0ff31674.js"><link rel="prefetch" href="/assets/js/64.04b6a1d8.js"><link rel="prefetch" href="/assets/js/65.fc0d1efe.js"><link rel="prefetch" href="/assets/js/66.7862995d.js"><link rel="prefetch" href="/assets/js/67.6ddfe45a.js"><link rel="prefetch" href="/assets/js/68.665f600a.js"><link rel="prefetch" href="/assets/js/69.7d26e164.js"><link rel="prefetch" href="/assets/js/7.126283bf.js"><link rel="prefetch" href="/assets/js/70.2d0789ea.js"><link rel="prefetch" href="/assets/js/71.015baa55.js"><link rel="prefetch" href="/assets/js/72.7503377f.js"><link rel="prefetch" href="/assets/js/73.902f943c.js"><link rel="prefetch" href="/assets/js/74.6efbdc3d.js"><link rel="prefetch" href="/assets/js/75.61629e32.js"><link rel="prefetch" href="/assets/js/76.bfb124b3.js"><link rel="prefetch" href="/assets/js/77.b571ec74.js"><link rel="prefetch" href="/assets/js/78.c99f4354.js"><link rel="prefetch" href="/assets/js/79.29ef3843.js"><link rel="prefetch" href="/assets/js/8.4a5e8a86.js"><link rel="prefetch" href="/assets/js/80.790703ea.js"><link rel="prefetch" href="/assets/js/81.78d07fd4.js"><link rel="prefetch" href="/assets/js/82.74b6a8e9.js"><link rel="prefetch" href="/assets/js/83.d93c7f53.js"><link rel="prefetch" href="/assets/js/84.aae80bfb.js"><link rel="prefetch" href="/assets/js/85.e5f8e161.js"><link rel="prefetch" href="/assets/js/86.7322403b.js"><link rel="prefetch" href="/assets/js/87.66295445.js"><link rel="prefetch" href="/assets/js/88.cc75f105.js"><link rel="prefetch" href="/assets/js/89.ede4f42c.js"><link rel="prefetch" href="/assets/js/9.ed44c863.js"><link rel="prefetch" href="/assets/js/90.76095265.js"><link rel="prefetch" href="/assets/js/91.40e02762.js"><link rel="prefetch" href="/assets/js/92.8da1202a.js"><link rel="prefetch" href="/assets/js/93.d714d29c.js"><link rel="prefetch" href="/assets/js/94.8721717a.js"><link rel="prefetch" href="/assets/js/95.6e27c10a.js"><link rel="prefetch" href="/assets/js/96.ab284a8b.js"><link rel="prefetch" href="/assets/js/97.be707c71.js"><link rel="prefetch" href="/assets/js/98.c8468fec.js"><link rel="prefetch" href="/assets/js/99.76382db0.js"><link rel="prefetch" href="/assets/js/vendors~docsearch.52b9ad0c.js">
    <link rel="stylesheet" href="/assets/css/0.styles.82c89da6.css">
  </head>
  <body>
    <div id="app" data-server-rendered="true"><div class="theme-container" data-v-130b300a><div data-v-130b300a><div class="password-shadow password-wrapper-out" style="display:none;" data-v-25ba6db2 data-v-130b300a data-v-130b300a><h3 class="title" data-v-25ba6db2 data-v-25ba6db2>木易的OT</h3> <p class="description" data-v-25ba6db2 data-v-25ba6db2>前端面试,React,Vue,JavaScript,CSS,HTML,HTTP,HTTPS,websocket,UDP,TCP,Webpack,算法,数据结构,LeetCode,小程序,油猴,计算机网络,NodeJs,Vite,Antdesign,EricYangXD,Eric,Chrome,Android,V8,Mac,git,网络安全,开发技巧,路由,router,诗歌,金句,源码,面试,Docker,Shell,clash,Windows</p> <label id="box" class="inputBox" data-v-25ba6db2 data-v-25ba6db2><input type="password" value="" data-v-25ba6db2> <span data-v-25ba6db2>Konck! Knock!</span> <button data-v-25ba6db2>OK</button></label> <div class="footer" data-v-25ba6db2 data-v-25ba6db2><span data-v-25ba6db2><i class="iconfont reco-theme" data-v-25ba6db2></i> <a target="blank" href="https://vuepress-theme-reco.recoluan.com" data-v-25ba6db2>vuePress-theme-reco</a></span> <span data-v-25ba6db2><i class="iconfont reco-copyright" data-v-25ba6db2></i> <a data-v-25ba6db2><span data-v-25ba6db2>EricYangXD</span>
            
          <!---->
          2025
        </a></span></div></div> <div class="hide" data-v-130b300a><header class="navbar" data-v-130b300a><div class="sidebar-button"><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" role="img" viewBox="0 0 448 512" class="icon"><path fill="currentColor" d="M436 124H12c-6.627 0-12-5.373-12-12V80c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12z"></path></svg></div> <a href="/" class="home-link router-link-active"><!----> <span class="site-name">木易的OT</span></a> <div class="links"><div class="color-picker"><a class="color-button"><i class="iconfont reco-color"></i></a> <div class="color-picker-menu" style="display:none;"><div class="mode-options"><h4 class="title">Choose mode</h4> <ul class="color-mode-options"><li class="dark">dark</li><li class="auto active">auto</li><li class="light">light</li></ul></div></div></div> <div class="search-box"><input aria-label="Search" autocomplete="off" spellcheck="false" value=""> <!----></div> <nav class="nav-links can-hide"><div class="nav-item"><a href="/" class="nav-link"><i class="undefined"></i>
  首页
</a></div><div class="nav-item"><div class="dropdown-wrapper"><a class="dropdown-title"><span class="title"><i class="undefined"></i>
      木易的OT
    </span> <span class="arrow right"></span></a> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="https://github.com/EricYangXD" target="_blank" rel="noopener noreferrer" class="nav-link external"><i class="undefined"></i>
  Github
  <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></li><li class="dropdown-item"><!----> <a href="https://juejin.cn/user/2295436007445021" target="_blank" rel="noopener noreferrer" class="nav-link external"><i class="undefined"></i>
  掘金
  <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></li></ul></div></div> <!----></nav></div></header> <div class="sidebar-mask" data-v-130b300a></div> <aside class="sidebar" data-v-130b300a><div class="personal-info-wrapper" data-v-39576ba9 data-v-130b300a><!----> <h3 class="name" data-v-39576ba9>
    EricYangXD
  </h3> <div class="num" data-v-39576ba9><div data-v-39576ba9><h3 data-v-39576ba9>110</h3> <h6 data-v-39576ba9>文章</h6></div> <div data-v-39576ba9><h3 data-v-39576ba9>0</h3> <h6 data-v-39576ba9>标签</h6></div></div> <ul class="social-links" data-v-39576ba9></ul> <hr data-v-39576ba9></div> <nav class="nav-links"><div class="nav-item"><a href="/" class="nav-link"><i class="undefined"></i>
  首页
</a></div><div class="nav-item"><div class="dropdown-wrapper"><a class="dropdown-title"><span class="title"><i class="undefined"></i>
      木易的OT
    </span> <span class="arrow right"></span></a> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="https://github.com/EricYangXD" target="_blank" rel="noopener noreferrer" class="nav-link external"><i class="undefined"></i>
  Github
  <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></li><li class="dropdown-item"><!----> <a href="https://juejin.cn/user/2295436007445021" target="_blank" rel="noopener noreferrer" class="nav-link external"><i class="undefined"></i>
  掘金
  <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></li></ul></div></div> <!----></nav> <ul class="sidebar-links"><li><section class="sidebar-group collapsable depth-0"><a href="/" class="sidebar-heading clickable router-link-active"><span>About</span> <span class="arrow right"></span></a> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>Android</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>React</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>Vue</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>LeetCode</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>JavaScript</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>CSS</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>AntDesign</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>小程序</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>Webpack</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>开发技巧</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading open"><span>Angular</span> <span class="arrow down"></span></p> <ul class="sidebar-links sidebar-group-items"><li><a href="/handbook/Angular/Angular.html" aria-current="page" class="active sidebar-link">Angular</a></li><li><a href="/handbook/Angular/AngularDoc.html" class="sidebar-link">Angular 企业实战开发</a></li></ul></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>Backend（Java Based）</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>Docker</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>油猴</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>计算机网络</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>Nodejs</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>Vite</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>Web安全</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>Google Chrome V8</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>Git</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>Mac使用记录</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>文章诗句</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>Office软件</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>股海浮沉</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>打工人须知</span> <span class="arrow right"></span></p> <!----></section></li></ul> </aside> <div class="password-shadow password-wrapper-in" style="display:none;" data-v-25ba6db2 data-v-130b300a><h3 class="title" data-v-25ba6db2 data-v-25ba6db2>Angular学习使用记录</h3> <!----> <label id="box" class="inputBox" data-v-25ba6db2 data-v-25ba6db2><input type="password" value="" data-v-25ba6db2> <span data-v-25ba6db2>Konck! Knock!</span> <button data-v-25ba6db2>OK</button></label> <div class="footer" data-v-25ba6db2 data-v-25ba6db2><span data-v-25ba6db2><i class="iconfont reco-theme" data-v-25ba6db2></i> <a target="blank" href="https://vuepress-theme-reco.recoluan.com" data-v-25ba6db2>vuePress-theme-reco</a></span> <span data-v-25ba6db2><i class="iconfont reco-copyright" data-v-25ba6db2></i> <a data-v-25ba6db2><span data-v-25ba6db2>EricYangXD</span>
            
          <!---->
          2025
        </a></span></div></div> <div data-v-130b300a><main class="page"><section><div class="page-title"><h1 class="title">Angular学习使用记录</h1> <div data-v-f875f3fc><i class="iconfont reco-account" data-v-f875f3fc><span data-v-f875f3fc>EricYangXD</span></i> <i class="iconfont reco-date" data-v-f875f3fc><span data-v-f875f3fc>2022/7/12</span></i> <i class="iconfont reco-eye" data-v-f875f3fc><span id="/handbook/Angular/Angular.html" data-flag-title="Your Article Title" class="leancloud-visitors" data-v-f875f3fc><a class="leancloud-visitors-count" style="font-size:.9rem;font-weight:normal;color:#999;"></a></span></i> <!----></div></div> <div class="theme-reco-content content__default"><h2 id="笔记"><a href="#笔记" class="header-anchor">#</a> 笔记</h2> <h2 id="学习"><a href="#学习" class="header-anchor">#</a> 学习</h2> <h3 id="创建项目"><a href="#创建项目" class="header-anchor">#</a> 创建项目</h3> <ol><li><p>安装脚手架：<code>npm install @angular/cli -g</code></p></li> <li><p>脚手架版本：<code>ng version</code></p></li> <li><p>创建新项目：<code>ng new ng-test --minimal --inlineTemplate --inlineStyle false</code></p> <ul><li>–-skipGit=true 自动初始化 Git 仓库</li> <li>–-minimal=true 不创建 test 测试文件</li> <li>–-skip-install 跳过自动安装依赖</li> <li>–-style=css cssloader 类型</li> <li>-–routing=false 路由</li> <li>–-inlineTemplate 模板是否分开为单独文件</li> <li>-–inlineStyle 样式文件是否单独分开</li> <li>–-prefix 修改 module 名称</li></ul></li> <li><p>启动项目：<code>ng serve --open --hmr</code></p> <ul><li>–open=true 应用构建完成后在浏览器中运行</li> <li>–hmr=true 开启热更新</li> <li>-hmrWarning=false 禁用热更新警告</li> <li>–port 更改应用运行端口</li></ul></li> <li><p>创建共享模块：<code>ng g m module_name</code>，可以指定路径</p></li> <li><p>创建共享组件：<code>ng g c component_name</code>，可以指定路径</p></li> <li><p>创建服务：<code>ng g s service_name</code>，可以指定路径</p></li> <li><p>创建指令：<code>ng g d directive_name</code>，可以指定路径</p></li> <li><p>常用命令总结:</p></li></ol> <table><thead><tr><th>命令</th> <th>描述</th></tr></thead> <tbody><tr><td><code>ng generate &lt;type&gt; [options]</code></td> <td>在项目中构建新代码</td></tr> <tr><td><code>ng g &lt;type 的首字母&gt; [options]</code></td> <td>简写</td></tr></tbody></table> <table><thead><tr><th>支持的类型</th> <th>用法</th></tr></thead> <tbody><tr><td>component</td> <td>ng g c &lt;组件名称&gt;</td></tr> <tr><td>service</td> <td>ng g s &lt;服务名称&gt;</td></tr> <tr><td>module</td> <td>ng g m &lt;模块名称&gt;</td></tr> <tr><td>pipe</td> <td>ng g p &lt;管道名称&gt;</td></tr> <tr><td>directive</td> <td>ng g d &lt;指令名称&gt;</td></tr> <tr><td>interface</td> <td>ng g i &lt;接口名称&gt;</td></tr> <tr><td>enum</td> <td>ng g e &lt;枚举名称&gt;</td></tr> <tr><td>class</td> <td>ng g c &lt;类型名称&gt; （注：该命令功能与 component 相同）</td></tr> <tr><td>guard</td> <td>ng g g &lt;路由守卫名称&gt;</td></tr> <tr><td>interceptor</td> <td>ng g interceptor &lt;拦截器名称&gt; （注：这里 interceptor 无法简写成 i，因为会被识别为接口</td></tr> <tr><td>library</td> <td>ng g library &lt;库名称&gt; （注：这里名称就是单独的库名称，名称前面无法指定路径，且 library 无法简写）</td></tr></tbody></table> <ul><li>构建的组件都会使用自用目录,除非使用 --flat 单独指定</li> <li>构建的模块可使用 --routing 同时创建对应模块的路由</li></ul> <div class="language-bash line-numbers-mode"><pre class="language-bash"><code><span class="token comment"># 创建angular项目</span>
ng new <span class="token operator">&lt;</span>项目名称<span class="token operator">&gt;</span>
<span class="token comment"># 创建带有路由，样式为less，不自动安装依赖的angular项目，后续需要手动npm install安装依赖</span>
ng new <span class="token operator">&lt;</span>项目名称<span class="token operator">&gt;</span> <span class="token parameter variable">--routing</span> <span class="token parameter variable">--style</span><span class="token operator">=</span>less --skip-install
<span class="token comment"># 若创建项目时没有使用--routing，可以使用以下命令添加根路由</span>
ng g m app-routing <span class="token parameter variable">--flat</span> <span class="token parameter variable">--module</span><span class="token operator">=</span>app
<span class="token comment"># 使用--createApplication=false 不会创建根应用，也就是不会有初始化的src目录，包括app.component等文件</span>
ng new <span class="token operator">&lt;</span>项目名称<span class="token operator">&gt;</span> <span class="token parameter variable">--createApplication</span><span class="token operator">=</span>false

<span class="token comment"># 创建angular组件，组件名称前面可添加路径</span>
ng generate component <span class="token operator">&lt;</span>组件名称<span class="token operator">&gt;</span>
<span class="token comment"># 简写</span>
ng g c <span class="token operator">&lt;</span>组件名称<span class="token operator">&gt;</span>

ng g c components/home

<span class="token comment"># 创建angular服务，服务名称前面可添加路径</span>
ng generate <span class="token function">service</span> <span class="token operator">&lt;</span>服务名称<span class="token operator">&gt;</span>
<span class="token comment"># 简写</span>
ng g s <span class="token operator">&lt;</span>服务名称<span class="token operator">&gt;</span>

<span class="token comment"># 创建angular模块，模块名称前面可添加路径</span>
ng generate module <span class="token operator">&lt;</span>模块名称<span class="token operator">&gt;</span>
<span class="token comment"># 简写</span>
ng g m <span class="token operator">&lt;</span>模块名称<span class="token operator">&gt;</span>

<span class="token comment"># 这里使用--routing 可以创建对应模块的路由</span>
ng g m modules/registry <span class="token parameter variable">--routing</span>
<span class="token comment"># 若没有使用--routing，可以使用以下命令添加对应模块的路由路由</span>
ng g m modules/registry/registry-routing <span class="token parameter variable">--flat</span> <span class="token parameter variable">--module</span><span class="token operator">=</span>./registry
ng g c modules/registry
ng g c modules/registry/components/hello

ng g library tables
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br><span class="line-number">28</span><br><span class="line-number">29</span><br><span class="line-number">30</span><br><span class="line-number">31</span><br><span class="line-number">32</span><br><span class="line-number">33</span><br><span class="line-number">34</span><br></div></div><p>library 命令注意事项:</p> <ul><li>使用 library 命令，会创建一个 projects 文件目录，tables 库会出现在该目录中</li> <li>在 angular.json 文件，projects 会对应增加 tables 库的配置项。</li> <li>newProjectRoot 默认值是 projects，也就是命令生成的 library 都会放在这个 projects 目录，我们可以修改这个值，下次使用命令生成 library 就会对应放在我们指定的目录中。</li> <li>projectType 用来区别 application 和 library 类型。</li> <li>在 package.json 配置 scripts，使用 npm run build:tables 命令打包对应的库。</li></ul> <div class="language-ts line-numbers-mode"><pre class="language-ts"><code><span class="token comment">// main.ts</span>
<span class="token comment">// enableProdMode 方法调用后将会开启生产模式</span>
<span class="token keyword">import</span> <span class="token punctuation">{</span> enableProdMode <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">&quot;@angular/core&quot;</span><span class="token punctuation">;</span>
<span class="token comment">// Angular 应用程序的启动在不同的平台上是不一样的</span>
<span class="token comment">// 在浏览器中启动时需要用到 platformBrowserDynamic 方法, 该方法返回平台实例对象</span>
<span class="token keyword">import</span> <span class="token punctuation">{</span> platformBrowserDynamic <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">&quot;@angular/platform-browser-dynamic&quot;</span><span class="token punctuation">;</span>
<span class="token comment">// 引入根模块 用于启动应用程序</span>
<span class="token keyword">import</span> <span class="token punctuation">{</span> AppModule <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">&quot;./app/app.module&quot;</span><span class="token punctuation">;</span>
<span class="token comment">// 引入环境变量对象 { production: false }</span>
<span class="token keyword">import</span> <span class="token punctuation">{</span> environment <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">&quot;./environments/environment&quot;</span><span class="token punctuation">;</span>

<span class="token comment">// 如果当前为生产环境</span>
<span class="token keyword">if</span> <span class="token punctuation">(</span>environment<span class="token punctuation">.</span>production<span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token comment">// 开启生产模式</span>
  <span class="token function">enableProdMode</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
<span class="token comment">// 启动应用程序</span>
<span class="token function">platformBrowserDynamic</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
  <span class="token punctuation">.</span><span class="token function">bootstrapModule</span><span class="token punctuation">(</span>AppModule<span class="token punctuation">)</span>
  <span class="token punctuation">.</span><span class="token function">catch</span><span class="token punctuation">(</span><span class="token punctuation">(</span>err<span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token builtin">console</span><span class="token punctuation">.</span><span class="token function">error</span><span class="token punctuation">(</span>err<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br></div></div><div class="language-ts line-numbers-mode"><pre class="language-ts"><code><span class="token comment">// environment.ts</span>
<span class="token comment">// 在执行 `ng build --prod` 时, environment.prod.ts 文件会替换 environment.ts 文件</span>
<span class="token comment">// 该项配置可以在 angular.json 文件中找到, projects -&gt; angular-test -&gt; architect -&gt; configurations -&gt; production -&gt; fileReplacements</span>

<span class="token keyword">export</span> <span class="token keyword">const</span> environment <span class="token operator">=</span> <span class="token punctuation">{</span>
  production<span class="token operator">:</span> <span class="token boolean">false</span><span class="token punctuation">,</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br></div></div><div class="language-ts line-numbers-mode"><pre class="language-ts"><code><span class="token comment">// environment.prod.ts</span>
<span class="token keyword">export</span> <span class="token keyword">const</span> environment <span class="token operator">=</span> <span class="token punctuation">{</span>
  production<span class="token operator">:</span> <span class="token boolean">true</span><span class="token punctuation">,</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br></div></div><div class="language-ts line-numbers-mode"><pre class="language-ts"><code><span class="token comment">// app.module.ts</span>
<span class="token comment">// BrowserModule 提供了启动和运行浏览器应用所必需的服务</span>
<span class="token comment">// CommonModule 提供各种服务和指令, 例如 ngIf 和 ngFor, 与平台无关</span>
<span class="token comment">// BrowserModule 导入了 CommonModule, 又重新导出了 CommonModule, 使其所有指令都可用于导入 BrowserModule 的任何模块</span>
<span class="token keyword">import</span> <span class="token punctuation">{</span> BrowserModule <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">&quot;@angular/platform-browser&quot;</span><span class="token punctuation">;</span>
<span class="token comment">// NgModule: Angular 模块装饰器</span>
<span class="token keyword">import</span> <span class="token punctuation">{</span> NgModule <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">&quot;@angular/core&quot;</span><span class="token punctuation">;</span>
<span class="token comment">// 根组件</span>
<span class="token keyword">import</span> <span class="token punctuation">{</span> AppComponent <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">&quot;./app.component&quot;</span><span class="token punctuation">;</span>
<span class="token comment">// 调用 NgModule 装饰器, 告诉 Angular 当前类表示的是 Angular 模块</span>
<span class="token decorator"><span class="token at operator">@</span><span class="token function">NgModule</span></span><span class="token punctuation">(</span><span class="token punctuation">{</span>
  <span class="token comment">// 声明当前模块拥有哪些组件</span>
  declarations<span class="token operator">:</span> <span class="token punctuation">[</span>AppComponent<span class="token punctuation">]</span><span class="token punctuation">,</span>
  <span class="token comment">// 声明当前模块依赖了哪些其他模块</span>
  imports<span class="token operator">:</span> <span class="token punctuation">[</span>BrowserModule<span class="token punctuation">]</span><span class="token punctuation">,</span>
  <span class="token comment">// 声明服务的作用域, 数组中接收服务类, 表示该服务只能在当前模块的组件中使用</span>
  providers<span class="token operator">:</span> <span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">,</span>
  <span class="token comment">// 可引导组件, Angular 会在引导过程中把它加载到 DOM 中</span>
  bootstrap<span class="token operator">:</span> <span class="token punctuation">[</span>AppComponent<span class="token punctuation">]</span><span class="token punctuation">,</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>
<span class="token keyword">export</span> <span class="token keyword">class</span> <span class="token class-name">AppModule</span> <span class="token punctuation">{</span><span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br></div></div><div class="language-ts line-numbers-mode"><pre class="language-ts"><code><span class="token comment">// app.component.ts</span>
<span class="token keyword">import</span> <span class="token punctuation">{</span> Component<span class="token punctuation">,</span> ViewEncapsulation <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">&quot;@angular/core&quot;</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token punctuation">{</span> DomSanitizer<span class="token punctuation">,</span> SafeHtml <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">'@angular/platform-browser'</span><span class="token punctuation">;</span>

<span class="token decorator"><span class="token at operator">@</span><span class="token function">Component</span></span><span class="token punctuation">(</span><span class="token punctuation">{</span>
	<span class="token comment">// 指定组件的使用方式, 当前为标记形式</span>
	<span class="token comment">// app-home   =&gt;  &lt;app-home&gt;&lt;/app-home&gt;</span>
	<span class="token comment">// [app-home] =&gt;  &lt;div app-home&gt;&lt;/div&gt;</span>
	<span class="token comment">// .app-home  =&gt;  &lt;div class=&quot;app-home&quot;&gt;&lt;/div&gt;</span>
	selector<span class="token operator">:</span> <span class="token string">&quot;app-root&quot;</span><span class="token punctuation">,</span>
	<span class="token comment">// 关联组件模板文件</span>
	<span class="token comment">// templateUrl:'组件模板文件路径'</span>
	<span class="token comment">// template:`组件模板字符串`</span>
	templateUrl<span class="token operator">:</span> <span class="token string">&quot;./app.component.html&quot;</span><span class="token punctuation">,</span>
	<span class="token comment">// 关联组件样式文件</span>
	<span class="token comment">// styleUrls : ['组件样式文件路径']</span>
	<span class="token comment">// styles : [`组件样式`]</span>
	styleUrls<span class="token operator">:</span> <span class="token punctuation">[</span><span class="token string">&quot;./app.component.css&quot;</span><span class="token punctuation">]</span><span class="token punctuation">,</span>
	<span class="token comment">// 设置封装的样式“能进能出”，其实就是ng不会再给class增加属性选择器，这样使用innerHTML注入的dom就可以使用styles中的样式了</span>
	encapsulation<span class="token operator">:</span> ViewEncapsulation<span class="token punctuation">.</span><span class="token punctuation">,</span><span class="token comment">// default: ViewEncapsulation.Emulate</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>
<span class="token keyword">export</span> <span class="token keyword">class</span> <span class="token class-name">AppComponent</span> <span class="token punctuation">{</span>
	html<span class="token operator">:</span> SafeHtml<span class="token punctuation">;</span>
	<span class="token function">constructor</span><span class="token punctuation">(</span><span class="token keyword">private</span> domSanitizer<span class="token operator">:</span> DomSanitizer<span class="token punctuation">)</span> <span class="token punctuation">{</span>
		<span class="token comment">// 处理style的时候用这个，处理class的时候用`encapsulation: ViewEncapsulation.None`</span>
		<span class="token keyword">this</span><span class="token punctuation">.</span>html <span class="token operator">=</span> <span class="token keyword">this</span><span class="token punctuation">.</span>domSanitizer<span class="token punctuation">.</span><span class="token function">bypassSecurityTrustHtml</span><span class="token punctuation">(</span>
			<span class="token template-string"><span class="token template-punctuation string">`</span><span class="token string">&lt;b style=&quot;color:red;&quot;&gt;red&lt;/b&gt;</span><span class="token template-punctuation string">`</span></span>
		<span class="token punctuation">)</span><span class="token punctuation">;</span>
	<span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br><span class="line-number">28</span><br><span class="line-number">29</span><br><span class="line-number">30</span><br></div></div><div class="language-html line-numbers-mode"><pre class="language-html"><code><span class="token comment">&lt;!-- index.html --&gt;</span>
<span class="token doctype"><span class="token punctuation">&lt;!</span><span class="token doctype-tag">DOCTYPE</span> <span class="token name">html</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>html</span> <span class="token attr-name">lang</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>en<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>
  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>head</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>meta</span> <span class="token attr-name">charset</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>utf-8<span class="token punctuation">&quot;</span></span> <span class="token punctuation">/&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>title</span><span class="token punctuation">&gt;</span></span>AngularTest<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>title</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>base</span> <span class="token attr-name">href</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>/<span class="token punctuation">&quot;</span></span> <span class="token punctuation">/&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>meta</span> <span class="token attr-name">name</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>viewport<span class="token punctuation">&quot;</span></span> <span class="token attr-name">content</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>width=device-width, initial-scale=1<span class="token punctuation">&quot;</span></span> <span class="token punctuation">/&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>link</span> <span class="token attr-name">rel</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>icon<span class="token punctuation">&quot;</span></span> <span class="token attr-name">type</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>image/x-icon<span class="token punctuation">&quot;</span></span> <span class="token attr-name">href</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>favicon.ico<span class="token punctuation">&quot;</span></span> <span class="token punctuation">/&gt;</span></span>
  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>head</span><span class="token punctuation">&gt;</span></span>
  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>body</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>app-root</span><span class="token punctuation">&gt;</span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>app-root</span><span class="token punctuation">&gt;</span></span>
  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>body</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>html</span><span class="token punctuation">&gt;</span></span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br></div></div><h3 id="生命周期"><a href="#生命周期" class="header-anchor">#</a> 生命周期</h3> <ol><li>挂载阶段：<code>constructor -&gt; ngOnInit() -&gt; ngAfterContentInit() -&gt; ngAfterViewInit()</code></li> <li>更新阶段：<code>ngOnChanges() -&gt; ngDoCheck() -&gt; ngAfterContentChecked() -&gt; ngAfterViewChecked()</code>，初始化时先执行一次 ngOnChanges，顺序早于 ngOnInit。不推荐 ngDoCheck，成本太高。</li> <li>卸载阶段：<code>ngOnDestroy()</code></li></ol> <h3 id="依赖注入-di"><a href="#依赖注入-di" class="header-anchor">#</a> 依赖注入 DI</h3> <h3 id="组件通信"><a href="#组件通信" class="header-anchor">#</a> 组件通信</h3> <h4 id="父到子"><a href="#父到子" class="header-anchor">#</a> 父到子</h4> <ol><li>子组件中通过<code>@Input</code>声明要接收的属性名称和初始值，然后在调用子组件时通过<code>[propertyName]=&quot;xxx&quot;</code>的形式通信，xxx 是动态变量时 propertyName 需要<code>[]</code>,否则 propertyName 不需要<code>[]</code>。</li></ol> <h4 id="子到父"><a href="#子到父" class="header-anchor">#</a> 子到父</h4> <ol><li>子组件中通过<code>@Output</code>声明一个<code>new EventEmitter()</code>实例<code>change</code>，这个<code>change</code>就是父组件上要监听的事件，然后声明一个回调函数，例如<code>onChange(){this.change.emit({ name: &quot;张三&quot; });}</code>，当在子组件触发这个 onChange 函数时，会向父组件 emit 一个<code>change</code>事件；</li> <li>父组件上对这个<code>change</code>事件进行监听，并定义一个回调函数来接收参数，例如：<code>(change)=&quot;onChange($event)&quot;</code>，通过<code>$event</code>接收传递的参数。</li></ol> <h3 id="路由传参"><a href="#路由传参" class="header-anchor">#</a> 路由传参</h3> <ol><li>url <code>query传参</code>: <code>&lt;a [queryParams]=&quot;{ name: 'superman', age: 15 }&quot; &gt;product&lt;/a&gt;</code> <ul><li>通过<code>ActivatedRoute</code>实例 route 来接收参数：</li> <li><ol><li><code>this.route.snapshot.queryParams[&quot;name&quot;]</code></li></ol></li> <li><ol start="2"><li><code>this.route.snapshot.queryParamMap.get(&quot;name&quot;)</code></li></ol></li> <li><ol start="3"><li><code>this.route.queryParams.subscribe(...)</code></li></ol></li> <li><ol start="4"><li><code>this.route.queryParamMap.subscribe(...)</code></li></ol></li></ul></li> <li>url <code>path传参</code>: <code>&lt;a [routerLink]=&quot;['/product', product.title]&quot; &gt;product&lt;/a&gt;</code> <ul><li>通过<code>ActivatedRoute</code>实例 route 来接收参数：</li> <li><ol><li><code>this.route.snapshot.params[&quot;title&quot;]</code></li></ol></li> <li><ol start="2"><li><code>this.route.snapshot.paramMap.get(&quot;title&quot;)</code></li></ol></li> <li><ol start="3"><li><code>this.route.params.subscribe(...)</code></li></ol></li> <li><ol start="4"><li><code>this.route.paramMap.subscribe(...)</code></li></ol></li></ul></li> <li>js <code>navigate传参</code>:
<ul><li>通过<code>Router</code>实例 router 来发送参数：</li> <li>query: <code>this.router.navigate(['/product'], {queryParams: {name : 'Eric', age : 22}})</code></li> <li>param: <code>this.router.navigate(['/news', 'japan']);</code></li></ul></li> <li>在路由配置中通过 data 属性传参：
<ul><li>通过<code>ActivatedRoute</code>实例 route 来接收参数：</li> <li><code>this.route.data.subscribe(...)</code></li></ul></li></ol> <div class="language-html line-numbers-mode"><pre class="language-html"><code><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>a</span> <span class="token attr-name">[routerLink]</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>['/product', product.title]<span class="token punctuation">&quot;</span></span> <span class="token attr-name">[queryParams]</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>{ name: 'superman', age: 15 }<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>product<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>a</span><span class="token punctuation">&gt;</span></span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div><div class="language-ts line-numbers-mode"><pre class="language-ts"><code><span class="token keyword">const</span> routes<span class="token operator">:</span> Routes <span class="token operator">=</span> <span class="token punctuation">[</span>
  <span class="token punctuation">{</span>
    path<span class="token operator">:</span> <span class="token string">&quot;home&quot;</span><span class="token punctuation">,</span>
    component<span class="token operator">:</span> HomeComponent<span class="token punctuation">,</span>
    data<span class="token operator">:</span> <span class="token punctuation">{</span>
      testkey<span class="token operator">:</span> <span class="token string">&quot;testkeykkk&quot;</span><span class="token punctuation">,</span>
    <span class="token punctuation">}</span><span class="token punctuation">,</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
  <span class="token comment">// ...</span>
<span class="token punctuation">]</span><span class="token punctuation">;</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br></div></div><div class="language-ts line-numbers-mode"><pre class="language-ts"><code><span class="token keyword">import</span> <span class="token punctuation">{</span> Component<span class="token punctuation">,</span> OnInit <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">&quot;@angular/core&quot;</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token punctuation">{</span> ActivatedRoute <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">&quot;@angular/router&quot;</span><span class="token punctuation">;</span>

<span class="token decorator"><span class="token at operator">@</span><span class="token function">Component</span></span><span class="token punctuation">(</span><span class="token punctuation">{</span>
  selector<span class="token operator">:</span> <span class="token string">&quot;app-product&quot;</span><span class="token punctuation">,</span>
  template<span class="token operator">:</span> <span class="token template-string"><span class="token template-punctuation string">`</span><span class="token string"> &lt;p&gt;product works!&lt;/p&gt; </span><span class="token template-punctuation string">`</span></span><span class="token punctuation">,</span>
  styles<span class="token operator">:</span> <span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">,</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>
<span class="token keyword">export</span> <span class="token keyword">class</span> <span class="token class-name">ProductComponent</span> <span class="token keyword">implements</span> <span class="token class-name">OnInit</span> <span class="token punctuation">{</span>
  <span class="token comment">// 注入依赖</span>
  <span class="token function">constructor</span><span class="token punctuation">(</span><span class="token keyword">private</span> route<span class="token operator">:</span> ActivatedRoute<span class="token punctuation">)</span> <span class="token punctuation">{</span><span class="token punctuation">}</span>
  <span class="token comment">// 生命周期钩子</span>
  <span class="token function">ngOnInit</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token comment">// 路由快照</span>
    <span class="token builtin">console</span><span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>route<span class="token punctuation">.</span>snapshot<span class="token punctuation">.</span>params<span class="token punctuation">[</span><span class="token string">&quot;title&quot;</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">//第一个商品</span>
    <span class="token builtin">console</span><span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>route<span class="token punctuation">.</span>snapshot<span class="token punctuation">.</span>queryParams<span class="token punctuation">[</span><span class="token string">&quot;name&quot;</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">//superman</span>
    <span class="token comment">// 上面两个都只是只读普通对象</span>
    <span class="token comment">//observable对象，非只读，有get/set/getAll 等方法</span>
    <span class="token builtin">console</span><span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>route<span class="token punctuation">.</span>snapshot<span class="token punctuation">.</span>paramMap<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span><span class="token string">&quot;title&quot;</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// 第一个商品</span>
    <span class="token builtin">console</span><span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>route<span class="token punctuation">.</span>snapshot<span class="token punctuation">.</span>queryParamMap<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span><span class="token string">&quot;name&quot;</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">//superman</span>
    <span class="token comment">// 非路由快照的路由信息，他们都是Observable对象</span>
    <span class="token comment">// 与上面一一对应,也是只读的</span>
    <span class="token keyword">this</span><span class="token punctuation">.</span>route<span class="token punctuation">.</span>params<span class="token punctuation">.</span><span class="token function">subscribe</span><span class="token punctuation">(</span><span class="token punctuation">(</span>params<span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
      <span class="token builtin">console</span><span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>params<span class="token punctuation">.</span>title<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">this</span><span class="token punctuation">.</span>route<span class="token punctuation">.</span>queryParams<span class="token punctuation">.</span><span class="token function">subscribe</span><span class="token punctuation">(</span><span class="token punctuation">(</span>params<span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
      <span class="token builtin">console</span><span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>params<span class="token punctuation">.</span>name<span class="token punctuation">,</span> params<span class="token punctuation">.</span>age<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token comment">// 非只读的</span>
    <span class="token keyword">this</span><span class="token punctuation">.</span>route<span class="token punctuation">.</span>paramMap<span class="token punctuation">.</span><span class="token function">subscribe</span><span class="token punctuation">(</span><span class="token punctuation">(</span>params<span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
      <span class="token builtin">console</span><span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>params<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span><span class="token string">&quot;title&quot;</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">this</span><span class="token punctuation">.</span>route<span class="token punctuation">.</span>queryParamMap<span class="token punctuation">.</span><span class="token function">subscribe</span><span class="token punctuation">(</span><span class="token punctuation">(</span>params<span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
      <span class="token builtin">console</span><span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>params<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span><span class="token string">&quot;name&quot;</span><span class="token punctuation">)</span><span class="token punctuation">,</span> params<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span><span class="token string">&quot;age&quot;</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br><span class="line-number">28</span><br><span class="line-number">29</span><br><span class="line-number">30</span><br><span class="line-number">31</span><br><span class="line-number">32</span><br><span class="line-number">33</span><br><span class="line-number">34</span><br><span class="line-number">35</span><br><span class="line-number">36</span><br><span class="line-number">37</span><br></div></div><h2 id="原理"><a href="#原理" class="header-anchor">#</a> 原理</h2> <p>Angular 其中的一个设计目标是使浏览器与 DOM 独立。DOM 是复杂的，因此使组件与它分离，会让我们的应用程序，更容易测试与重构。另外的好处是，由于这种解耦，使得我们的应用能够运行在其它平台 (比如：Node.js、WebWorkers、NativeScript 等)。</p> <p>为了能够支持跨平台，Angular 通过抽象层封装了不同平台的差异。比如定义了抽象类 Renderer、Renderer2 、抽象类 RootRenderer 等。此外还定义了以下引用类型：ElementRef、TemplateRef、ViewRef 、ComponentRef 和 ViewContainerRef 等。</p> <h3 id="平台"><a href="#平台" class="header-anchor">#</a> 平台</h3> <p>平台是应用程序运行的环境。它是一组服务，可以用来访问你的应用程序和 Angular 框架本身的内置功能。由于 Angular 主要是一个 UI 框架，平台提供的最重要的功能之一就是页面渲染。</p> <div class="language-ts line-numbers-mode"><pre class="language-ts"><code><span class="token keyword">import</span> <span class="token punctuation">{</span> platformBrowserDynamic <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">&quot;@angular/platform-browser-dynamic&quot;</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token punctuation">{</span> BrowserModule <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">&quot;@angular/platform-browser&quot;</span><span class="token punctuation">;</span>

<span class="token decorator"><span class="token at operator">@</span><span class="token function">NgModule</span></span><span class="token punctuation">(</span><span class="token punctuation">{</span>
  imports<span class="token operator">:</span> <span class="token punctuation">[</span>BrowserModule<span class="token punctuation">]</span><span class="token punctuation">,</span>
  bootstrap<span class="token operator">:</span> <span class="token punctuation">[</span>AppCmp<span class="token punctuation">]</span><span class="token punctuation">,</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>
<span class="token keyword">class</span> <span class="token class-name">AppModule</span> <span class="token punctuation">{</span><span class="token punctuation">}</span>

<span class="token function">platformBrowserDynamic</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">bootstrapModule</span><span class="token punctuation">(</span>AppModule<span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br></div></div><ol><li>引导过程由两部分组成：创建平台和引导模块。在这个例子中，我们导入 BrowserModule 模块，它是浏览器平台的一部分。应用中只能有一个激活的平台，但是我们可以利用它来引导多个模块，如下所示：</li></ol> <div class="language-ts line-numbers-mode"><pre class="language-ts"><code><span class="token keyword">const</span> platformRef<span class="token operator">:</span> PlatformRef <span class="token operator">=</span> <span class="token function">platformBrowserDynamic</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
platformRef<span class="token punctuation">.</span><span class="token function">bootstrapModule</span><span class="token punctuation">(</span>AppModule1<span class="token punctuation">)</span><span class="token punctuation">;</span>
platformRef<span class="token punctuation">.</span><span class="token function">bootstrapModule</span><span class="token punctuation">(</span>AppModule2<span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br></div></div><ol start="2"><li>由于应用中只能有一个激活的平台，单例的服务必须在该平台中注册。比如，浏览器只有一个地址栏，对应的服务对象就是单例。此外如何让我们自定义的 UI 界面，能够在浏览器中显示出来呢，这就需要使用 Angular 为我们提供的渲染器。</li></ol> <h3 id="renderer-渲染器"><a href="#renderer-渲染器" class="header-anchor">#</a> Renderer 渲染器</h3> <p>浏览器平台下， Renderer 渲染器的相关基础知识:</p> <ol><li>Angular 应用程序启动时会创建 RootView (生产环境下通过调用 createProdRootView() 方法)</li> <li>创建 RootView 的过程中，会创建 RootData 对象，该对象可以通过 ViewData 的 root 属性访问到。基于 RootData 对象，我们可以通过 renderer 访问到默认的渲染器，即 DefaultDomRenderer2 实例，此外也可以通过 rendererFactory 访问到 RendererFactory2 实例。</li> <li>在创建组件视图 (ViewData) 时，会根据 componentRendererType 的属性值，来设置组件关联的 renderer 渲染器。</li> <li>当渲染组件视图的时候，Angular 会利用该组件关联的 renderer 提供的 API，创建该视图中的节点或执行视图的相关操作，比如创建元素 (createElement)、创建文本 (createText)、设置样式 (setStyle) 和 设置事件监听 (listen) 等。</li></ol> <h2 id="使用"><a href="#使用" class="header-anchor">#</a> 使用</h2> <h3 id="显示-html"><a href="#显示-html" class="header-anchor">#</a> 显示 html</h3> <p>通过绑定属性 innerHTML 来显示 html 片段。eg.<code>&lt;div [innerHTML]=&quot;innerHTML&quot;&gt;&lt;/div&gt;</code></p> <h3 id="types-node"><a href="#types-node" class="header-anchor">#</a> @types/node</h3> <p>有时会报错，那么可以在<code>tsconfig.json &gt; compilerOptions</code> 中注掉空<code>types</code>或者向空数组中添加<code>node/browser</code>等。</p> <h3 id="google-fonts"><a href="#google-fonts" class="header-anchor">#</a> google fonts</h3> <ol><li><a href="https://fonts.google.com/" target="_blank" rel="nofollow noopener noreferrer">google fonts<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></li> <li><a href="https://developers.google.com/fonts/docs/material_icons?hl=zh-cn" target="_blank" rel="nofollow noopener noreferrer">google fonts<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></li></ol> <p>先搜索 2，然后可以直接下载 svg，然后放到 assets/fonts 下，然后在 styles.scss 中引入。可以直接使用：</p> <div class="language-html line-numbers-mode"><pre class="language-html"><code><span class="token comment">&lt;!-- 1 --&gt;</span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>img</span> <span class="token attr-name">src</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>./assets/images/progress_activity.svg<span class="token punctuation">&quot;</span></span> <span class="token attr-name">class</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>mat-icon-rtl-mirror icon-loading<span class="token punctuation">&quot;</span></span> <span class="token attr-name">alt</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span><span class="token punctuation">&quot;</span></span> <span class="token punctuation">/&gt;</span></span>
<span class="token comment">&lt;!-- 2 --&gt;</span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>mat-icon</span> <span class="token attr-name">class</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>mat-icon-rtl-mirror<span class="token punctuation">&quot;</span></span> <span class="token attr-name">fontIcon</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>refresh<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>mat-icon</span><span class="token punctuation">&gt;</span></span>
<span class="token comment">&lt;!-- 或 --&gt;</span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>mat-icon</span> <span class="token attr-name">class</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>mat-icon-rtl-mirror<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>refresh<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>mat-icon</span><span class="token punctuation">&gt;</span></span>
<span class="token comment">&lt;!-- 3 和1差不多 --&gt;</span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>svg</span>
  <span class="token attr-name">class</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>mat-icon-rtl-mirror icon-cancel<span class="token punctuation">&quot;</span></span>
  <span class="token attr-name">xmlns</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>http://www.w3.org/2000/svg<span class="token punctuation">&quot;</span></span>
  <span class="token attr-name">height</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>24<span class="token punctuation">&quot;</span></span>
  <span class="token attr-name">viewBox</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>0 -960 960 960<span class="token punctuation">&quot;</span></span>
  <span class="token attr-name">width</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>24<span class="token punctuation">&quot;</span></span>
  <span class="token attr-name">mat-dialog-close</span><span class="token punctuation">&gt;</span></span>
  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>path</span>
    <span class="token attr-name">d</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>m480-438 129 129q9 9 21 9t21-9q9-9 9-21t-9-21L522-480l129-129q9-9 9-21t-9-21q-9-9-21-9t-21 9L480-522 351-651q-9-9-21-9t-21 9q-9 9-9 21t9 21l129 129-129 129q-9 9-9 21t9 21q9 9 21 9t21-9l129-129Zm0 358q-82 0-155-31.5t-127.5-86Q143-252 111.5-325T80-480q0-83 31.5-156t86-127Q252-817 325-848.5T480-880q83 0 156 31.5T763-763q54 54 85.5 127T880-480q0 82-31.5 155T763-197.5q-54 54.5-127 86T480-80Zm0-60q142 0 241-99.5T820-480q0-142-99-241t-241-99q-141 0-240.5 99T140-480q0 141 99.5 240.5T480-140Zm0-340Z<span class="token punctuation">&quot;</span></span> <span class="token punctuation">/&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>svg</span><span class="token punctuation">&gt;</span></span>
<span class="token comment">&lt;!-- 4 目测不行，需要配置 --&gt;</span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>span</span> <span class="token attr-name">class</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>material-symbols-outlined<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span> progress_activity <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>span</span><span class="token punctuation">&gt;</span></span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br></div></div><h2 id="原理-2"><a href="#原理-2" class="header-anchor">#</a> 原理</h2> <h3 id="angular-的-dom-操作原理"><a href="#angular-的-dom-操作原理" class="header-anchor">#</a> Angular 的 DOM 操作原理</h3> <ol><li>变更检测（Change Detection）机制
<ul><li>Zone.js 监控异步操作：Angular 使用 Zone.js 来包装所有异步 API，当异步事件（点击、定时器、AJAX 等）发生时触发变更检测</li> <li>组件树检查：从根组件开始，自上而下检查整个组件树</li> <li>数据绑定更新：比较模板绑定表达式的当前值和上次值，如果不同则更新 DOM</li></ul></li> <li>模板编译过程：Angular 在构建时（AOT）或运行时（JIT）将模板编译为 JavaScript 指令代码
<ul><li>解析模板：将 HTML 模板解析为抽象语法树（AST）</li> <li>生成视图工厂：编译为可执行的视图工厂函数</li> <li>创建视图实例：运行时生成具体的视图结构</li> <li>绑定更新函数：为每个数据绑定生成专用的更新函数</li></ul></li> <li>增量 DOM 技术--使用增量 DOM（Incremental DOM） 而不是虚拟 DOM：
<ul><li>内存中的模板指令：编译后的模板保留如何创建/更新 DOM 的指令</li> <li>就地更新：直接操作真实 DOM，但通过指令系统最小化操作</li> <li>内存效率高：不需要维护完整的虚拟 DOM 树</li></ul></li> <li>更新流程示例：
<ul><li>点击事件发生：Zone.js 捕获事件</li> <li>触发变更检测：Angular 从根组件开始检测</li> <li>检查绑定：发现 count 值已变化</li> <li>执行更新：调用编译阶段生成的专门更新函数，只更新 <code>&lt;span&gt;</code> 的文本节点</li> <li>DOM 更新：直接修改真实 DOM 的文本内容</li></ul></li> <li>Angular DOM 操作的优势
<ul><li>AOT 编译优化：提前编译可以发现模板错误，生成高度优化的 DOM 操作代码，移除了运行时模板解析的开销</li> <li>内存效率高：不需要维护虚拟 DOM 的完整副本，增量 DOM 的内存占用更小</li> <li>可预测的更新：明确的数据流（单向数据绑定），变更检测路径清晰</li> <li>集成优化：与 Angular 其他特性（如 DI、RxJS）深度集成，自动处理变更检测和 DOM 更新</li></ul></li></ol> <h2 id="技巧"><a href="#技巧" class="header-anchor">#</a> 技巧</h2> <h3 id="卸载-angular-cli"><a href="#卸载-angular-cli" class="header-anchor">#</a> 卸载@angular-cli</h3> <p>依次执行以下命令行：</p> <ol><li><code>npm uninstall -g angular-cli</code></li> <li><code>npm uninstall --save-dev angular-cli</code></li> <li><code>npm uninstall -g @angular/cli</code></li> <li><code>npm cache verify (低版本npm使用 npm cache clean [--force])</code></li> <li>然后执行<code>ng v</code>, 如果提示<code>command not found: ng</code>说明成功卸载，否则看看 nvm 下的各个版本里是否也有安装 cli，依次删除</li> <li><code>npm install -g @angular/cli@7.3.9 (现在推荐使用这个方式安装cli, 而不是npm uninstall -g angular-cli, 如果报错，可以使用cnpm代替npm)</code></li></ol> <h3 id="安装指定版本-angular-cli"><a href="#安装指定版本-angular-cli" class="header-anchor">#</a> 安装指定版本@angular-cli</h3> <ol><li>卸载之前的版本 <code>npm uninstall -g @angular/cli</code></li> <li>清除缓存，确保卸载干净 <code>npm cache verify</code>，在低版本的 nodejs 里面清除缓存使用的命令是<code>npm cache clean</code></li> <li>检查是否卸载干净，输入命令 <code>ng v</code>，若显示&quot;command not found&quot;则卸载干净</li> <li>全局安装指定版本 <code>npm install -g @angular/cli@7.3.9</code></li> <li>检查版本号 <code>ng v</code></li></ol> <h3 id="在-angular-项目中运行-ngcc-ngc"><a href="#在-angular-项目中运行-ngcc-ngc" class="header-anchor">#</a> 在 Angular 项目中运行 ngcc/ngc</h3> <ol><li>Angular 项目的 angular.json 文件里有这么一行：<code>&quot;aot&quot;: true,</code>，意思是使用 Ivy 编译， 即 Angular 下一代编译和渲染管道的代号。 <code>ahead-of-time (AOT) compiler</code></li> <li>从 Angular 的版本 9 开始，这个新的编译器和运行时指令集就代替了老的编译器和运行时（即视图引擎 View Engine）成为了默认值。</li> <li>可以使用通过 View Engine 编译器创建的库来构建 Ivy 应用程序。此兼容性由称为 Angular 兼容性编译器（ ngcc ）的工具提供。CLI 命令在执行 Angular 构建时会根据需要运行 ngcc。</li> <li>如果你是库作者，则应从版本 9 之后继续使用 View Engine 编译器。通过让所有库继续使用 View Engine，你将与使用 Ivy 的默认 v9 应用程序以及已选择的应用程序保持兼容性。</li> <li>ngcc 即我们每次<code>ng serve</code>时看到的 ngcc(worker):...</li> <li>Angular 的 AOT 编译器会在构建阶段，在浏览器下载并运行这些代码之前，把 Angular 的 HTML 和 TypeScript 代码转换成高效的 JavaScript 代码。这是生产环境的最佳编译模式，与即时(JIT)编译相比，它可以减少加载时间并提高性能。</li> <li>通过使用<code>ngc</code>命令行工具编译你的应用，你可以直接引导到模块工厂，所以你不需要在你的 JavaScript 包中包含 Angular 编译器。</li></ol> <h3 id="移除打包时关于文件体积限制的-warning"><a href="#移除打包时关于文件体积限制的-warning" class="header-anchor">#</a> 移除打包时关于文件体积限制的 warning</h3> <p>在 angular.json 文件里<code>architect.build.options.budgets</code>配置，以及在<code>architect.build.configurations</code>中的每个环境中的 budgets 中单独配置，比如：production、styling-mode 等</p> <div class="language-json line-numbers-mode"><pre class="language-json"><code><span class="token punctuation">{</span>
...
    <span class="token property">&quot;budgets&quot;</span><span class="token operator">:</span> <span class="token punctuation">[</span>
      <span class="token punctuation">{</span>
        <span class="token property">&quot;type&quot;</span><span class="token operator">:</span> <span class="token string">&quot;initial&quot;</span><span class="token punctuation">,</span>
        <span class="token property">&quot;maximumWarning&quot;</span><span class="token operator">:</span> <span class="token string">&quot;2mb&quot;</span><span class="token punctuation">,</span>
        <span class="token property">&quot;maximumError&quot;</span><span class="token operator">:</span> <span class="token string">&quot;5mb&quot;</span>
      <span class="token punctuation">}</span><span class="token punctuation">,</span>
      <span class="token punctuation">{</span>
        <span class="token property">&quot;type&quot;</span><span class="token operator">:</span> <span class="token string">&quot;anyComponentStyle&quot;</span><span class="token punctuation">,</span>
        <span class="token property">&quot;maximumWarning&quot;</span><span class="token operator">:</span> <span class="token string">&quot;8kb&quot;</span><span class="token punctuation">,</span>
        <span class="token property">&quot;maximumError&quot;</span><span class="token operator">:</span> <span class="token string">&quot;10kb&quot;</span>
      <span class="token punctuation">}</span>
    <span class="token punctuation">]</span><span class="token punctuation">,</span>
    <span class="token comment">// 根据环境使用不同的参数打不同的包</span>
    <span class="token property">&quot;fileReplacements&quot;</span><span class="token operator">:</span> <span class="token punctuation">[</span>
      <span class="token punctuation">{</span>
        <span class="token property">&quot;replace&quot;</span><span class="token operator">:</span> <span class="token string">&quot;src/environments/environment.ts&quot;</span><span class="token punctuation">,</span>
        <span class="token property">&quot;with&quot;</span><span class="token operator">:</span> <span class="token string">&quot;src/environments/environment.target.ts&quot;</span>
      <span class="token punctuation">}</span>
    <span class="token punctuation">]</span>
...
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br></div></div><h3 id="踩坑系列"><a href="#踩坑系列" class="header-anchor">#</a> 踩坑系列</h3> <h4 id="service-注册和使用"><a href="#service-注册和使用" class="header-anchor">#</a> service 注册和使用</h4> <ol><li>service 可以在根 module 里引入（全局可用），也可以在其他 module 中引入（仅这个 module 可用），还能通过在 service 的@Injectable 中声明注入的 module。</li> <li>如果 service 注册在 root 根模块中，那么所有的子模块使用的是同一个 service 实例（单例模式），除非在子注入器中配置了其他的 providers。</li> <li>如果 service 分别注册在不同的组件中，那么他们使用的则是不同的实例。</li> <li>在某个注入器的范围内，服务是单例的。也就是说在指定的注入器中，最多只有某个服务的一个实例。</li> <li>如果一个模块在应用程序启动时就加载（非懒加载），它的@NgModule.providers 具有全应用级作用域！他们也可以用于整个应用的注入中！</li> <li>如果要把服务的范围限制在模块中，那么就需要对该模块进行懒加载。惰性加载的模块拥有自己的注入器，是应用注入器的直属子级，该惰性加载模块的 providers 和他导入的模块的 providers 都会添加到他自己的注入器中且不受全局的相同 providers 的影响。当路由在惰性加载的环境中创建组件时，Angular 优先使用惰性加载模块中的服务实例，而不是根注入器中的。</li> <li>建议在 service 本身的@Injectable 装饰器中指定使用它的模块，这样做还能发挥 tree-shaking 优势。</li></ol> <h4 id="ng-deep"><a href="#ng-deep" class="header-anchor">#</a> ::ng-deep</h4> <ol><li><code>::ng-deep</code>功能类似 Vue 中的<code>::v-deep</code>(谁抄的谁咱也不敢说)，比如在父组件对一些子组件样式进行穿透等（父组件的样式会没有 ng 生成的属性选择器）。可能会污染其他子组件的样式。</li> <li>解决样式污染使用<code>:host</code>放在<code>::ng-deep</code>前面，这时样式又会获得属性封装，把属性留在组件树内部。</li> <li>全局样式可以在 <code>styles.scss</code> 中使用<code>:root</code>，但是要注意影响范围。</li></ol> <h4 id="attr-vs-attr"><a href="#attr-vs-attr" class="header-anchor">#</a> [attr] vs attr</h4> <ol><li>attr 接收的是 string，传的变量都会变成 string。</li> <li><code>[attr]</code>接收的是传入的变量。</li></ol> <h4 id="自定义组件中使用-ngmodel"><a href="#自定义组件中使用-ngmodel" class="header-anchor">#</a> 自定义组件中使用 ngModel</h4> <ol><li>自定义组件要实现<code>ControlValueAccessor</code>接口，并在<code>writeValue</code>方法中把父组件传入的值赋给自定义组件中对应的属性。</li></ol> <div class="language-js line-numbers-mode"><pre class="language-js"><code>@<span class="token function">Component</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
  <span class="token literal-property property">selector</span><span class="token operator">:</span> <span class="token string">'product-list'</span><span class="token punctuation">,</span>
  <span class="token literal-property property">templateUrl</span><span class="token operator">:</span> <span class="token string">'./product-list.component.html'</span><span class="token punctuation">,</span>
  <span class="token literal-property property">styleUrls</span><span class="token operator">:</span> <span class="token punctuation">[</span><span class="token string">'./product-list.component.css'</span><span class="token punctuation">]</span><span class="token punctuation">,</span>
  <span class="token literal-property property">providers</span><span class="token operator">:</span> <span class="token punctuation">[</span>
    <span class="token punctuation">{</span>
      <span class="token literal-property property">provide</span><span class="token operator">:</span> <span class="token constant">NG_VALUE_ACCESSOR</span><span class="token punctuation">,</span>
      <span class="token literal-property property">useExisting</span><span class="token operator">:</span> <span class="token function">forwardRef</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> ProductListComponent<span class="token punctuation">)</span><span class="token punctuation">,</span>
      <span class="token literal-property property">multi</span><span class="token operator">:</span> <span class="token boolean">true</span><span class="token punctuation">,</span>
    <span class="token punctuation">}</span><span class="token punctuation">,</span>
  <span class="token punctuation">]</span><span class="token punctuation">,</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>
<span class="token keyword">export</span> <span class="token keyword">class</span> <span class="token class-name">ProductListComponent</span> <span class="token keyword">implements</span> <span class="token class-name">ControlValueAccessor</span> <span class="token punctuation">{</span>
 	<span class="token function">writeValue</span><span class="token punctuation">(</span>n<span class="token operator">:</span> number<span class="token punctuation">)</span><span class="token operator">:</span> <span class="token keyword">void</span> <span class="token punctuation">{</span>
    <span class="token keyword">this</span><span class="token punctuation">.</span>value <span class="token operator">=</span> n<span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
  <span class="token function-variable function">registerOnChange</span><span class="token operator">:</span> <span class="token punctuation">(</span><span class="token function-variable function">fn</span><span class="token operator">:</span> <span class="token punctuation">(</span><span class="token parameter"><span class="token literal-property property">value</span><span class="token operator">:</span> number</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token keyword">void</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token function-variable function">void</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token parameter">fn</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span>
    <span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>onChange <span class="token operator">=</span> fn<span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token function-variable function">registerOnTouched</span><span class="token operator">:</span> <span class="token punctuation">(</span><span class="token function-variable function">fn</span><span class="token operator">:</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token keyword">void</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token function-variable function">void</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token parameter">fn</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>onTouched <span class="token operator">=</span> fn<span class="token punctuation">)</span><span class="token punctuation">;</span>
  setDisabledState<span class="token operator">?</span><span class="token punctuation">(</span>isDisabled<span class="token operator">:</span> boolean<span class="token punctuation">)</span><span class="token operator">:</span> <span class="token keyword">void</span> <span class="token punctuation">{</span><span class="token punctuation">}</span>
  <span class="token function-variable function">onChange</span><span class="token operator">:</span> <span class="token punctuation">(</span><span class="token parameter"><span class="token literal-property property">value</span><span class="token operator">:</span> number</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token function-variable function">void</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token keyword">null</span><span class="token punctuation">;</span>
  <span class="token function-variable function">onTouched</span><span class="token operator">:</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token function-variable function">void</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token keyword">null</span><span class="token punctuation">;</span>

  @<span class="token function">Input</span><span class="token punctuation">(</span><span class="token punctuation">)</span> value<span class="token operator">:</span> number <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span>

<span class="token comment">// ...</span>

<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br><span class="line-number">28</span><br></div></div><ol start="2"><li>自定义组件声明 providers</li> <li>父组件调用子组件</li></ol> <h4 id="select-设置默认值"><a href="#select-设置默认值" class="header-anchor">#</a> select 设置默认值</h4> <ol><li>此时 selectId 函数会直接接收到(默认)值，不需要再通过<code>$event.target.value</code>获取。</li></ol> <div class="language-html line-numbers-mode"><pre class="language-html"><code><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>select</span> <span class="token attr-name">[(ngModel)]</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>defaultId<span class="token punctuation">&quot;</span></span> <span class="token attr-name">(change)</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>selectId($event)<span class="token punctuation">&quot;</span></span> <span class="token attr-name">class</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>custom-select<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>
  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>option</span> <span class="token attr-name">*ngFor</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>let id of ids<span class="token punctuation">&quot;</span></span> <span class="token attr-name">[value]</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>id<span class="token punctuation">&quot;</span></span> <span class="token attr-name">class</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>custom-option<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>{{ id }}<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>option</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>select</span><span class="token punctuation">&gt;</span></span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br></div></div><h4 id="生命周期钩子"><a href="#生命周期钩子" class="header-anchor">#</a> 生命周期钩子</h4> <div class="language-ts line-numbers-mode"><pre class="language-ts"><code>	<span class="token comment">// 执行一次</span>
	<span class="token function">ngOnInit</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
		<span class="token builtin">console</span><span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'ngOnInit'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
	<span class="token punctuation">}</span>
	<span class="token comment">// 执行一次</span>
	<span class="token function">ngAfterContentInit</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token builtin">console</span><span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'ngAfterContentInit'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
	<span class="token comment">// 执行多次</span>
	<span class="token function">ngAfterContentChecked</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token builtin">console</span><span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'ngAfterContentChecked'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
	<span class="token comment">// 执行一次</span>
  <span class="token function">ngAfterViewInit</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token builtin">console</span><span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'ngAfterViewInit'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
  <span class="token comment">// 执行多次</span>
  <span class="token function">ngAfterViewChecked</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token builtin">console</span><span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'ngAfterViewChecked'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
	<span class="token comment">// 执行一次</span>
  <span class="token function">ngOnDestroy</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token builtin">console</span><span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'ngOnDestroy'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
	<span class="token comment">// 执行多次</span>
	<span class="token function">ngDoCheck</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token builtin">console</span><span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'ngDoCheck'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
	<span class="token comment">// 可以执行多次</span>
	<span class="token function">ngOnChanges</span><span class="token punctuation">(</span>sc<span class="token operator">:</span> SimpleChanges<span class="token punctuation">)</span><span class="token operator">:</span> <span class="token keyword">void</span> <span class="token punctuation">{</span>
    <span class="token builtin">console</span><span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>sc<span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br><span class="line-number">28</span><br><span class="line-number">29</span><br><span class="line-number">30</span><br><span class="line-number">31</span><br><span class="line-number">32</span><br></div></div><ol><li><code>checked</code> 结尾的钩子会执行多次，其余都执行一次。</li> <li><code>ngOnChanges</code> 只在输入属性变更时触发，且可以有一个参数，包含变更属性的信息。</li> <li><code>content</code> 钩子是父组件先执行，view 钩子是子组件先执行。</li> <li><code>ngDoCheck</code> 钩子的调用频率最高，不要在当中实现过重的业务。</li> <li>初始化的业务应该放在 <code>ngOnInit</code> 中，而不是构造函数中。</li></ol> <h4 id="变更检查"><a href="#变更检查" class="header-anchor">#</a> 变更检查</h4> <ol><li>单向数据流</li> <li>触发变更检查的事件：<code>Event、XHR、Timer</code> 等</li> <li>解决<code>ExpressionChangedAfterItHasBeenCheckedError</code>报错的两个方法
<ol><li>在父组件的 <code>ngAfterViewInit</code> 钩子中强制 Angular 进行变更检查：<code>this.changeDetectorRef.detectChanges()</code></li> <li>在子组件中使用异步更新的方式修改父组件的内容（这其实是违背了单向数据流的原则，所以有错误并不奇怪）：<code>setTimeout(()=&gt;...,0);</code></li></ol></li></ol> <h4 id="sharedmodule"><a href="#sharedmodule" class="header-anchor">#</a> SharedModule</h4> <ol><li>为那些可能会在应用中到处使用到的组件、指令和管道创建 <code>SharedModule</code>，这种模块应该只包含 <code>declarations</code>，并且应该导出几乎所有 <code>declarations</code> 里面的声明。</li> <li><code>SharedModule</code> 不应该带有 <code>providers</code>。</li></ol> <h4 id="xss"><a href="#xss" class="header-anchor">#</a> XSS</h4> <ol><li>当 iframe 的 src 是变量时，需要用<code>this.domSanitizer.bypassSecurityTrustResourceUrl(url)</code>处理一下，方能正常加载。</li></ol> <h4 id="httpclientmodule"><a href="#httpclientmodule" class="header-anchor">#</a> HttpClientModule</h4> <blockquote><p>Angular HTTP Client 快速入门</p></blockquote> <h5 id="导入新的-http-module"><a href="#导入新的-http-module" class="header-anchor">#</a> 导入新的 HTTP Module</h5> <div class="language-ts line-numbers-mode"><pre class="language-ts"><code><span class="token keyword">import</span> <span class="token punctuation">{</span> HttpClientModule <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">&quot;@angular/common/http&quot;</span><span class="token punctuation">;</span>

<span class="token decorator"><span class="token at operator">@</span><span class="token function">NgModule</span></span><span class="token punctuation">(</span><span class="token punctuation">{</span>
  declarations<span class="token operator">:</span> <span class="token punctuation">[</span>AppComponent<span class="token punctuation">]</span><span class="token punctuation">,</span>
  imports<span class="token operator">:</span> <span class="token punctuation">[</span>BrowserModule<span class="token punctuation">,</span> HttpClientModule<span class="token punctuation">]</span><span class="token punctuation">,</span>
  providers<span class="token operator">:</span> <span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">,</span>
  bootstrap<span class="token operator">:</span> <span class="token punctuation">[</span>AppComponent<span class="token punctuation">]</span><span class="token punctuation">,</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>
<span class="token keyword">export</span> <span class="token keyword">class</span> <span class="token class-name">AppModule</span> <span class="token punctuation">{</span><span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br></div></div><p>使用：<code>http.get(url).subscribe(...);</code></p> <h5 id="发送-get-请求"><a href="#发送-get-请求" class="header-anchor">#</a> 发送 Get 请求</h5> <div class="language-ts line-numbers-mode"><pre class="language-ts"><code><span class="token keyword">import</span> <span class="token punctuation">{</span>HttpClient<span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">&quot;@angular/common/http&quot;</span><span class="token punctuation">;</span>

<span class="token comment">// ...</span>
    data<span class="token operator">:</span> <span class="token builtin">any</span><span class="token punctuation">;</span>
    <span class="token function">constructor</span><span class="token punctuation">(</span><span class="token keyword">private</span> http<span class="token operator">:</span>HttpClient<span class="token punctuation">)</span> <span class="token punctuation">{</span><span class="token punctuation">}</span>

    <span class="token function">ngOnInit</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">this</span><span class="token punctuation">.</span>data <span class="token operator">=</span> <span class="token keyword">this</span><span class="token punctuation">.</span>http
            <span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span><span class="token string">&quot;https://angular-http-guide.firebaseio.com/courses.json&quot;</span><span class="token punctuation">)</span>
            <span class="token punctuation">.</span><span class="token function">map</span><span class="token punctuation">(</span>data <span class="token operator">=&gt;</span> _<span class="token punctuation">.</span><span class="token function">values</span><span class="token punctuation">(</span>data<span class="token punctuation">)</span><span class="token punctuation">)</span>
            <span class="token punctuation">.</span><span class="token function">do</span><span class="token punctuation">(</span><span class="token builtin">console</span><span class="token punctuation">.</span>log<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br></div></div><h5 id="设置查询参数"><a href="#设置查询参数" class="header-anchor">#</a> 设置查询参数</h5> <ol><li>创建 HttpParams 对象</li></ol> <div class="language-ts line-numbers-mode"><pre class="language-ts"><code><span class="token keyword">import</span> <span class="token punctuation">{</span> HttpParams <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">&quot;@angular/common/http&quot;</span><span class="token punctuation">;</span>

<span class="token keyword">const</span> params <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">HttpParams</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">set</span><span class="token punctuation">(</span><span class="token string">&quot;orderBy&quot;</span><span class="token punctuation">,</span> <span class="token string">'&quot;$key&quot;'</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">set</span><span class="token punctuation">(</span><span class="token string">&quot;limitToFirst&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;1&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token keyword">this</span><span class="token punctuation">.</span>courses$ <span class="token operator">=</span> <span class="token keyword">this</span><span class="token punctuation">.</span>http
  <span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span><span class="token string">&quot;/courses.json&quot;</span><span class="token punctuation">,</span> <span class="token punctuation">{</span> params <span class="token punctuation">}</span><span class="token punctuation">)</span>
  <span class="token punctuation">.</span><span class="token function">do</span><span class="token punctuation">(</span><span class="token builtin">console</span><span class="token punctuation">.</span>log<span class="token punctuation">)</span>
  <span class="token punctuation">.</span><span class="token function">map</span><span class="token punctuation">(</span><span class="token punctuation">(</span>data<span class="token punctuation">)</span> <span class="token operator">=&gt;</span> _<span class="token punctuation">.</span><span class="token function">values</span><span class="token punctuation">(</span>data<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br></div></div><p>通过链式语法调用 set() 方法，构建 HttpParams 对象。这是因为 HttpParams 对象是不可变的，通过 set() 方法可以防止该对象被修改。每当调用 set() 方法，将会返回包含新值的 HttpParams 对象，因此如果使用下面的方式，将不能正确的设置参数。</p> <div class="language-ts line-numbers-mode"><pre class="language-ts"><code><span class="token keyword">const</span> params <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">HttpParams</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

params<span class="token punctuation">.</span><span class="token function">set</span><span class="token punctuation">(</span><span class="token string">&quot;orderBy&quot;</span><span class="token punctuation">,</span> <span class="token string">'&quot;$key&quot;'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
params<span class="token punctuation">.</span><span class="token function">set</span><span class="token punctuation">(</span><span class="token string">&quot;limitToFirst&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;1&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br></div></div><ol start="2"><li>使用 fromString 语法: <code>const params = new HttpParams({fromString: 'orderBy=&quot;$key&quot;&amp;limitToFirst=1'});</code></li> <li>使用 request() API:</li></ol> <div class="language-ts line-numbers-mode"><pre class="language-ts"><code><span class="token keyword">const</span> params <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">HttpParams</span><span class="token punctuation">(</span><span class="token punctuation">{</span> fromString<span class="token operator">:</span> <span class="token string">'orderBy=&quot;$key&quot;&amp;limitToFirst=1'</span> <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token keyword">this</span><span class="token punctuation">.</span>courses$ <span class="token operator">=</span> <span class="token keyword">this</span><span class="token punctuation">.</span>http
  <span class="token punctuation">.</span><span class="token function">request</span><span class="token punctuation">(</span><span class="token string">&quot;GET&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;/courses.json&quot;</span><span class="token punctuation">,</span> <span class="token punctuation">{</span>
    responseType<span class="token operator">:</span> <span class="token string">&quot;json&quot;</span><span class="token punctuation">,</span>
    params<span class="token punctuation">,</span>
  <span class="token punctuation">}</span><span class="token punctuation">)</span>
  <span class="token punctuation">.</span><span class="token function">do</span><span class="token punctuation">(</span><span class="token builtin">console</span><span class="token punctuation">.</span>log<span class="token punctuation">)</span>
  <span class="token punctuation">.</span><span class="token function">map</span><span class="token punctuation">(</span><span class="token punctuation">(</span>data<span class="token punctuation">)</span> <span class="token operator">=&gt;</span> _<span class="token punctuation">.</span><span class="token function">values</span><span class="token punctuation">(</span>data<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br></div></div><h5 id="设置-http-headers"><a href="#设置-http-headers" class="header-anchor">#</a> 设置 HTTP Headers</h5> <div class="language-ts line-numbers-mode"><pre class="language-ts"><code><span class="token keyword">const</span> headers <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">HttpHeaders</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">set</span><span class="token punctuation">(</span><span class="token string">&quot;X-CustomHeader&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;custom header value&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token keyword">this</span><span class="token punctuation">.</span>courses$ <span class="token operator">=</span> <span class="token keyword">this</span><span class="token punctuation">.</span>http
  <span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span><span class="token string">&quot;/courses.json&quot;</span><span class="token punctuation">,</span> <span class="token punctuation">{</span> headers <span class="token punctuation">}</span><span class="token punctuation">)</span>
  <span class="token punctuation">.</span><span class="token function">do</span><span class="token punctuation">(</span><span class="token builtin">console</span><span class="token punctuation">.</span>log<span class="token punctuation">)</span>
  <span class="token punctuation">.</span><span class="token function">map</span><span class="token punctuation">(</span><span class="token punctuation">(</span>data<span class="token punctuation">)</span> <span class="token operator">=&gt;</span> _<span class="token punctuation">.</span><span class="token function">values</span><span class="token punctuation">(</span>data<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br></div></div><h5 id="发送-put-请求"><a href="#发送-put-请求" class="header-anchor">#</a> 发送 Put 请求</h5> <div class="language-ts line-numbers-mode"><pre class="language-ts"><code><span class="token function">httpPutExample</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">const</span> headers <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">HttpHeaders</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">set</span><span class="token punctuation">(</span><span class="token string">&quot;Content-Type&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;application/json&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token keyword">this</span><span class="token punctuation">.</span>http<span class="token punctuation">.</span><span class="token function">put</span><span class="token punctuation">(</span><span class="token string">&quot;/courses/-KgVwECOnlc-LHb_B0cQ.json&quot;</span><span class="token punctuation">,</span>
        <span class="token punctuation">{</span>
            <span class="token string-property property">&quot;courseListIcon&quot;</span><span class="token operator">:</span> <span class="token string">&quot;.../main-page-logo-small-hat.png&quot;</span><span class="token punctuation">,</span>
            <span class="token string-property property">&quot;description&quot;</span><span class="token operator">:</span> <span class="token string">&quot;Angular Tutorial For Beginners TEST&quot;</span><span class="token punctuation">,</span>
            <span class="token string-property property">&quot;iconUrl&quot;</span><span class="token operator">:</span> <span class="token string">&quot;.../angular2-for-beginners.jpg&quot;</span><span class="token punctuation">,</span>
            <span class="token string-property property">&quot;longDescription&quot;</span><span class="token operator">:</span> <span class="token string">&quot;...&quot;</span><span class="token punctuation">,</span>
            <span class="token string-property property">&quot;url&quot;</span><span class="token operator">:</span> <span class="token string">&quot;new-value-for-url&quot;</span>
        <span class="token punctuation">}</span><span class="token punctuation">,</span>
        <span class="token punctuation">{</span>headers<span class="token punctuation">}</span><span class="token punctuation">)</span>
        <span class="token punctuation">.</span><span class="token function">subscribe</span><span class="token punctuation">(</span>
            val <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
                <span class="token builtin">console</span><span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">&quot;PUT call successful value returned in body&quot;</span><span class="token punctuation">,</span>
                  val<span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token punctuation">}</span><span class="token punctuation">,</span>
            response <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
                <span class="token builtin">console</span><span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">&quot;PUT call in error&quot;</span><span class="token punctuation">,</span> response<span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token punctuation">}</span><span class="token punctuation">,</span>
            <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
                <span class="token builtin">console</span><span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">&quot;The PUT observable is now completed.&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token punctuation">}</span>
        <span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br></div></div><h5 id="发送-patch-请求"><a href="#发送-patch-请求" class="header-anchor">#</a> 发送 Patch 请求</h5> <div class="language-ts line-numbers-mode"><pre class="language-ts"><code><span class="token function">httpPatchExample</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">this</span><span class="token punctuation">.</span>http<span class="token punctuation">.</span><span class="token function">patch</span><span class="token punctuation">(</span><span class="token string">&quot;/courses/-KgVwECOnlc-LHb_B0cQ.json&quot;</span><span class="token punctuation">,</span>
        <span class="token punctuation">{</span>
            <span class="token string-property property">&quot;description&quot;</span><span class="token operator">:</span> <span class="token string">&quot;Angular Tutorial For Beginners PATCH TEST&quot;</span><span class="token punctuation">,</span>
        <span class="token punctuation">}</span><span class="token punctuation">)</span>
        <span class="token punctuation">.</span><span class="token function">subscribe</span><span class="token punctuation">(</span>
            <span class="token punctuation">(</span>val<span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
                <span class="token builtin">console</span><span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">&quot;PATCH call successful value returned in body&quot;</span><span class="token punctuation">,</span>
                  val<span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token punctuation">}</span><span class="token punctuation">,</span>
            response <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
                <span class="token builtin">console</span><span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">&quot;PATCH call in error&quot;</span><span class="token punctuation">,</span> response<span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token punctuation">}</span><span class="token punctuation">,</span>
            <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
                <span class="token builtin">console</span><span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">&quot;The PATCH observable is now completed.&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br></div></div><h5 id="发送-delete-请求"><a href="#发送-delete-请求" class="header-anchor">#</a> 发送 Delete 请求</h5> <div class="language-ts line-numbers-mode"><pre class="language-ts"><code><span class="token function">httpDeleteExample</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">this</span><span class="token punctuation">.</span>http<span class="token punctuation">.</span><span class="token function">delete</span><span class="token punctuation">(</span><span class="token string">&quot;/courses/-KgVwECOnlc-LHb_B0cQ.json&quot;</span><span class="token punctuation">)</span>
        <span class="token punctuation">.</span><span class="token function">subscribe</span><span class="token punctuation">(</span>
            <span class="token punctuation">(</span>val<span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
                <span class="token builtin">console</span><span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">&quot;DELETE call successful value returned in body&quot;</span><span class="token punctuation">,</span>
                  val<span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token punctuation">}</span><span class="token punctuation">,</span>
            response <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
                <span class="token builtin">console</span><span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">&quot;DELETE call in error&quot;</span><span class="token punctuation">,</span> response<span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token punctuation">}</span><span class="token punctuation">,</span>
            <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
                <span class="token builtin">console</span><span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">&quot;The DELETE observable is now completed.&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br></div></div><h5 id="发送-post-请求"><a href="#发送-post-请求" class="header-anchor">#</a> 发送 Post 请求</h5> <div class="language-ts line-numbers-mode"><pre class="language-ts"><code><span class="token function">httpPostExample</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">this</span><span class="token punctuation">.</span>http<span class="token punctuation">.</span><span class="token function">post</span><span class="token punctuation">(</span><span class="token string">&quot;/courses/-KgVwECOnlc-LHb_B0cQ.json&quot;</span><span class="token punctuation">,</span>
        <span class="token punctuation">{</span>
            <span class="token string-property property">&quot;courseListIcon&quot;</span><span class="token operator">:</span> <span class="token string">&quot;...&quot;</span><span class="token punctuation">,</span>
            <span class="token string-property property">&quot;description&quot;</span><span class="token operator">:</span> <span class="token string">&quot;TEST&quot;</span><span class="token punctuation">,</span>
            <span class="token string-property property">&quot;iconUrl&quot;</span><span class="token operator">:</span> <span class="token string">&quot;..&quot;</span><span class="token punctuation">,</span>
            <span class="token string-property property">&quot;longDescription&quot;</span><span class="token operator">:</span> <span class="token string">&quot;...&quot;</span><span class="token punctuation">,</span>
            <span class="token string-property property">&quot;url&quot;</span><span class="token operator">:</span> <span class="token string">&quot;new-url&quot;</span>
        <span class="token punctuation">}</span><span class="token punctuation">)</span>
        <span class="token punctuation">.</span><span class="token function">subscribe</span><span class="token punctuation">(</span>
            <span class="token punctuation">(</span>val<span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
                <span class="token builtin">console</span><span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">&quot;POST call successful value returned in body&quot;</span><span class="token punctuation">,</span>
                  val<span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token punctuation">}</span><span class="token punctuation">,</span>
            response <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
                <span class="token builtin">console</span><span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">&quot;POST call in error&quot;</span><span class="token punctuation">,</span> response<span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token punctuation">}</span><span class="token punctuation">,</span>
            <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
                <span class="token builtin">console</span><span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">&quot;The POST observable is now completed.&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br></div></div><h5 id="避免重复请求"><a href="#避免重复请求" class="header-anchor">#</a> 避免重复请求</h5> <div class="language-ts line-numbers-mode"><pre class="language-ts"><code><span class="token keyword">import</span> <span class="token punctuation">{</span>shareReplay<span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">'rxjs/operator'</span><span class="token punctuation">;</span>

<span class="token function">duplicateRequestsExample</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">const</span> httpGet$ <span class="token operator">=</span> <span class="token keyword">this</span><span class="token punctuation">.</span>http
        <span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span><span class="token string">&quot;/courses.json&quot;</span><span class="token punctuation">)</span>
        <span class="token punctuation">.</span><span class="token function">map</span><span class="token punctuation">(</span>data <span class="token operator">=&gt;</span> _<span class="token punctuation">.</span><span class="token function">values</span><span class="token punctuation">(</span>data<span class="token punctuation">)</span><span class="token punctuation">)</span>
        <span class="token punctuation">.</span><span class="token function">shareReplay</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// 避免发送冗余的请求</span>

    httpGet$<span class="token punctuation">.</span><span class="token function">subscribe</span><span class="token punctuation">(</span>
        <span class="token punctuation">(</span>val<span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token builtin">console</span><span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">&quot;logging GET value&quot;</span><span class="token punctuation">,</span> val<span class="token punctuation">)</span>
    <span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token keyword">this</span><span class="token punctuation">.</span>courses$ <span class="token operator">=</span> httpGet$<span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br></div></div><h5 id="并行发送多个请求"><a href="#并行发送多个请求" class="header-anchor">#</a> 并行发送多个请求</h5> <ol><li>并行发送 HTTP 请求的一种方法是使用 RxJs 中的 <code>forkjoin/zip/combineLatest/mergeMap</code> 操作符：</li></ol> <div class="language-ts line-numbers-mode"><pre class="language-ts"><code><span class="token keyword">import</span> <span class="token punctuation">{</span> forkJoin<span class="token punctuation">,</span> zip<span class="token punctuation">,</span> combineLatest <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">&quot;rxjx&quot;</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token punctuation">{</span> mergeMap <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">&quot;rxjs/operators&quot;</span><span class="token punctuation">;</span>

<span class="token keyword">const</span> request1$ <span class="token operator">=</span> <span class="token keyword">this</span><span class="token punctuation">.</span>http<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span><span class="token string">&quot;/api/data1&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">const</span> request2$ <span class="token operator">=</span> <span class="token keyword">this</span><span class="token punctuation">.</span>http<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span><span class="token string">&quot;/api/data2&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment">// 1 forkJoin操作符可以同时发出多个HTTP请求，并且只会发出一个完整的数组，其中包含了所有HTTP响应。这在需要同时获取多个数据源的情况下非常有用。</span>
<span class="token function">forkJoin</span><span class="token punctuation">(</span><span class="token punctuation">[</span>request1$<span class="token punctuation">,</span> request2$<span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">subscribe</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">[</span>data1<span class="token punctuation">,</span> data2<span class="token punctuation">]</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
  <span class="token comment">// 处理data1和data2</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment">// 2  zip操作符类似于forkJoin，它也可以同时发送多个HTTP请求，但是它会等待所有请求都完成后才会触发订阅。这意味着，如果其中一个请求失败，整个流可能会失败。</span>
<span class="token function">zip</span><span class="token punctuation">(</span>request1$<span class="token punctuation">,</span> request2$<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">subscribe</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">[</span>data1<span class="token punctuation">,</span> data2<span class="token punctuation">]</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
  <span class="token comment">// 处理data1和data2</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment">// 3  如果您需要根据前一个请求的响应来触发后续请求，可以使用mergeMap（也称为flatMap）操作符。这允许您在前一个请求完成后触发新的请求，从而实现并行请求。</span>
<span class="token keyword">this</span><span class="token punctuation">.</span>http
  <span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span><span class="token string">&quot;/api/data1&quot;</span><span class="token punctuation">)</span>
  <span class="token punctuation">.</span><span class="token function">pipe</span><span class="token punctuation">(</span>
    <span class="token function">mergeMap</span><span class="token punctuation">(</span><span class="token punctuation">(</span>data1<span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
      <span class="token keyword">const</span> request2$ <span class="token operator">=</span> <span class="token keyword">this</span><span class="token punctuation">.</span>http<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span><span class="token template-string"><span class="token template-punctuation string">`</span><span class="token string">/api/data2/</span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>data1<span class="token punctuation">.</span>id<span class="token interpolation-punctuation punctuation">}</span></span><span class="token template-punctuation string">`</span></span><span class="token punctuation">)</span><span class="token punctuation">;</span>
      <span class="token keyword">const</span> request3$ <span class="token operator">=</span> <span class="token keyword">this</span><span class="token punctuation">.</span>http<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span><span class="token string">&quot;/api/data3&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
      <span class="token keyword">return</span> <span class="token function">forkJoin</span><span class="token punctuation">(</span><span class="token punctuation">[</span>request2$<span class="token punctuation">,</span> request3$<span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span>
  <span class="token punctuation">)</span>
  <span class="token punctuation">.</span><span class="token function">subscribe</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">[</span>data2<span class="token punctuation">,</span> data3<span class="token punctuation">]</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
    <span class="token comment">// 处理data2和data3</span>
  <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment">// 4 combineLatest操作符将多个请求的响应组合成一个Observable，每当其中一个请求完成时，它会发出一个新的组合值。这允许您在任何请求完成时获取最新的数据。</span>
<span class="token function">combineLatest</span><span class="token punctuation">(</span><span class="token punctuation">[</span>request1$<span class="token punctuation">,</span> request2$<span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">subscribe</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">[</span>data1<span class="token punctuation">,</span> data2<span class="token punctuation">]</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
  <span class="token comment">// 处理data1和data2</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br><span class="line-number">28</span><br><span class="line-number">29</span><br><span class="line-number">30</span><br><span class="line-number">31</span><br><span class="line-number">32</span><br><span class="line-number">33</span><br><span class="line-number">34</span><br></div></div><ol><li>另一种方法是使用 <code>Promise.all</code>：</li></ol> <div class="language-ts line-numbers-mode"><pre class="language-ts"><code><span class="token comment">// 如果您更喜欢使用Promises而不是Observables，您可以将HTTP请求封装在Promises中，并使用Promise.all来等待它们全部完成。</span>
<span class="token keyword">const</span> promise1 <span class="token operator">=</span> <span class="token keyword">this</span><span class="token punctuation">.</span>http<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span><span class="token string">&quot;/api/data1&quot;</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">toPromise</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">const</span> promise2 <span class="token operator">=</span> <span class="token keyword">this</span><span class="token punctuation">.</span>http<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span><span class="token string">&quot;/api/data2&quot;</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">toPromise</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token builtin">Promise</span><span class="token punctuation">.</span><span class="token function">all</span><span class="token punctuation">(</span><span class="token punctuation">[</span>promise1<span class="token punctuation">,</span> promise2<span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">then</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">[</span>data1<span class="token punctuation">,</span> data2<span class="token punctuation">]</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
  <span class="token comment">// 处理data1和data2</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br></div></div><h5 id="顺序发送-http-请求"><a href="#顺序发送-http-请求" class="header-anchor">#</a> 顺序发送 Http 请求</h5> <div class="language-ts line-numbers-mode"><pre class="language-ts"><code><span class="token function">sequentialRequests</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">const</span> sequence$ <span class="token operator">=</span> <span class="token keyword">this</span><span class="token punctuation">.</span>http<span class="token punctuation">.</span><span class="token generic-function"><span class="token function">get</span><span class="token generic class-name"><span class="token operator">&lt;</span>Course<span class="token operator">&gt;</span></span></span><span class="token punctuation">(</span><span class="token string">'/courses/-KgVwEBq5wbFnjj7O8Fp.json'</span><span class="token punctuation">)</span>
        <span class="token punctuation">.</span><span class="token function">switchMap</span><span class="token punctuation">(</span>course <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
            course<span class="token punctuation">.</span>description<span class="token operator">+=</span> <span class="token string">' - TEST '</span><span class="token punctuation">;</span>
            <span class="token keyword">return</span> <span class="token keyword">this</span><span class="token punctuation">.</span>http<span class="token punctuation">.</span><span class="token function">put</span><span class="token punctuation">(</span><span class="token string">'/courses/-KgVwEBq5wbFnjj7O8Fp.json'</span><span class="token punctuation">,</span> course<span class="token punctuation">)</span>
        <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

    sequence$<span class="token punctuation">.</span><span class="token function">subscribe</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br></div></div><h5 id="获取顺序发送-http-请求的结果"><a href="#获取顺序发送-http-请求的结果" class="header-anchor">#</a> 获取顺序发送 Http 请求的结果</h5> <div class="language-ts line-numbers-mode"><pre class="language-ts"><code><span class="token function">sequentialRequests</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">const</span> sequence$ <span class="token operator">=</span> <span class="token keyword">this</span><span class="token punctuation">.</span>http<span class="token punctuation">.</span><span class="token generic-function"><span class="token function">get</span><span class="token generic class-name"><span class="token operator">&lt;</span>Course<span class="token operator">&gt;</span></span></span><span class="token punctuation">(</span><span class="token string">'/courses/-KgVwEBq5wbFnjj7O8Fp.json'</span><span class="token punctuation">)</span>
        <span class="token punctuation">.</span><span class="token function">switchMap</span><span class="token punctuation">(</span>course <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
            course<span class="token punctuation">.</span>description<span class="token operator">+=</span> <span class="token string">' - TEST '</span><span class="token punctuation">;</span>
            <span class="token keyword">return</span> <span class="token keyword">this</span><span class="token punctuation">.</span>http<span class="token punctuation">.</span><span class="token function">put</span><span class="token punctuation">(</span><span class="token string">'/courses/-KgVwEBq5wbFnjj7O8Fp.json'</span><span class="token punctuation">,</span> course<span class="token punctuation">)</span>
        <span class="token punctuation">}</span><span class="token punctuation">,</span>
            <span class="token punctuation">(</span>firstHTTPResult<span class="token punctuation">,</span> secondHTTPResult<span class="token punctuation">)</span>  <span class="token operator">=&gt;</span> <span class="token punctuation">[</span>firstHTTPResult<span class="token punctuation">,</span> secondHTTPResult<span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

    sequence$<span class="token punctuation">.</span><span class="token function">subscribe</span><span class="token punctuation">(</span>values <span class="token operator">=&gt;</span> <span class="token builtin">console</span><span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">&quot;result observable &quot;</span><span class="token punctuation">,</span> values<span class="token punctuation">)</span> <span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br></div></div><h5 id="请求异常处理"><a href="#请求异常处理" class="header-anchor">#</a> 请求异常处理</h5> <div class="language-ts line-numbers-mode"><pre class="language-ts"><code><span class="token function">throwError</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">this</span><span class="token punctuation">.</span>http
        <span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span><span class="token string">&quot;/api/simulate-error&quot;</span><span class="token punctuation">)</span>
        <span class="token punctuation">.</span><span class="token function">catch</span><span class="token punctuation">(</span> error <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
            <span class="token comment">// here we can show an error message to the user,</span>
            <span class="token comment">// for example via a service</span>
            <span class="token builtin">console</span><span class="token punctuation">.</span><span class="token function">error</span><span class="token punctuation">(</span><span class="token string">&quot;error catched&quot;</span><span class="token punctuation">,</span> error<span class="token punctuation">)</span><span class="token punctuation">;</span>

            <span class="token keyword">return</span> Observable<span class="token punctuation">.</span><span class="token function">of</span><span class="token punctuation">(</span><span class="token punctuation">{</span>description<span class="token operator">:</span> <span class="token string">&quot;Error Value Emitted&quot;</span><span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span><span class="token punctuation">)</span>
        <span class="token punctuation">.</span><span class="token function">subscribe</span><span class="token punctuation">(</span>
            val <span class="token operator">=&gt;</span> <span class="token builtin">console</span><span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'Value emitted successfully'</span><span class="token punctuation">,</span> val<span class="token punctuation">)</span><span class="token punctuation">,</span>
            error <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
                <span class="token builtin">console</span><span class="token punctuation">.</span><span class="token function">error</span><span class="token punctuation">(</span><span class="token string">&quot;This line is never called &quot;</span><span class="token punctuation">,</span>error<span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token punctuation">}</span><span class="token punctuation">,</span>
            <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token builtin">console</span><span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">&quot;HTTP Observable completed...&quot;</span><span class="token punctuation">)</span>
        <span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br></div></div><h4 id="http-拦截器"><a href="#http-拦截器" class="header-anchor">#</a> Http 拦截器</h4> <ol><li>定义拦截器</li></ol> <div class="language-ts line-numbers-mode"><pre class="language-ts"><code><span class="token keyword">import</span> <span class="token punctuation">{</span> Injectable <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">&quot;@angular/core&quot;</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token punctuation">{</span> HttpEvent<span class="token punctuation">,</span> HttpHandler<span class="token punctuation">,</span> HttpInterceptor <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">&quot;@angular/common/http&quot;</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token punctuation">{</span> HttpRequest <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">&quot;@angular/common/http&quot;</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token punctuation">{</span> Observable <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">&quot;rxjs/Observable&quot;</span><span class="token punctuation">;</span>

<span class="token decorator"><span class="token at operator">@</span><span class="token function">Injectable</span></span><span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token keyword">export</span> <span class="token keyword">class</span> <span class="token class-name">AuthInterceptor</span> <span class="token keyword">implements</span> <span class="token class-name">HttpInterceptor</span> <span class="token punctuation">{</span>
  <span class="token function">constructor</span><span class="token punctuation">(</span><span class="token keyword">private</span> authService<span class="token operator">:</span> AuthService<span class="token punctuation">)</span> <span class="token punctuation">{</span><span class="token punctuation">}</span>

  <span class="token function">intercept</span><span class="token punctuation">(</span>req<span class="token operator">:</span> HttpRequest<span class="token operator">&lt;</span><span class="token builtin">any</span><span class="token operator">&gt;</span><span class="token punctuation">,</span> next<span class="token operator">:</span> HttpHandler<span class="token punctuation">)</span><span class="token operator">:</span> Observable<span class="token operator">&lt;</span>HttpEvent<span class="token operator">&lt;</span><span class="token builtin">any</span><span class="token operator">&gt;&gt;</span> <span class="token punctuation">{</span>
    <span class="token keyword">const</span> clonedRequest <span class="token operator">=</span> req<span class="token punctuation">.</span><span class="token function">clone</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
      headers<span class="token operator">:</span> req<span class="token punctuation">.</span>headers<span class="token punctuation">.</span><span class="token function">set</span><span class="token punctuation">(</span><span class="token string">&quot;X-CustomAuthHeader&quot;</span><span class="token punctuation">,</span> authService<span class="token punctuation">.</span><span class="token function">getToken</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token builtin">console</span><span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">&quot;new headers&quot;</span><span class="token punctuation">,</span> clonedRequest<span class="token punctuation">.</span>headers<span class="token punctuation">.</span><span class="token function">keys</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">return</span> next<span class="token punctuation">.</span><span class="token function">handle</span><span class="token punctuation">(</span>clonedRequest<span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br></div></div><h5 id="配置拦截器"><a href="#配置拦截器" class="header-anchor">#</a> 配置拦截器</h5> <div class="language-ts line-numbers-mode"><pre class="language-ts"><code><span class="token decorator"><span class="token at operator">@</span><span class="token function">NgModule</span></span><span class="token punctuation">(</span><span class="token punctuation">{</span>
  declarations<span class="token operator">:</span> <span class="token punctuation">[</span>AppComponent<span class="token punctuation">]</span><span class="token punctuation">,</span>
  imports<span class="token operator">:</span> <span class="token punctuation">[</span>BrowserModule<span class="token punctuation">,</span> HttpClientModule<span class="token punctuation">]</span><span class="token punctuation">,</span>
  providers<span class="token operator">:</span> <span class="token punctuation">[</span><span class="token punctuation">[</span><span class="token punctuation">{</span> provide<span class="token operator">:</span> <span class="token constant">HTTP_INTERCEPTORS</span><span class="token punctuation">,</span> useClass<span class="token operator">:</span> AuthInterceptor<span class="token punctuation">,</span> multi<span class="token operator">:</span> <span class="token boolean">true</span> <span class="token punctuation">}</span><span class="token punctuation">]</span><span class="token punctuation">]</span><span class="token punctuation">,</span>
  bootstrap<span class="token operator">:</span> <span class="token punctuation">[</span>AppComponent<span class="token punctuation">]</span><span class="token punctuation">,</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>
<span class="token keyword">export</span> <span class="token keyword">class</span> <span class="token class-name">AppModule</span> <span class="token punctuation">{</span><span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br></div></div><h5 id="http-进度事件"><a href="#http-进度事件" class="header-anchor">#</a> Http 进度事件</h5> <div class="language-ts line-numbers-mode"><pre class="language-ts"><code><span class="token function">longRequest</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">const</span> request <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">HttpRequest</span><span class="token punctuation">(</span><span class="token string">&quot;POST&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;/api/test-request&quot;</span><span class="token punctuation">,</span> <span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token punctuation">{</span>reportProgress<span class="token operator">:</span> <span class="token boolean">true</span><span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token keyword">this</span><span class="token punctuation">.</span>http<span class="token punctuation">.</span><span class="token function">request</span><span class="token punctuation">(</span>request<span class="token punctuation">)</span>
        <span class="token punctuation">.</span><span class="token function">subscribe</span><span class="token punctuation">(</span>
            event <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
                <span class="token keyword">if</span> <span class="token punctuation">(</span>event<span class="token punctuation">.</span>type <span class="token operator">===</span> HttpEventType<span class="token punctuation">.</span>DownloadProgress<span class="token punctuation">)</span> <span class="token punctuation">{</span>
                    <span class="token builtin">console</span><span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">&quot;Download progress event&quot;</span><span class="token punctuation">,</span> event<span class="token punctuation">)</span><span class="token punctuation">;</span>
                <span class="token punctuation">}</span>
                <span class="token keyword">if</span> <span class="token punctuation">(</span>event<span class="token punctuation">.</span>type <span class="token operator">===</span> HttpEventType<span class="token punctuation">.</span>UploadProgress<span class="token punctuation">)</span> <span class="token punctuation">{</span>
                    <span class="token builtin">console</span><span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">&quot;Upload progress event&quot;</span><span class="token punctuation">,</span> event<span class="token punctuation">)</span><span class="token punctuation">;</span>
                <span class="token punctuation">}</span>
                <span class="token keyword">if</span> <span class="token punctuation">(</span>event<span class="token punctuation">.</span>type <span class="token operator">===</span> HttpEventType<span class="token punctuation">.</span>Response<span class="token punctuation">)</span> <span class="token punctuation">{</span>
                    <span class="token builtin">console</span><span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">&quot;response received...&quot;</span><span class="token punctuation">,</span> event<span class="token punctuation">.</span>body<span class="token punctuation">)</span><span class="token punctuation">;</span>
                <span class="token punctuation">}</span>
            <span class="token punctuation">}</span>
        <span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br></div></div><h3 id="httpclient"><a href="#httpclient" class="header-anchor">#</a> HttpClient</h3> <ol><li>Angular 中的 HttpClient 在请求数据时会自动把 response data 当成 JSON 来解析，这样去请求就可以防止它自动 parse：<code>this.http.get(normalizedUrl, { responseType: 'text' }).then(…)</code></li></ol> <h3 id="使用-store"><a href="#使用-store" class="header-anchor">#</a> 使用 Store</h3> <ol><li>安装：<code>npm install @ngrx/store --save</code></li> <li>创建一个 store，它是一个单例对象，用来存储整个应用的状态。</li> <li>创建一个 reducer 函数，它接收两个参数：当前的状态和一个 action，然后返回一个新的状态。</li> <li>创建一个 action，它是一个简单的对象，包含一个 type 属性和一个 payload 属性。</li> <li>创建一个 selector，它是一个纯函数，用来从 store 中选择部分状态。</li> <li>创建一个 service，它用来发送 action 到 store。</li> <li>创建一个 effects，它用来处理副作用，一般是处理异步操作。</li> <li>在组件中使用 store，通过 selector 选择部分状态，然后在组件中订阅这个状态。</li></ol> <div class="language-ts line-numbers-mode"><pre class="language-ts"><code><span class="token comment">// admin.reducer.ts</span>
<span class="token keyword">import</span> <span class="token punctuation">{</span> createReducer<span class="token punctuation">,</span> on <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">&quot;@ngrx/store&quot;</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token operator">*</span> <span class="token keyword">as</span> AuthActions <span class="token keyword">from</span> <span class="token string">&quot;./admin.actions&quot;</span><span class="token punctuation">;</span>

<span class="token keyword">export</span> <span class="token keyword">interface</span> <span class="token class-name">AppState</span> <span class="token punctuation">{</span>
  data<span class="token operator">:</span> <span class="token builtin">any</span><span class="token punctuation">;</span>
  loading<span class="token operator">:</span> <span class="token builtin">boolean</span><span class="token punctuation">;</span>
  error<span class="token operator">:</span> <span class="token builtin">any</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>

<span class="token keyword">export</span> <span class="token keyword">const</span> initialState<span class="token operator">:</span> AppState <span class="token operator">=</span> <span class="token punctuation">{</span>
  data<span class="token operator">:</span> <span class="token keyword">null</span><span class="token punctuation">,</span>
  loading<span class="token operator">:</span> <span class="token boolean">false</span><span class="token punctuation">,</span>
  error<span class="token operator">:</span> <span class="token keyword">null</span><span class="token punctuation">,</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>

<span class="token keyword">export</span> <span class="token keyword">const</span> adminReducer <span class="token operator">=</span> <span class="token function">createReducer</span><span class="token punctuation">(</span>
  initialState<span class="token punctuation">,</span>
  <span class="token function">on</span><span class="token punctuation">(</span>AuthActions<span class="token punctuation">.</span>login<span class="token punctuation">,</span> <span class="token punctuation">(</span>state<span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">(</span><span class="token punctuation">{</span> <span class="token operator">...</span>state<span class="token punctuation">,</span> loading<span class="token operator">:</span> <span class="token boolean">true</span> <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
  <span class="token function">on</span><span class="token punctuation">(</span>AuthActions<span class="token punctuation">.</span>loginSuccess<span class="token punctuation">,</span> <span class="token punctuation">(</span>state<span class="token punctuation">,</span> <span class="token punctuation">{</span> data <span class="token punctuation">}</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">(</span><span class="token punctuation">{</span> <span class="token operator">...</span>state<span class="token punctuation">,</span> data<span class="token punctuation">,</span> loading<span class="token operator">:</span> <span class="token boolean">false</span> <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
  <span class="token function">on</span><span class="token punctuation">(</span>AuthActions<span class="token punctuation">.</span>loginFailure<span class="token punctuation">,</span> <span class="token punctuation">(</span>state<span class="token punctuation">,</span> <span class="token punctuation">{</span> error <span class="token punctuation">}</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">(</span><span class="token punctuation">{</span> <span class="token operator">...</span>state<span class="token punctuation">,</span> error<span class="token punctuation">,</span> loading<span class="token operator">:</span> <span class="token boolean">false</span> <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
<span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br></div></div><div class="language-ts line-numbers-mode"><pre class="language-ts"><code><span class="token comment">// admin.actions.ts</span>
<span class="token keyword">import</span> <span class="token punctuation">{</span> createAction<span class="token punctuation">,</span> props <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">&quot;@ngrx/store&quot;</span><span class="token punctuation">;</span>
<span class="token keyword">export</span> <span class="token keyword">const</span> login <span class="token operator">=</span> <span class="token function">createAction</span><span class="token punctuation">(</span><span class="token string">&quot;[Login Page] Login&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">export</span> <span class="token keyword">const</span> loginSuccess <span class="token operator">=</span> <span class="token function">createAction</span><span class="token punctuation">(</span><span class="token string">&quot;[Login Page] Login Success&quot;</span><span class="token punctuation">,</span> <span class="token generic-function"><span class="token function">props</span><span class="token generic class-name"><span class="token operator">&lt;</span><span class="token punctuation">{</span> data<span class="token operator">:</span> <span class="token builtin">any</span> <span class="token punctuation">}</span><span class="token operator">&gt;</span></span></span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">export</span> <span class="token keyword">const</span> loginFailure <span class="token operator">=</span> <span class="token function">createAction</span><span class="token punctuation">(</span><span class="token string">&quot;[Login Page] Login Failure&quot;</span><span class="token punctuation">,</span> <span class="token generic-function"><span class="token function">props</span><span class="token generic class-name"><span class="token operator">&lt;</span><span class="token punctuation">{</span> error<span class="token operator">:</span> <span class="token builtin">any</span> <span class="token punctuation">}</span><span class="token operator">&gt;</span></span></span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br></div></div><div class="language-ts line-numbers-mode"><pre class="language-ts"><code><span class="token comment">// admin.selectors.ts</span>
<span class="token keyword">import</span> <span class="token punctuation">{</span> createSelector<span class="token punctuation">,</span> createFeatureSelector <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">&quot;@ngrx/store&quot;</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token punctuation">{</span> AppState <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">&quot;./admin.reducer&quot;</span><span class="token punctuation">;</span>

<span class="token keyword">export</span> <span class="token keyword">const</span> selectAppState <span class="token operator">=</span> <span class="token generic-function"><span class="token function">createFeatureSelector</span><span class="token generic class-name"><span class="token operator">&lt;</span>AppState<span class="token operator">&gt;</span></span></span><span class="token punctuation">(</span><span class="token string">&quot;admin&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">export</span> <span class="token keyword">const</span> selectData <span class="token operator">=</span> <span class="token function">createSelector</span><span class="token punctuation">(</span>selectAppState<span class="token punctuation">,</span> <span class="token punctuation">(</span>state<span class="token operator">:</span> AppState<span class="token punctuation">)</span> <span class="token operator">=&gt;</span> state<span class="token punctuation">.</span>data<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">export</span> <span class="token keyword">const</span> selectLoading <span class="token operator">=</span> <span class="token function">createSelector</span><span class="token punctuation">(</span>selectAppState<span class="token punctuation">,</span> <span class="token punctuation">(</span>state<span class="token operator">:</span> AppState<span class="token punctuation">)</span> <span class="token operator">=&gt;</span> state<span class="token punctuation">.</span>loading<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">export</span> <span class="token keyword">const</span> selectError <span class="token operator">=</span> <span class="token function">createSelector</span><span class="token punctuation">(</span>selectAppState<span class="token punctuation">,</span> <span class="token punctuation">(</span>state<span class="token operator">:</span> AppState<span class="token punctuation">)</span> <span class="token operator">=&gt;</span> state<span class="token punctuation">.</span>error<span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br></div></div><div class="language-ts line-numbers-mode"><pre class="language-ts"><code><span class="token comment">// admin.effects.ts</span>
<span class="token keyword">import</span> <span class="token punctuation">{</span> Injectable <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">&quot;@angular/core&quot;</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token punctuation">{</span> Actions<span class="token punctuation">,</span> createEffect<span class="token punctuation">,</span> ofType<span class="token punctuation">,</span> Effect <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">&quot;@ngrx/effects&quot;</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token punctuation">{</span> map<span class="token punctuation">,</span> switchMap<span class="token punctuation">,</span> catchError<span class="token punctuation">,</span> mergeMap <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">&quot;rxjs/operators&quot;</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token punctuation">{</span> <span class="token keyword">of</span> <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">&quot;rxjs&quot;</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token punctuation">{</span> AuthService <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">&quot;./admin.service&quot;</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token operator">*</span> <span class="token keyword">as</span> AuthActions <span class="token keyword">from</span> <span class="token string">&quot;./admin.actions&quot;</span><span class="token punctuation">;</span>

<span class="token decorator"><span class="token at operator">@</span><span class="token function">Injectable</span></span><span class="token punctuation">(</span><span class="token punctuation">{</span>
  providedIn<span class="token operator">:</span> <span class="token string">&quot;root&quot;</span><span class="token punctuation">,</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>
<span class="token keyword">export</span> <span class="token keyword">class</span> <span class="token class-name">AuthEffects</span> <span class="token punctuation">{</span>
  <span class="token function">constructor</span><span class="token punctuation">(</span><span class="token keyword">private</span> actions$<span class="token operator">:</span> Actions<span class="token punctuation">,</span> <span class="token keyword">private</span> authService<span class="token operator">:</span> AuthService<span class="token punctuation">)</span> <span class="token punctuation">{</span><span class="token punctuation">}</span>

  login$ <span class="token operator">=</span> <span class="token function">createEffect</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span>
    <span class="token keyword">this</span><span class="token punctuation">.</span>actions$<span class="token punctuation">.</span><span class="token function">pipe</span><span class="token punctuation">(</span>
      <span class="token function">ofType</span><span class="token punctuation">(</span>AuthActions<span class="token punctuation">.</span>login<span class="token punctuation">)</span><span class="token punctuation">,</span>
      <span class="token function">switchMap</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span>
        <span class="token keyword">this</span><span class="token punctuation">.</span>authService<span class="token punctuation">.</span><span class="token function">login</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">pipe</span><span class="token punctuation">(</span>
          <span class="token function">map</span><span class="token punctuation">(</span><span class="token punctuation">(</span>data<span class="token punctuation">)</span> <span class="token operator">=&gt;</span> AuthActions<span class="token punctuation">.</span><span class="token function">loginSuccess</span><span class="token punctuation">(</span><span class="token punctuation">{</span> data <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
          <span class="token function">catchError</span><span class="token punctuation">(</span><span class="token punctuation">(</span>error<span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token keyword">of</span><span class="token punctuation">(</span>AuthActions<span class="token punctuation">.</span><span class="token function">loginFailure</span><span class="token punctuation">(</span><span class="token punctuation">{</span> error <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
        <span class="token punctuation">)</span>
      <span class="token punctuation">)</span>
    <span class="token punctuation">)</span>
  <span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br></div></div><div class="language-ts line-numbers-mode"><pre class="language-ts"><code><span class="token comment">// admin.service.ts</span>
<span class="token keyword">import</span> <span class="token punctuation">{</span> Injectable <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">&quot;@angular/core&quot;</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token punctuation">{</span> Store <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">&quot;@ngrx/store&quot;</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token operator">*</span> <span class="token keyword">as</span> AuthActions <span class="token keyword">from</span> <span class="token string">&quot;./admin.actions&quot;</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token punctuation">{</span> HttpClient <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">&quot;@angular/common/http&quot;</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token punctuation">{</span> tap<span class="token punctuation">,</span> catchError <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">&quot;rxjs/operators&quot;</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token punctuation">{</span> <span class="token keyword">of</span> <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">&quot;rxjs&quot;</span><span class="token punctuation">;</span>

<span class="token decorator"><span class="token at operator">@</span><span class="token function">Injectable</span></span><span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token keyword">export</span> <span class="token keyword">class</span> <span class="token class-name">AuthService</span> <span class="token punctuation">{</span>
  <span class="token function">constructor</span><span class="token punctuation">(</span><span class="token keyword">private</span> store<span class="token operator">:</span> Store<span class="token punctuation">,</span> <span class="token keyword">private</span> http<span class="token operator">:</span> HttpClient<span class="token punctuation">)</span> <span class="token punctuation">{</span><span class="token punctuation">}</span>

  <span class="token function">login</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">return</span> <span class="token keyword">this</span><span class="token punctuation">.</span>http<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span><span class="token string">&quot;https://jsonplaceholder.typicode.com/todos/5&quot;</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">pipe</span><span class="token punctuation">(</span>
      <span class="token function">tap</span><span class="token punctuation">(</span><span class="token punctuation">(</span>data<span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token keyword">this</span><span class="token punctuation">.</span>store<span class="token punctuation">.</span><span class="token function">dispatch</span><span class="token punctuation">(</span>AuthActions<span class="token punctuation">.</span><span class="token function">loginSuccess</span><span class="token punctuation">(</span><span class="token punctuation">{</span> data <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
      <span class="token function">catchError</span><span class="token punctuation">(</span><span class="token punctuation">(</span>error<span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token keyword">of</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>store<span class="token punctuation">.</span><span class="token function">dispatch</span><span class="token punctuation">(</span>AuthActions<span class="token punctuation">.</span><span class="token function">loginFailure</span><span class="token punctuation">(</span><span class="token punctuation">{</span> error <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
    <span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br></div></div><div class="language-ts line-numbers-mode"><pre class="language-ts"><code><span class="token comment">// app.module.ts</span>
<span class="token keyword">import</span> <span class="token punctuation">{</span> <span class="token constant">APP_INITIALIZER</span><span class="token punctuation">,</span> NgModule<span class="token punctuation">,</span> <span class="token constant">CUSTOM_ELEMENTS_SCHEMA</span> <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">&quot;@angular/core&quot;</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token punctuation">{</span> StoreModule <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">&quot;@ngrx/store&quot;</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token punctuation">{</span> EffectsModule <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">&quot;@ngrx/effects&quot;</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token punctuation">{</span> adminReducer <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">&quot;./admin.reducer&quot;</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token punctuation">{</span> AuthEffects <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">&quot;./admin.effects&quot;</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token punctuation">{</span> AuthService <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">&quot;./admin.service&quot;</span><span class="token punctuation">;</span>

<span class="token keyword">export</span> <span class="token keyword">function</span> <span class="token function">initLogin</span><span class="token punctuation">(</span>authService<span class="token operator">:</span> AuthService<span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">return</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> authService<span class="token punctuation">.</span><span class="token function">login</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>

<span class="token decorator"><span class="token at operator">@</span><span class="token function">NgModule</span></span><span class="token punctuation">(</span><span class="token punctuation">{</span>
  imports<span class="token operator">:</span> <span class="token punctuation">[</span>StoreModule<span class="token punctuation">.</span><span class="token function">forRoot</span><span class="token punctuation">(</span><span class="token punctuation">{</span> admin<span class="token operator">:</span> adminReducer <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">,</span> EffectsModule<span class="token punctuation">.</span><span class="token function">forRoot</span><span class="token punctuation">(</span><span class="token punctuation">[</span>AuthEffects<span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">]</span><span class="token punctuation">,</span>
  providers<span class="token operator">:</span> <span class="token punctuation">[</span>
    AuthService<span class="token punctuation">,</span>
    <span class="token comment">// APP_INITIALIZER：在app启动时调用AuthService的login方法</span>
    <span class="token punctuation">{</span> provide<span class="token operator">:</span> <span class="token constant">APP_INITIALIZER</span><span class="token punctuation">,</span> useFactory<span class="token operator">:</span> initLogin<span class="token punctuation">,</span> deps<span class="token operator">:</span> <span class="token punctuation">[</span>AuthService<span class="token punctuation">]</span><span class="token punctuation">,</span> multi<span class="token operator">:</span> <span class="token boolean">true</span> <span class="token punctuation">}</span><span class="token punctuation">,</span>
  <span class="token punctuation">]</span><span class="token punctuation">,</span>
  schemas<span class="token operator">:</span> <span class="token punctuation">[</span><span class="token constant">CUSTOM_ELEMENTS_SCHEMA</span><span class="token punctuation">]</span><span class="token punctuation">,</span> <span class="token comment">// 自定义属性不报错</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>
<span class="token keyword">export</span> <span class="token keyword">class</span> <span class="token class-name">AppModule</span> <span class="token punctuation">{</span><span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br></div></div><div class="language-ts line-numbers-mode"><pre class="language-ts"><code><span class="token comment">// app.component.ts</span>
<span class="token keyword">import</span> <span class="token punctuation">{</span> Store<span class="token punctuation">,</span> select <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">&quot;@ngrx/store&quot;</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token punctuation">{</span> AppState <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">&quot;./admin.reducer&quot;</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token punctuation">{</span> Component<span class="token punctuation">,</span> OnInit<span class="token punctuation">,</span> OnDestroy <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">&quot;@angular/core&quot;</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token punctuation">{</span> selectData<span class="token punctuation">,</span> selectError<span class="token punctuation">,</span> selectLoading <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">&quot;./admin.selectors&quot;</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token operator">*</span> <span class="token keyword">as</span> AuthActions <span class="token keyword">from</span> <span class="token string">&quot;./admin.actions&quot;</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token punctuation">{</span> Subscription <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">&quot;rxjs&quot;</span><span class="token punctuation">;</span>

<span class="token decorator"><span class="token at operator">@</span><span class="token function">Component</span></span><span class="token punctuation">(</span><span class="token punctuation">{</span>
  selector<span class="token operator">:</span> <span class="token string">&quot;app-root&quot;</span><span class="token punctuation">,</span>
  template<span class="token operator">:</span> <span class="token template-string"><span class="token template-punctuation string">`</span><span class="token string">
    &lt;div *ngIf=&quot;loading&quot;&gt;Loading...&lt;/div&gt;
    &lt;div *ngIf=&quot;error&quot;&gt;{{ error }}&lt;/div&gt;
    &lt;div *ngIf=&quot;data&quot;&gt;{{ data | json }}&lt;/div&gt;
  </span><span class="token template-punctuation string">`</span></span><span class="token punctuation">,</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>
<span class="token keyword">export</span> <span class="token keyword">class</span> <span class="token class-name">AppComponent</span> <span class="token keyword">implements</span> <span class="token class-name">OnInit</span><span class="token punctuation">,</span> OnDestroy <span class="token punctuation">{</span>
  loading$ <span class="token operator">=</span> <span class="token keyword">this</span><span class="token punctuation">.</span>store<span class="token punctuation">.</span><span class="token function">pipe</span><span class="token punctuation">(</span><span class="token function">select</span><span class="token punctuation">(</span>selectLoading<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  error$ <span class="token operator">=</span> <span class="token keyword">this</span><span class="token punctuation">.</span>store<span class="token punctuation">.</span><span class="token function">pipe</span><span class="token punctuation">(</span><span class="token function">select</span><span class="token punctuation">(</span>selectError<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  data$ <span class="token operator">=</span> <span class="token keyword">this</span><span class="token punctuation">.</span>store<span class="token punctuation">.</span><span class="token function">pipe</span><span class="token punctuation">(</span><span class="token function">select</span><span class="token punctuation">(</span>selectData<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token comment">// data$ = this.store.select(selectData); // 也可以</span>
  data <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">;</span>
  error <span class="token operator">=</span> <span class="token keyword">undefined</span><span class="token punctuation">;</span>
  loading <span class="token operator">=</span> <span class="token boolean">false</span><span class="token punctuation">;</span>
  <span class="token keyword">private</span> subscription<span class="token operator">:</span> Subscription <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Subscription</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

  <span class="token function">constructor</span><span class="token punctuation">(</span><span class="token keyword">private</span> store<span class="token operator">:</span> Store<span class="token operator">&lt;</span>AppState<span class="token operator">&gt;</span><span class="token punctuation">)</span> <span class="token punctuation">{</span><span class="token punctuation">}</span>

  <span class="token function">ngOnInit</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">this</span><span class="token punctuation">.</span>subscription <span class="token operator">=</span> <span class="token keyword">this</span><span class="token punctuation">.</span>data$<span class="token punctuation">.</span><span class="token function">subscribe</span><span class="token punctuation">(</span><span class="token punctuation">(</span>data<span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
      <span class="token keyword">this</span><span class="token punctuation">.</span>data <span class="token operator">=</span> data<span class="token punctuation">;</span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">this</span><span class="token punctuation">.</span>subscription<span class="token punctuation">.</span><span class="token function">add</span><span class="token punctuation">(</span>
      <span class="token keyword">this</span><span class="token punctuation">.</span>error$<span class="token punctuation">.</span><span class="token function">subscribe</span><span class="token punctuation">(</span><span class="token punctuation">(</span>error<span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
        <span class="token keyword">this</span><span class="token punctuation">.</span>error <span class="token operator">=</span> error<span class="token punctuation">;</span>
      <span class="token punctuation">}</span><span class="token punctuation">)</span>
    <span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">this</span><span class="token punctuation">.</span>subscription<span class="token punctuation">.</span><span class="token function">add</span><span class="token punctuation">(</span>
      <span class="token keyword">this</span><span class="token punctuation">.</span>loading$<span class="token punctuation">.</span><span class="token function">subscribe</span><span class="token punctuation">(</span><span class="token punctuation">(</span>loading<span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
        <span class="token keyword">this</span><span class="token punctuation">.</span>loading <span class="token operator">=</span> loading<span class="token punctuation">;</span>
      <span class="token punctuation">}</span><span class="token punctuation">)</span>
    <span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>

  <span class="token function">ngOnDestroy</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">this</span><span class="token punctuation">.</span>subscription<span class="token punctuation">.</span><span class="token function">unsubscribe</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br><span class="line-number">28</span><br><span class="line-number">29</span><br><span class="line-number">30</span><br><span class="line-number">31</span><br><span class="line-number">32</span><br><span class="line-number">33</span><br><span class="line-number">34</span><br><span class="line-number">35</span><br><span class="line-number">36</span><br><span class="line-number">37</span><br><span class="line-number">38</span><br><span class="line-number">39</span><br><span class="line-number">40</span><br><span class="line-number">41</span><br><span class="line-number">42</span><br><span class="line-number">43</span><br><span class="line-number">44</span><br><span class="line-number">45</span><br><span class="line-number">46</span><br><span class="line-number">47</span><br><span class="line-number">48</span><br></div></div><h2 id="指令使用"><a href="#指令使用" class="header-anchor">#</a> 指令使用</h2> <ol><li><code>ng g d [path]/name</code></li> <li>一个指令可以同时接收多个参数</li> <li>指令使用时需要注册到模块中</li> <li>示例：</li></ol> <div class="language-ts line-numbers-mode"><pre class="language-ts"><code><span class="token keyword">import</span> <span class="token punctuation">{</span>
  Directive<span class="token punctuation">,</span>
  Input<span class="token punctuation">,</span>
  ElementRef<span class="token punctuation">,</span>
  Renderer2<span class="token punctuation">,</span>
  OnInit<span class="token punctuation">,</span>
  OnDestroy<span class="token punctuation">,</span>
  ChangeDetectorRef<span class="token punctuation">,</span>
  HostBinding<span class="token punctuation">,</span>
  SimpleChanges<span class="token punctuation">,</span>
<span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">&quot;@angular/core&quot;</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token punctuation">{</span> Store<span class="token punctuation">,</span> select <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">&quot;@ngrx/store&quot;</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token punctuation">{</span> Observable<span class="token punctuation">,</span> Subscription<span class="token punctuation">,</span> <span class="token keyword">of</span> <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">&quot;rxjs&quot;</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token punctuation">{</span> map <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">&quot;rxjs/operators&quot;</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token punctuation">{</span> AppState <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">&quot;src/app/store/admin.reducers&quot;</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token punctuation">{</span> selectAuthCodes <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">&quot;src/app/store/admin.selectors&quot;</span><span class="token punctuation">;</span>

<span class="token decorator"><span class="token at operator">@</span><span class="token function">Directive</span></span><span class="token punctuation">(</span><span class="token punctuation">{</span>
  selector<span class="token operator">:</span> <span class="token string">&quot;[btnAuth]&quot;</span><span class="token punctuation">,</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>
<span class="token keyword">export</span> <span class="token keyword">class</span> <span class="token class-name">AuthDirective</span> <span class="token keyword">implements</span> <span class="token class-name">OnInit</span><span class="token punctuation">,</span> OnDestroy <span class="token punctuation">{</span>
  <span class="token comment">// 指令接收的参数1</span>
  <span class="token decorator"><span class="token at operator">@</span><span class="token function">Input</span></span><span class="token punctuation">(</span><span class="token punctuation">)</span> btnAuth<span class="token operator">:</span> <span class="token builtin">string</span><span class="token punctuation">[</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">;</span>
  <span class="token comment">// 接收的另一个参数2：目的是根据是否有权限和表单是否有效这两个条件来一起判断按钮是否可用</span>
  <span class="token decorator"><span class="token at operator">@</span><span class="token function">Input</span></span><span class="token punctuation">(</span><span class="token punctuation">)</span> isFormInvalid<span class="token operator">:</span> <span class="token builtin">boolean</span> <span class="token operator">=</span> <span class="token boolean">false</span><span class="token punctuation">;</span>
  <span class="token keyword">private</span> userAuthCodes$<span class="token operator">:</span> Observable<span class="token operator">&lt;</span><span class="token builtin">string</span><span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token operator">&gt;</span> <span class="token operator">=</span> <span class="token keyword">of</span><span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token keyword">private</span> subscription<span class="token operator">:</span> Subscription <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Subscription</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token keyword">private</span> hasAuth<span class="token operator">:</span> <span class="token builtin">boolean</span> <span class="token operator">=</span> <span class="token boolean">false</span><span class="token punctuation">;</span>

  <span class="token comment">// @HostBinding装饰器用于将指令的属性绑定到宿主元素的属性、样式或类。</span>
  <span class="token comment">// 可以认为它是模板绑定的一种替代方式，但是在指令的类文件中使用</span>
  <span class="token decorator"><span class="token at operator">@</span><span class="token function">HostBinding</span></span><span class="token punctuation">(</span><span class="token string">&quot;attr.disabled&quot;</span><span class="token punctuation">)</span> <span class="token keyword">get</span> <span class="token function">disabled</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">return</span> <span class="token keyword">this</span><span class="token punctuation">.</span>hasAuth <span class="token operator">?</span> <span class="token keyword">null</span> <span class="token operator">:</span> <span class="token boolean">true</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
  <span class="token comment">// @HostBinding可以有多种使用形式</span>
  <span class="token comment">// @HostBinding('style.backgroundColor') backgroundColor: string;</span>
  <span class="token comment">// @HostBinding('class.active') isActive: boolean;</span>

  <span class="token comment">// @HostListener装饰器用于监听宿主元素上的事件，并在事件发生时执行指定的方法。</span>
  <span class="token comment">// @HostListener(&quot;mouseenter&quot;) onMouseEnter() {</span>
  <span class="token comment">//   this.highlight(&quot;yellow&quot;);</span>
  <span class="token comment">// }</span>

  <span class="token comment">// @HostListener(&quot;mouseleave&quot;) onMouseLeave() {</span>
  <span class="token comment">//   this.highlight(null);</span>
  <span class="token comment">// }</span>

  <span class="token comment">// private highlight(color: string | null) {</span>
  <span class="token comment">//   // 在这里，你可以使用 @HostBinding 或直接操作 DOM 来改变样式</span>
  <span class="token comment">// }</span>

  <span class="token function">constructor</span><span class="token punctuation">(</span>
    <span class="token keyword">private</span> el<span class="token operator">:</span> ElementRef<span class="token punctuation">,</span>
    <span class="token keyword">private</span> renderer<span class="token operator">:</span> Renderer2<span class="token punctuation">,</span>
    <span class="token keyword">private</span> cdRef<span class="token operator">:</span> ChangeDetectorRef<span class="token punctuation">,</span>
    <span class="token keyword">private</span> store<span class="token operator">:</span> Store<span class="token operator">&lt;</span>AppState<span class="token operator">&gt;</span> <span class="token comment">// @Host用于控制依赖注入的作用域，用于注入器的视图层级注入，它告诉Angular在注入依赖时应该从宿主元素的注入器开始查找。 // @Optional() @Host() private someService: SomeService</span>
  <span class="token punctuation">)</span> <span class="token punctuation">{</span><span class="token punctuation">}</span>

  <span class="token function">ngOnInit</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">this</span><span class="token punctuation">.</span>subscription <span class="token operator">=</span> <span class="token keyword">this</span><span class="token punctuation">.</span>store<span class="token punctuation">.</span><span class="token function">pipe</span><span class="token punctuation">(</span><span class="token function">select</span><span class="token punctuation">(</span>selectAuthCodes<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token operator">?.</span><span class="token function">subscribe</span><span class="token punctuation">(</span><span class="token punctuation">(</span>codes<span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
      <span class="token keyword">this</span><span class="token punctuation">.</span>userAuthCodes$ <span class="token operator">=</span> <span class="token keyword">of</span><span class="token punctuation">(</span>codes<span class="token punctuation">)</span><span class="token punctuation">;</span>
      <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">updateButtonStatus</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>

  <span class="token function">ngOnDestroy</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">this</span><span class="token punctuation">.</span>subscription<span class="token punctuation">.</span><span class="token function">unsubscribe</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>

  <span class="token function">ngOnChanges</span><span class="token punctuation">(</span>changes<span class="token operator">:</span> SimpleChanges<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">updateButtonStatus</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>

  <span class="token keyword">private</span> <span class="token function">updateButtonStatus</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">:</span> Subscription <span class="token punctuation">{</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span><span class="token keyword">this</span><span class="token punctuation">.</span>userAuthCodes$<span class="token punctuation">)</span> <span class="token punctuation">{</span>
      <span class="token builtin">console</span><span class="token punctuation">.</span><span class="token function">warn</span><span class="token punctuation">(</span><span class="token string">&quot;userAuthCodes$ is undefined or null. Make sure the Store is properly initialized.&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
      <span class="token keyword">return</span> <span class="token keyword">new</span> <span class="token class-name">Subscription</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token keyword">return</span> <span class="token keyword">this</span><span class="token punctuation">.</span>userAuthCodes$<span class="token punctuation">.</span><span class="token function">subscribe</span><span class="token punctuation">(</span><span class="token punctuation">(</span>authCodes<span class="token operator">:</span> <span class="token builtin">string</span><span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
      <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span>authCodes<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token builtin">console</span><span class="token punctuation">.</span><span class="token function">warn</span><span class="token punctuation">(</span><span class="token string">&quot;authCodes is undefined or null. The Store state might not be ready yet.&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">return</span><span class="token punctuation">;</span>
      <span class="token punctuation">}</span>
      <span class="token keyword">const</span> hasPermission <span class="token operator">=</span> authCodes<span class="token punctuation">.</span><span class="token function">some</span><span class="token punctuation">(</span><span class="token punctuation">(</span>authCode<span class="token operator">:</span> <span class="token builtin">string</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token keyword">this</span><span class="token punctuation">.</span>btnAuth<span class="token punctuation">.</span><span class="token function">includes</span><span class="token punctuation">(</span>authCode<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
      <span class="token keyword">this</span><span class="token punctuation">.</span>hasAuth <span class="token operator">=</span> hasPermission <span class="token operator">&amp;&amp;</span> <span class="token operator">!</span><span class="token keyword">this</span><span class="token punctuation">.</span>isFormInvalid<span class="token punctuation">;</span>
      <span class="token comment">// 理论上来说可以设置disabled属性，but没有生效，所以使用HostBinding来实现该功能</span>
      <span class="token comment">// this.renderer.setProperty(this.el.nativeElement, 'disabled', !this.hasAuth);</span>
      <span class="token keyword">this</span><span class="token punctuation">.</span>cdRef<span class="token punctuation">.</span><span class="token function">detectChanges</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>

<span class="token decorator"><span class="token at operator">@</span><span class="token function">Component</span></span><span class="token punctuation">(</span><span class="token punctuation">{</span>
  template<span class="token operator">:</span> <span class="token template-string"><span class="token template-punctuation string">`</span><span class="token string"> &lt;button btnAuth=&quot;['ADMIN']&quot; [isFormInvalid]=&quot;false&quot; type=&quot;submit&quot;&gt;Submit&lt;/button&gt; </span><span class="token template-punctuation string">`</span></span><span class="token punctuation">,</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>
<span class="token keyword">class</span> <span class="token class-name">TestComponent3</span> <span class="token punctuation">{</span>
  btnAuth<span class="token operator">:</span> <span class="token builtin">string</span><span class="token punctuation">[</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">;</span>
  isFormInvalid<span class="token operator">?</span><span class="token operator">:</span> <span class="token builtin">boolean</span> <span class="token operator">=</span> <span class="token boolean">false</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br><span class="line-number">28</span><br><span class="line-number">29</span><br><span class="line-number">30</span><br><span class="line-number">31</span><br><span class="line-number">32</span><br><span class="line-number">33</span><br><span class="line-number">34</span><br><span class="line-number">35</span><br><span class="line-number">36</span><br><span class="line-number">37</span><br><span class="line-number">38</span><br><span class="line-number">39</span><br><span class="line-number">40</span><br><span class="line-number">41</span><br><span class="line-number">42</span><br><span class="line-number">43</span><br><span class="line-number">44</span><br><span class="line-number">45</span><br><span class="line-number">46</span><br><span class="line-number">47</span><br><span class="line-number">48</span><br><span class="line-number">49</span><br><span class="line-number">50</span><br><span class="line-number">51</span><br><span class="line-number">52</span><br><span class="line-number">53</span><br><span class="line-number">54</span><br><span class="line-number">55</span><br><span class="line-number">56</span><br><span class="line-number">57</span><br><span class="line-number">58</span><br><span class="line-number">59</span><br><span class="line-number">60</span><br><span class="line-number">61</span><br><span class="line-number">62</span><br><span class="line-number">63</span><br><span class="line-number">64</span><br><span class="line-number">65</span><br><span class="line-number">66</span><br><span class="line-number">67</span><br><span class="line-number">68</span><br><span class="line-number">69</span><br><span class="line-number">70</span><br><span class="line-number">71</span><br><span class="line-number">72</span><br><span class="line-number">73</span><br><span class="line-number">74</span><br><span class="line-number">75</span><br><span class="line-number">76</span><br><span class="line-number">77</span><br><span class="line-number">78</span><br><span class="line-number">79</span><br><span class="line-number">80</span><br><span class="line-number">81</span><br><span class="line-number">82</span><br><span class="line-number">83</span><br><span class="line-number">84</span><br><span class="line-number">85</span><br><span class="line-number">86</span><br><span class="line-number">87</span><br><span class="line-number">88</span><br><span class="line-number">89</span><br><span class="line-number">90</span><br><span class="line-number">91</span><br><span class="line-number">92</span><br><span class="line-number">93</span><br><span class="line-number">94</span><br><span class="line-number">95</span><br><span class="line-number">96</span><br><span class="line-number">97</span><br><span class="line-number">98</span><br><span class="line-number">99</span><br><span class="line-number">100</span><br></div></div><h2 id="renderer2"><a href="#renderer2" class="header-anchor">#</a> Renderer2</h2> <ol><li>Renderer2 是 Angular 中的一个抽象类，提供了一种在不直接操作 DOM 的情况下与宿主元素进行交互的方法。这种方法更安全，特别是当运行在不同平台上时（比如服务器端渲染、Web Worker 或者任何不直接支持 DOM 操作的环境）。使用 Renderer2，你可以添加或删除元素、添加或删除样式、监听事件等，而不用担心跨平台兼容性问题。</li> <li>Renderer2 的主要方法包括：
<ul><li>createElement(name: string, namespace?: string|null): 创建一个新的元素。</li> <li>createText(value: string): 创建一个新的文本节点。</li> <li>appendChild(parent: any, newChild: any): 将一个子节点添加到父节点上。</li> <li>insertBefore(parent: any, newChild: any, refChild: any): 在参考子节点之前插入一个新的子节点。</li> <li>removeChild(parent: any, oldChild: any): 从父节点上移除一个子节点。</li> <li>selectRootElement(selectorOrNode: any): 选择根元素。</li> <li>setAttribute(el: any, name: string, value: string, namespace?: string|null): 设置元素的属性。</li> <li>removeAttribute(el: any, name: string, namespace?: string|null): 移除元素的属性。</li> <li>addClass(el: any, name: string): 给元素添加类。</li> <li>removeClass(el: any, name: string): 移除元素的类。</li> <li>setStyle(el: any, style: string, value: any, flags?: RendererStyleFlags2): 设置元素的样式。</li> <li>removeStyle(el: any, style: string, flags?: RendererStyleFlags2): 移除元素的样式。</li> <li>setProperty(el: any, name: string, value: any): 设置元素的属性。</li> <li>listen(target: 'window'|'document'|'body'|any, eventName: string, callback: (event: any) =&gt; boolean | void): 监听给定的事件。</li></ul></li> <li>Renderer2 的使用示例：假设你有一个指令，当鼠标悬停在宿主元素上时，你想改变宿主元素的背景色。你可以使用 Renderer2 来实现这个功能，而不是直接操作 DOM：</li></ol> <div class="language-ts line-numbers-mode"><pre class="language-ts"><code><span class="token keyword">import</span> <span class="token punctuation">{</span> Directive<span class="token punctuation">,</span> ElementRef<span class="token punctuation">,</span> Renderer2<span class="token punctuation">,</span> HostListener <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">&quot;@angular/core&quot;</span><span class="token punctuation">;</span>

<span class="token decorator"><span class="token at operator">@</span><span class="token function">Directive</span></span><span class="token punctuation">(</span><span class="token punctuation">{</span>
  selector<span class="token operator">:</span> <span class="token string">&quot;[appHighlight]&quot;</span><span class="token punctuation">,</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>
<span class="token keyword">export</span> <span class="token keyword">class</span> <span class="token class-name">HighlightDirective</span> <span class="token punctuation">{</span>
  <span class="token function">constructor</span><span class="token punctuation">(</span><span class="token keyword">private</span> el<span class="token operator">:</span> ElementRef<span class="token punctuation">,</span> <span class="token keyword">private</span> renderer<span class="token operator">:</span> Renderer2<span class="token punctuation">)</span> <span class="token punctuation">{</span><span class="token punctuation">}</span>

  <span class="token decorator"><span class="token at operator">@</span><span class="token function">HostListener</span></span><span class="token punctuation">(</span><span class="token string">&quot;mouseenter&quot;</span><span class="token punctuation">)</span> <span class="token function">onMouseEnter</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">highlight</span><span class="token punctuation">(</span><span class="token string">&quot;yellow&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>

  <span class="token decorator"><span class="token at operator">@</span><span class="token function">HostListener</span></span><span class="token punctuation">(</span><span class="token string">&quot;mouseleave&quot;</span><span class="token punctuation">)</span> <span class="token function">onMouseLeave</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">highlight</span><span class="token punctuation">(</span><span class="token keyword">null</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>

  <span class="token keyword">private</span> <span class="token function">highlight</span><span class="token punctuation">(</span>color<span class="token operator">:</span> <span class="token builtin">string</span> <span class="token operator">|</span> <span class="token keyword">null</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">this</span><span class="token punctuation">.</span>renderer<span class="token punctuation">.</span><span class="token function">setStyle</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>el<span class="token punctuation">.</span>nativeElement<span class="token punctuation">,</span> <span class="token string">&quot;backgroundColor&quot;</span><span class="token punctuation">,</span> color<span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br></div></div><h2 id="单元测试"><a href="#单元测试" class="header-anchor">#</a> 单元测试</h2> <ol><li>可以使用 jest 进行单元测试，也可以使用 karma 进行单元测试。以下以 karma 进行单元测试。</li> <li><code>ng test</code>：运行单元测试。</li> <li><code>ng test --code-coverage</code>：运行单元测试并生成代码覆盖率报告。</li> <li><code>ng test --watch</code>：运行单元测试并监视文件变化。</li> <li><code>ng test --browsers Chrome</code>：指定浏览器运行单元测试。</li> <li><code>ng test --browsers ChromeHeadless</code>：指定无头浏览器运行单元测试。</li> <li><code>ng test --no-watch --no-progress --browsers=CustomChromeHeadless --code-coverage</code>：不监视文件变化，不显示进度，指定无头浏览器运行单元测试并生成代码覆盖率报告，用于接入 SonarQube。</li></ol> <h3 id="测试平台的配置文件"><a href="#测试平台的配置文件" class="header-anchor">#</a> 测试平台的配置文件</h3> <ol><li><code>karma.conf.js</code>：Karma 的配置文件，用于配置测试平台的各种参数。</li></ol> <div class="language-js line-numbers-mode"><pre class="language-js"><code><span class="token comment">// Karma configuration file, see link for more information</span>
<span class="token comment">// https://karma-runner.github.io/1.0/config/configuration-file.html</span>

module<span class="token punctuation">.</span><span class="token function-variable function">exports</span> <span class="token operator">=</span> <span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token parameter">config</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  config<span class="token punctuation">.</span><span class="token function">set</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
    <span class="token literal-property property">basePath</span><span class="token operator">:</span> <span class="token string">&quot;&quot;</span><span class="token punctuation">,</span>
    <span class="token literal-property property">frameworks</span><span class="token operator">:</span> <span class="token punctuation">[</span><span class="token string">&quot;jasmine&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;@angular-devkit/build-angular&quot;</span><span class="token punctuation">]</span><span class="token punctuation">,</span>
    <span class="token literal-property property">plugins</span><span class="token operator">:</span> <span class="token punctuation">[</span>
      <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">&quot;karma-jasmine&quot;</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
      <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">&quot;karma-chrome-launcher&quot;</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
      <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">&quot;karma-jasmine-html-reporter&quot;</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
      <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">&quot;@angular-devkit/build-angular/plugins/karma&quot;</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
      <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">&quot;karma-coverage-istanbul-reporter&quot;</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
    <span class="token punctuation">]</span><span class="token punctuation">,</span>
    <span class="token literal-property property">client</span><span class="token operator">:</span> <span class="token punctuation">{</span>
      <span class="token literal-property property">jasmine</span><span class="token operator">:</span> <span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token punctuation">,</span>
      <span class="token literal-property property">clearContext</span><span class="token operator">:</span> <span class="token boolean">false</span><span class="token punctuation">,</span>
    <span class="token punctuation">}</span><span class="token punctuation">,</span>
    <span class="token literal-property property">jasmineHtmlReporter</span><span class="token operator">:</span> <span class="token punctuation">{</span>
      <span class="token literal-property property">suppressAll</span><span class="token operator">:</span> <span class="token boolean">true</span><span class="token punctuation">,</span>
    <span class="token punctuation">}</span><span class="token punctuation">,</span>
    <span class="token literal-property property">coverageIstanbulReporter</span><span class="token operator">:</span> <span class="token punctuation">{</span>
      <span class="token literal-property property">reports</span><span class="token operator">:</span> <span class="token punctuation">[</span><span class="token string">&quot;html&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;lcovonly&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;text-summary&quot;</span><span class="token punctuation">]</span><span class="token punctuation">,</span>
      <span class="token literal-property property">dir</span><span class="token operator">:</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">&quot;path&quot;</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">join</span><span class="token punctuation">(</span>__dirname<span class="token punctuation">,</span> <span class="token string">&quot;./coverage/mu-ui&quot;</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
      <span class="token literal-property property">subdir</span><span class="token operator">:</span> <span class="token string">&quot;.&quot;</span><span class="token punctuation">,</span>
      <span class="token literal-property property">fixWebpackSourcePaths</span><span class="token operator">:</span> <span class="token boolean">true</span><span class="token punctuation">,</span>
      <span class="token literal-property property">skipFilesWithNoCoverage</span><span class="token operator">:</span> <span class="token boolean">true</span><span class="token punctuation">,</span>
      <span class="token literal-property property">thresholds</span><span class="token operator">:</span> <span class="token punctuation">{</span>
        <span class="token literal-property property">emitWarning</span><span class="token operator">:</span> <span class="token boolean">true</span><span class="token punctuation">,</span>
        <span class="token literal-property property">global</span><span class="token operator">:</span> <span class="token punctuation">{</span>
          <span class="token literal-property property">statements</span><span class="token operator">:</span> <span class="token number">80</span><span class="token punctuation">,</span>
          <span class="token literal-property property">lines</span><span class="token operator">:</span> <span class="token number">80</span><span class="token punctuation">,</span>
          <span class="token literal-property property">branches</span><span class="token operator">:</span> <span class="token number">80</span><span class="token punctuation">,</span>
          <span class="token literal-property property">functions</span><span class="token operator">:</span> <span class="token number">80</span><span class="token punctuation">,</span>
        <span class="token punctuation">}</span><span class="token punctuation">,</span>
      <span class="token punctuation">}</span><span class="token punctuation">,</span>
    <span class="token punctuation">}</span><span class="token punctuation">,</span>
    <span class="token literal-property property">combineBrowserReports</span><span class="token operator">:</span> <span class="token boolean">true</span><span class="token punctuation">,</span>
    <span class="token literal-property property">reporters</span><span class="token operator">:</span> <span class="token punctuation">[</span><span class="token string">&quot;progress&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;kjhtml&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;coverage-istanbul&quot;</span><span class="token punctuation">]</span><span class="token punctuation">,</span>
    <span class="token comment">// 接入SonarQube时使用</span>
    <span class="token comment">// browsers: [&quot;CustomChromeHeadless&quot;],</span>
    <span class="token literal-property property">browsers</span><span class="token operator">:</span> <span class="token punctuation">[</span><span class="token string">&quot;Chrome&quot;</span><span class="token punctuation">]</span><span class="token punctuation">,</span>
    <span class="token literal-property property">customLaunchers</span><span class="token operator">:</span> <span class="token punctuation">{</span>
      <span class="token comment">// 接入SonarQube时使用</span>
      <span class="token comment">// CustomChromeHeadless: {</span>
      <span class="token comment">//   base: 'Chrome',</span>
      <span class="token comment">//   flags: [</span>
      <span class="token comment">//     '--headless',</span>
      <span class="token comment">//     '--disable-gpu',</span>
      <span class="token comment">//     '--no-sandbox',</span>
      <span class="token comment">//     '--disable-translate',</span>
      <span class="token comment">//     '--disable-extensions',</span>
      <span class="token comment">//     '--remote-debugging-port=9222'</span>
      <span class="token comment">//   ]</span>
      <span class="token comment">// },</span>
      <span class="token comment">// 平时开发时使用</span>
      <span class="token literal-property property">ChromeHeadless</span><span class="token operator">:</span> <span class="token punctuation">{</span>
        <span class="token literal-property property">base</span><span class="token operator">:</span> <span class="token string">&quot;Chrome&quot;</span><span class="token punctuation">,</span>
        <span class="token literal-property property">flags</span><span class="token operator">:</span> <span class="token punctuation">[</span>
          <span class="token string">&quot;--headless&quot;</span><span class="token punctuation">,</span>
          <span class="token string">&quot;--disable-gpu&quot;</span><span class="token punctuation">,</span>
          <span class="token string">&quot;--no-sandbox&quot;</span><span class="token punctuation">,</span>
          <span class="token string">&quot;--disable-translate&quot;</span><span class="token punctuation">,</span>
          <span class="token string">&quot;--disable-extensions&quot;</span><span class="token punctuation">,</span>
          <span class="token string">&quot;--remote-debugging-port=9222&quot;</span><span class="token punctuation">,</span>
        <span class="token punctuation">]</span><span class="token punctuation">,</span>
      <span class="token punctuation">}</span><span class="token punctuation">,</span>
    <span class="token punctuation">}</span><span class="token punctuation">,</span>
    <span class="token literal-property property">restartOnFileChange</span><span class="token operator">:</span> <span class="token boolean">true</span><span class="token punctuation">,</span>
    <span class="token literal-property property">verbose</span><span class="token operator">:</span> <span class="token boolean">true</span><span class="token punctuation">,</span>
  <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br><span class="line-number">28</span><br><span class="line-number">29</span><br><span class="line-number">30</span><br><span class="line-number">31</span><br><span class="line-number">32</span><br><span class="line-number">33</span><br><span class="line-number">34</span><br><span class="line-number">35</span><br><span class="line-number">36</span><br><span class="line-number">37</span><br><span class="line-number">38</span><br><span class="line-number">39</span><br><span class="line-number">40</span><br><span class="line-number">41</span><br><span class="line-number">42</span><br><span class="line-number">43</span><br><span class="line-number">44</span><br><span class="line-number">45</span><br><span class="line-number">46</span><br><span class="line-number">47</span><br><span class="line-number">48</span><br><span class="line-number">49</span><br><span class="line-number">50</span><br><span class="line-number">51</span><br><span class="line-number">52</span><br><span class="line-number">53</span><br><span class="line-number">54</span><br><span class="line-number">55</span><br><span class="line-number">56</span><br><span class="line-number">57</span><br><span class="line-number">58</span><br><span class="line-number">59</span><br><span class="line-number">60</span><br><span class="line-number">61</span><br><span class="line-number">62</span><br><span class="line-number">63</span><br><span class="line-number">64</span><br><span class="line-number">65</span><br><span class="line-number">66</span><br><span class="line-number">67</span><br><span class="line-number">68</span><br><span class="line-number">69</span><br><span class="line-number">70</span><br><span class="line-number">71</span><br><span class="line-number">72</span><br></div></div><h3 id="测试用例注意事项"><a href="#测试用例注意事项" class="header-anchor">#</a> 测试用例注意事项</h3> <ol><li>注意把所有使用到的依赖项都引入 spec.ts 文件中。</li> <li>使用<code>describe</code>和<code>it</code>来组织测试用例。</li> <li>使用<code>beforeEach</code>和<code>afterEach</code>来初始化和清理测试用例。</li> <li>使用<code>spyOn</code>来监视函数的调用情况。</li> <li>使用<code>expect</code>来断言测试结果。</li> <li>对于不易测试的较大的组件，可以通过模拟子组件的方式来进行测试，也就是将组件简化并进行 mock。</li> <li>使用<code>TestBed</code>来创建组件的测试环境。</li> <li>使用<code>TestBed.configureTestingModule</code>来配置测试模块。</li> <li>使用<code>TestBed.createComponent</code>来创建组件的实例。</li> <li>使用<code>fixture.detectChanges()</code>来触发组件的变更检测。</li> <li>使用<code>fixture.nativeElement</code>来获取组件的 DOM 元素。</li> <li>使用<code>fixture.debugElement</code>来获取组件的 DebugElement。</li> <li>使用<code>fixture.componentInstance</code>来获取组件实例。</li> <li>使用<code>fixture.autoDetectChanges()</code>来自动检测变更。</li> <li>使用<code>fixture.whenStable()</code>来等待异步操作完成。</li> <li>使用<code>fakeAsync, tick</code>来进行异步测试。</li> <li>使用<code>TestBed.inject</code>来获取服务实例。</li></ol> <h3 id="测试用例示例"><a href="#测试用例示例" class="header-anchor">#</a> 测试用例示例</h3> <div class="language-ts line-numbers-mode"><pre class="language-ts"><code><span class="token keyword">import</span> <span class="token punctuation">{</span> ComponentFixture<span class="token punctuation">,</span> TestBed <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">'@angular/core/testing'</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token punctuation">{</span> TranslateService<span class="token punctuation">,</span> TranslateLoader<span class="token punctuation">,</span> TranslateFakeLoader<span class="token punctuation">,</span> TranslateModule <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">'@ngx-translate/core'</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token punctuation">{</span> <span class="token constant">NO_ERRORS_SCHEMA</span> <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">'@angular/core'</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token punctuation">{</span> Store<span class="token punctuation">,</span> StoreModule <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">'@ngrx/store'</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token punctuation">{</span> UserComponent <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">'./user.component'</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token punctuation">{</span> MessageService <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">'./message.service'</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token punctuation">{</span> AuthDirective <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">'./auth.directive'</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token punctuation">{</span> UserService <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">'./user.service'</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token punctuation">{</span> UserWhiteListService <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">'./user.whitelist.service'</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token punctuation">{</span> Observable<span class="token punctuation">,</span> <span class="token keyword">of</span> <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">'rxjs'</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token punctuation">{</span> MatDialogRef<span class="token punctuation">,</span> <span class="token constant">MAT_DIALOG_DATA</span><span class="token punctuation">,</span> MatDialog <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">'@angular/material/dialog'</span><span class="token punctuation">;</span>

<span class="token comment">// 模拟一个弹窗提示服务</span>
<span class="token keyword">class</span> <span class="token class-name">MockMessageService</span> <span class="token punctuation">{</span>
  <span class="token function">showInfoMessage</span><span class="token punctuation">(</span>msg<span class="token operator">:</span> <span class="token builtin">string</span><span class="token punctuation">)</span> <span class="token punctuation">{</span><span class="token punctuation">}</span>
  <span class="token function">showErrorMessage</span><span class="token punctuation">(</span>msg<span class="token operator">:</span> <span class="token builtin">string</span><span class="token punctuation">)</span> <span class="token punctuation">{</span><span class="token punctuation">}</span>
  <span class="token function">showWarnMessage</span><span class="token punctuation">(</span>msg<span class="token operator">:</span> <span class="token builtin">string</span><span class="token punctuation">)</span> <span class="token punctuation">{</span><span class="token punctuation">}</span>
<span class="token punctuation">}</span>

<span class="token keyword">class</span> <span class="token class-name">MockUserService</span> <span class="token punctuation">{</span>
  <span class="token function">getUserData</span><span class="token punctuation">(</span>vin<span class="token operator">:</span> <span class="token builtin">string</span><span class="token punctuation">,</span> referenceVin<span class="token operator">:</span> <span class="token builtin">string</span><span class="token punctuation">)</span><span class="token operator">:</span> Observable<span class="token operator">&lt;</span><span class="token builtin">any</span><span class="token operator">&gt;</span> <span class="token punctuation">{</span>
    <span class="token keyword">return</span> <span class="token keyword">of</span><span class="token punctuation">(</span><span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>

  <span class="token function">createUserData</span><span class="token punctuation">(</span>vin<span class="token operator">:</span> <span class="token builtin">string</span><span class="token punctuation">,</span> referenceVin<span class="token operator">:</span> <span class="token builtin">string</span><span class="token punctuation">)</span><span class="token operator">:</span> Observable<span class="token operator">&lt;</span><span class="token builtin">any</span><span class="token operator">&gt;</span> <span class="token punctuation">{</span>
    <span class="token keyword">return</span> <span class="token keyword">of</span><span class="token punctuation">(</span><span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>

  <span class="token function">deleteUserData</span><span class="token punctuation">(</span>vin<span class="token operator">:</span> <span class="token builtin">string</span><span class="token punctuation">,</span> referenceVin<span class="token operator">:</span> <span class="token builtin">string</span><span class="token punctuation">)</span><span class="token operator">:</span> Observable<span class="token operator">&lt;</span><span class="token builtin">any</span><span class="token operator">&gt;</span> <span class="token punctuation">{</span>
    <span class="token keyword">return</span> <span class="token keyword">of</span><span class="token punctuation">(</span><span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>

<span class="token function">describe</span><span class="token punctuation">(</span><span class="token string">'UserComponent'</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
  <span class="token keyword">let</span> component<span class="token operator">:</span> UserComponent<span class="token punctuation">;</span>
  <span class="token keyword">let</span> fixture<span class="token operator">:</span> ComponentFixture<span class="token operator">&lt;</span>UserComponent<span class="token operator">&gt;</span><span class="token punctuation">;</span>
  <span class="token keyword">let</span> store<span class="token operator">:</span> Store<span class="token operator">&lt;</span>AppState<span class="token operator">&gt;</span><span class="token punctuation">;</span>
  <span class="token comment">// 这是一种模拟service的方法</span>
  <span class="token keyword">let</span> mockMessageService<span class="token operator">:</span> MessageService<span class="token punctuation">;</span>
  <span class="token keyword">let</span> storeSelectSpy<span class="token operator">:</span> jasmine<span class="token punctuation">.</span>Spy<span class="token punctuation">;</span>
  <span class="token keyword">let</span> mockDialog<span class="token operator">:</span> jasmine<span class="token punctuation">.</span>SpyObj<span class="token operator">&lt;</span>MatDialog<span class="token operator">&gt;</span><span class="token punctuation">;</span>
  <span class="token comment">// 这是另一种模拟service的方法</span>
  <span class="token keyword">let</span> userWhiteListServiceSpy<span class="token operator">:</span> jasmine<span class="token punctuation">.</span>SpyObj<span class="token operator">&lt;</span>UserWhiteListService<span class="token operator">&gt;</span><span class="token punctuation">;</span>
  <span class="token comment">// 模拟router</span>
  <span class="token keyword">let</span> mockRouter <span class="token operator">=</span> <span class="token punctuation">{</span>
    navigate<span class="token operator">:</span> jasmine<span class="token punctuation">.</span><span class="token function">createSpy</span><span class="token punctuation">(</span><span class="token string">'navigate'</span><span class="token punctuation">)</span>
  <span class="token punctuation">}</span><span class="token punctuation">;</span>
  <span class="token comment">// 模拟TranslateService</span>
  <span class="token keyword">const</span> mockTranslationService <span class="token operator">=</span> <span class="token punctuation">{</span>
    <span class="token function">validateLanguage</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span><span class="token punctuation">}</span>
  <span class="token punctuation">}</span><span class="token punctuation">;</span>

  <span class="token function">beforeEach</span><span class="token punctuation">(</span><span class="token keyword">async</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
    TestBed<span class="token punctuation">.</span><span class="token function">configureTestingModule</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
      declarations<span class="token operator">:</span> <span class="token punctuation">[</span>UserComponent<span class="token punctuation">,</span> AuthDirective<span class="token punctuation">]</span><span class="token punctuation">,</span>
      imports<span class="token operator">:</span> <span class="token punctuation">[</span>
        StoreModule<span class="token punctuation">.</span><span class="token function">forRoot</span><span class="token punctuation">(</span><span class="token punctuation">{</span> admin<span class="token operator">:</span> adminReducer <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
        <span class="token comment">// mock Translate 服务</span>
        TranslateModule<span class="token punctuation">.</span><span class="token function">forRoot</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
          loader<span class="token operator">:</span> <span class="token punctuation">{</span> provide<span class="token operator">:</span> TranslateLoader<span class="token punctuation">,</span> useClass<span class="token operator">:</span> TranslateFakeLoader <span class="token punctuation">}</span><span class="token punctuation">,</span>
        <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
      <span class="token punctuation">]</span><span class="token punctuation">,</span>
      providers<span class="token operator">:</span> <span class="token punctuation">[</span>
        TranslateService<span class="token punctuation">,</span>
        <span class="token comment">// mock MessageService 服务</span>
        <span class="token punctuation">{</span> provide<span class="token operator">:</span> MessageService<span class="token punctuation">,</span> useClass<span class="token operator">:</span> MockMessageService <span class="token punctuation">}</span><span class="token punctuation">,</span>
        <span class="token comment">// mock UserService 服务</span>
        <span class="token punctuation">{</span> provide<span class="token operator">:</span> UserService<span class="token punctuation">,</span> useClass<span class="token operator">:</span> MockUserService <span class="token punctuation">}</span><span class="token punctuation">,</span>
        <span class="token comment">// mock Store 服务，用来模拟用户权限</span>
        <span class="token punctuation">{</span>
          provide<span class="token operator">:</span> Store<span class="token punctuation">,</span>
          useValue<span class="token operator">:</span> <span class="token punctuation">{</span>
            select<span class="token operator">:</span> jasmine<span class="token punctuation">.</span><span class="token function">createSpy</span><span class="token punctuation">(</span><span class="token string">'select'</span><span class="token punctuation">)</span><span class="token punctuation">.</span>and<span class="token punctuation">.</span><span class="token function">returnValue</span><span class="token punctuation">(</span><span class="token keyword">of</span><span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token string">'USER'</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
            pipe<span class="token operator">:</span> jasmine<span class="token punctuation">.</span><span class="token function">createSpy</span><span class="token punctuation">(</span><span class="token string">'pipe'</span><span class="token punctuation">)</span><span class="token punctuation">.</span>and<span class="token punctuation">.</span><span class="token function">returnValue</span><span class="token punctuation">(</span><span class="token keyword">of</span><span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token string">'USER'</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
          <span class="token punctuation">}</span>
        <span class="token punctuation">}</span><span class="token punctuation">,</span>
        <span class="token punctuation">{</span> provide<span class="token operator">:</span> MatDialogRef<span class="token punctuation">,</span> useValue<span class="token operator">:</span> <span class="token punctuation">{</span><span class="token punctuation">}</span> <span class="token punctuation">}</span><span class="token punctuation">,</span>
        <span class="token punctuation">{</span> provide<span class="token operator">:</span> MatDialog<span class="token punctuation">,</span> useValue<span class="token operator">:</span> mockDialog <span class="token punctuation">}</span><span class="token punctuation">,</span>
        <span class="token punctuation">{</span> provide<span class="token operator">:</span> <span class="token constant">MAT_DIALOG_DATA</span><span class="token punctuation">,</span> useValue<span class="token operator">:</span> <span class="token punctuation">{</span><span class="token punctuation">}</span> <span class="token punctuation">}</span><span class="token punctuation">,</span>
        <span class="token punctuation">{</span> provide<span class="token operator">:</span> UserWhiteListService<span class="token punctuation">,</span> useValue<span class="token operator">:</span> userWhiteListServiceSpy <span class="token punctuation">}</span>
      <span class="token punctuation">]</span><span class="token punctuation">,</span>
      schemas<span class="token operator">:</span> <span class="token punctuation">[</span><span class="token constant">NO_ERRORS_SCHEMA</span><span class="token punctuation">]</span><span class="token punctuation">,</span> <span class="token comment">// 忽略未知元素和属性</span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">compileComponents</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

  <span class="token function">beforeEach</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
    fixture <span class="token operator">=</span> TestBed<span class="token punctuation">.</span><span class="token function">createComponent</span><span class="token punctuation">(</span>UserComponent<span class="token punctuation">)</span><span class="token punctuation">;</span>
    component <span class="token operator">=</span> fixture<span class="token punctuation">.</span>componentInstance<span class="token punctuation">;</span>
    mockMessageService <span class="token operator">=</span> TestBed<span class="token punctuation">.</span><span class="token function">inject</span><span class="token punctuation">(</span>MessageService<span class="token punctuation">)</span><span class="token punctuation">;</span>
    MockUserService <span class="token operator">=</span> TestBed<span class="token punctuation">.</span><span class="token function">inject</span><span class="token punctuation">(</span>UserService<span class="token punctuation">)</span><span class="token punctuation">;</span>
    mockDialog <span class="token operator">=</span> jasmine<span class="token punctuation">.</span><span class="token function">createSpyObj</span><span class="token punctuation">(</span><span class="token string">'MatDialog'</span><span class="token punctuation">,</span> <span class="token punctuation">[</span><span class="token string">'open'</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    userWhiteListServiceSpy <span class="token operator">=</span> jasmine<span class="token punctuation">.</span><span class="token function">createSpyObj</span><span class="token punctuation">(</span>
      <span class="token string">'UserWhiteListService'</span><span class="token punctuation">,</span><span class="token punctuation">[</span><span class="token string">'getUserWhiteList'</span><span class="token punctuation">,</span> <span class="token string">'addUserWhiteList'</span><span class="token punctuation">,</span> <span class="token string">'deleteUserWhiteList'</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

    store <span class="token operator">=</span> TestBed<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span>Store<span class="token punctuation">)</span><span class="token punctuation">;</span>
    storeSelectSpy <span class="token operator">=</span> store<span class="token punctuation">.</span>select <span class="token keyword">as</span> jasmine<span class="token punctuation">.</span>Spy<span class="token punctuation">;</span>
    storeSelectSpy<span class="token punctuation">.</span>and<span class="token punctuation">.</span><span class="token function">returnValue</span><span class="token punctuation">(</span><span class="token keyword">of</span><span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token string">'USER'</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

    fixture<span class="token punctuation">.</span><span class="token function">detectChanges</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

  <span class="token function">it</span><span class="token punctuation">(</span><span class="token string">'should create'</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
    <span class="token function">expect</span><span class="token punctuation">(</span>component<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">toBeTruthy</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

  <span class="token function">it</span><span class="token punctuation">(</span><span class="token string">'should call getUserData'</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
    <span class="token comment">// 监听组件的 getUserData 方法，并调用callThrough</span>
    <span class="token keyword">const</span> spy <span class="token operator">=</span> <span class="token function">spyOn</span><span class="token punctuation">(</span>component<span class="token punctuation">,</span> <span class="token string">'getUserData'</span><span class="token punctuation">)</span><span class="token punctuation">.</span>and<span class="token punctuation">.</span><span class="token function">callThrough</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    component<span class="token punctuation">.</span><span class="token function">getUserData</span><span class="token punctuation">(</span><span class="token string">'vin'</span><span class="token punctuation">,</span> <span class="token string">'referenceVin'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token function">expect</span><span class="token punctuation">(</span>spy<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">toHaveBeenCalled</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

  <span class="token function">it</span><span class="token punctuation">(</span><span class="token string">'should have user button and the user button can be clicked'</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
    <span class="token keyword">const</span> compiled <span class="token operator">=</span> fixture<span class="token punctuation">.</span>debugElement<span class="token punctuation">.</span>nativeElement<span class="token punctuation">;</span>
    <span class="token keyword">const</span> userBtn <span class="token operator">=</span> compiled<span class="token punctuation">.</span><span class="token function">querySelector</span><span class="token punctuation">(</span><span class="token string">'#user-btn'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token function">expect</span><span class="token punctuation">(</span>userBtn<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">toBeTruthy</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token comment">// 防止点击不了</span>
    userBtn<span class="token punctuation">.</span><span class="token function">removeAttribute</span><span class="token punctuation">(</span><span class="token string">'disabled'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    userBtn<span class="token punctuation">.</span><span class="token function">click</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token comment">// 假设组件上有一个 userBtnClicked 属性，用来标识用户按钮是否被点击</span>
    <span class="token function">expect</span><span class="token punctuation">(</span>component<span class="token punctuation">.</span>userBtnClicked<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">toBeTrue</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

  <span class="token function">it</span><span class="token punctuation">(</span><span class="token string">'should convert input to upper case'</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
    <span class="token comment">// 模拟点击事件对象</span>
    <span class="token keyword">const</span> eventMock <span class="token operator">=</span> <span class="token punctuation">{</span>
      target<span class="token operator">:</span> <span class="token punctuation">{</span>
        value<span class="token operator">:</span> <span class="token string">'5yj3e1ea7LF000316'</span><span class="token punctuation">,</span>
        <span class="token function-variable function">toUpperCase</span><span class="token operator">:</span> <span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
          <span class="token keyword">this</span><span class="token punctuation">.</span>value <span class="token operator">=</span> <span class="token keyword">this</span><span class="token punctuation">.</span>value<span class="token punctuation">.</span><span class="token function">toUpperCase</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
      <span class="token punctuation">}</span>
    <span class="token punctuation">}</span><span class="token punctuation">;</span>
    component<span class="token punctuation">.</span><span class="token function">toUpper</span><span class="token punctuation">(</span>eventMock<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token function">expect</span><span class="token punctuation">(</span>eventMock<span class="token punctuation">.</span>target<span class="token punctuation">.</span>value<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">toBe</span><span class="token punctuation">(</span><span class="token string">'5YJ3E1EA7LF000316'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

  <span class="token function">it</span><span class="token punctuation">(</span><span class="token string">'should show error message when search is not successful'</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
    <span class="token comment">// 模拟 UserService 的 getUserData 方法返回一个错误，返回值可以自定义</span>
    <span class="token function">spyOn</span><span class="token punctuation">(</span>MockUserService<span class="token punctuation">,</span> <span class="token string">'getUserData'</span><span class="token punctuation">)</span><span class="token punctuation">.</span>and<span class="token punctuation">.</span><span class="token function">returnValue</span><span class="token punctuation">(</span>
      <span class="token keyword">of</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
        status<span class="token operator">:</span> <span class="token string">'success'</span><span class="token punctuation">,</span>
        code<span class="token operator">:</span> <span class="token string">'500'</span><span class="token punctuation">,</span>
        payload<span class="token operator">:</span> <span class="token keyword">null</span><span class="token punctuation">,</span>
        message<span class="token operator">:</span> <span class="token string">'Error'</span>
      <span class="token punctuation">}</span> <span class="token keyword">as</span> <span class="token builtin">any</span><span class="token punctuation">)</span>
    <span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token function">spyOn</span><span class="token punctuation">(</span>mockMessageService<span class="token punctuation">,</span> <span class="token string">'showErrorMessage'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

    component<span class="token punctuation">.</span>vinForm<span class="token punctuation">.</span>controls<span class="token punctuation">[</span><span class="token string">'vin'</span><span class="token punctuation">]</span><span class="token punctuation">.</span><span class="token function">setValue</span><span class="token punctuation">(</span><span class="token string">'ABC1A23C6L3309793'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    component<span class="token punctuation">.</span>vinForm<span class="token punctuation">.</span>controls<span class="token punctuation">[</span><span class="token string">'seller'</span><span class="token punctuation">]</span><span class="token punctuation">.</span><span class="token function">setValue</span><span class="token punctuation">(</span><span class="token string">'CBANEEF8Z19111804'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    component<span class="token punctuation">.</span><span class="token function">search</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token function">expect</span><span class="token punctuation">(</span>MockUserService<span class="token punctuation">.</span>getUserData<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">toHaveBeenCalled</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token function">expect</span><span class="token punctuation">(</span>component<span class="token punctuation">.</span>useData<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">toBeFalsy</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token function">expect</span><span class="token punctuation">(</span>component<span class="token punctuation">.</span>uerData<span class="token punctuation">.</span>name<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">toEqual</span><span class="token punctuation">(</span><span class="token string">''</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token function">expect</span><span class="token punctuation">(</span>mockMessageService<span class="token punctuation">.</span>showErrorMessage<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">toHaveBeenCalledWith</span><span class="token punctuation">(</span><span class="token string">'Error'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

  <span class="token function">it</span><span class="token punctuation">(</span><span class="token string">'should trigger file download and return &quot;success&quot; if response contains file data'</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
    <span class="token keyword">const</span> mockResponse <span class="token operator">=</span> <span class="token punctuation">{</span>
      headers<span class="token operator">:</span> <span class="token punctuation">{</span>
        <span class="token function-variable function">get</span><span class="token operator">:</span> <span class="token punctuation">(</span>header<span class="token operator">:</span> <span class="token builtin">string</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
          <span class="token keyword">if</span> <span class="token punctuation">(</span>header <span class="token operator">===</span> <span class="token string">'Content-Type'</span><span class="token punctuation">)</span> <span class="token keyword">return</span> <span class="token string">'application/pdf'</span><span class="token punctuation">;</span>
          <span class="token keyword">if</span> <span class="token punctuation">(</span>header <span class="token operator">===</span> <span class="token string">'Content-Disposition'</span><span class="token punctuation">)</span> <span class="token keyword">return</span> <span class="token string">'attachment; fileName=test.pdf'</span><span class="token punctuation">;</span>
          <span class="token keyword">return</span> <span class="token keyword">null</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
      <span class="token punctuation">}</span><span class="token punctuation">,</span>
      body<span class="token operator">:</span> <span class="token string">'fileData'</span>
    <span class="token punctuation">}</span><span class="token punctuation">;</span>
    <span class="token function">spyOn</span><span class="token punctuation">(</span>document<span class="token punctuation">.</span>body<span class="token punctuation">,</span> <span class="token string">'appendChild'</span><span class="token punctuation">)</span><span class="token punctuation">.</span>and<span class="token punctuation">.</span><span class="token function">callThrough</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token function">spyOn</span><span class="token punctuation">(</span>document<span class="token punctuation">.</span>body<span class="token punctuation">,</span> <span class="token string">'removeChild'</span><span class="token punctuation">)</span><span class="token punctuation">.</span>and<span class="token punctuation">.</span><span class="token function">callThrough</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token function">spyOn</span><span class="token punctuation">(</span>window<span class="token punctuation">.</span><span class="token constant">URL</span><span class="token punctuation">,</span> <span class="token string">'createObjectURL'</span><span class="token punctuation">)</span><span class="token punctuation">.</span>and<span class="token punctuation">.</span><span class="token function">returnValue</span><span class="token punctuation">(</span><span class="token string">'blob:test'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

    component<span class="token punctuation">.</span><span class="token function">handleDownloadResponse</span><span class="token punctuation">(</span>mockResponse<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">subscribe</span><span class="token punctuation">(</span><span class="token punctuation">(</span>result<span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
      <span class="token function">expect</span><span class="token punctuation">(</span>result<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">toEqual</span><span class="token punctuation">(</span><span class="token string">'success'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
      <span class="token function">expect</span><span class="token punctuation">(</span>document<span class="token punctuation">.</span>body<span class="token punctuation">.</span>appendChild<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">toHaveBeenCalled</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
      <span class="token function">expect</span><span class="token punctuation">(</span>document<span class="token punctuation">.</span>body<span class="token punctuation">.</span>removeChild<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">toHaveBeenCalled</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
      <span class="token function">expect</span><span class="token punctuation">(</span>window<span class="token punctuation">.</span><span class="token constant">URL</span><span class="token punctuation">.</span>createObjectURL<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">toHaveBeenCalled</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

  <span class="token function">it</span><span class="token punctuation">(</span><span class="token string">'should not delete VIN when confirmation dialog is closed'</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
    <span class="token keyword">const</span> mockDialogRef <span class="token operator">=</span> jasmine<span class="token punctuation">.</span><span class="token function">createSpyObj</span><span class="token punctuation">(</span><span class="token string">'MatDialogRef'</span><span class="token punctuation">,</span> <span class="token punctuation">[</span><span class="token string">'afterClosed'</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token comment">// 模拟 MatDialog 的 open 方法返回一个 MatDialogRef 对象</span>
    mockDialogRef<span class="token punctuation">.</span>afterClosed<span class="token punctuation">.</span>and<span class="token punctuation">.</span><span class="token function">returnValue</span><span class="token punctuation">(</span><span class="token keyword">of</span><span class="token punctuation">(</span><span class="token boolean">false</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    mockDialog<span class="token punctuation">.</span>open<span class="token punctuation">.</span>and<span class="token punctuation">.</span><span class="token function">returnValue</span><span class="token punctuation">(</span>mockDialogRef<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">const</span> userNum <span class="token operator">=</span> <span class="token string">'ABC12345678901234'</span><span class="token punctuation">;</span>

    component<span class="token punctuation">.</span><span class="token function">openDeleteUserConfirmDialog</span><span class="token punctuation">(</span>userNum<span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token function">expect</span><span class="token punctuation">(</span>mockDialogRef<span class="token punctuation">.</span>afterClosed<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">toHaveBeenCalled</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token function">expect</span><span class="token punctuation">(</span>MockUserService<span class="token punctuation">.</span>deleteUserData<span class="token punctuation">)</span><span class="token punctuation">.</span>not<span class="token punctuation">.</span><span class="token function">toHaveBeenCalled</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

  <span class="token function">it</span><span class="token punctuation">(</span><span class="token string">'should add a user to the whitelist'</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
    userWhiteListServiceSpy<span class="token punctuation">.</span>addUserWhiteList<span class="token punctuation">.</span>and<span class="token punctuation">.</span><span class="token function">returnValue</span><span class="token punctuation">(</span><span class="token keyword">of</span><span class="token punctuation">(</span><span class="token punctuation">{</span> status<span class="token operator">:</span> <span class="token string">'success'</span> <span class="token punctuation">}</span> <span class="token keyword">as</span> <span class="token builtin">any</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token comment">// 模拟一个错误的返回值</span>
    <span class="token comment">// const mockResponse = throwError({ status: 500, message: 'Failed' } as any);</span>
    <span class="token keyword">const</span> userNum <span class="token operator">=</span> <span class="token string">'ABC12345678901234'</span><span class="token punctuation">;</span>
    component<span class="token punctuation">.</span><span class="token function">addUserToWhiteList</span><span class="token punctuation">(</span>userNum<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token function">expect</span><span class="token punctuation">(</span>userWhiteListServiceSpy<span class="token punctuation">.</span>addUserWhiteList<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">toHaveBeenCalledWith</span><span class="token punctuation">(</span>userNum<span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br><span class="line-number">28</span><br><span class="line-number">29</span><br><span class="line-number">30</span><br><span class="line-number">31</span><br><span class="line-number">32</span><br><span class="line-number">33</span><br><span class="line-number">34</span><br><span class="line-number">35</span><br><span class="line-number">36</span><br><span class="line-number">37</span><br><span class="line-number">38</span><br><span class="line-number">39</span><br><span class="line-number">40</span><br><span class="line-number">41</span><br><span class="line-number">42</span><br><span class="line-number">43</span><br><span class="line-number">44</span><br><span class="line-number">45</span><br><span class="line-number">46</span><br><span class="line-number">47</span><br><span class="line-number">48</span><br><span class="line-number">49</span><br><span class="line-number">50</span><br><span class="line-number">51</span><br><span class="line-number">52</span><br><span class="line-number">53</span><br><span class="line-number">54</span><br><span class="line-number">55</span><br><span class="line-number">56</span><br><span class="line-number">57</span><br><span class="line-number">58</span><br><span class="line-number">59</span><br><span class="line-number">60</span><br><span class="line-number">61</span><br><span class="line-number">62</span><br><span class="line-number">63</span><br><span class="line-number">64</span><br><span class="line-number">65</span><br><span class="line-number">66</span><br><span class="line-number">67</span><br><span class="line-number">68</span><br><span class="line-number">69</span><br><span class="line-number">70</span><br><span class="line-number">71</span><br><span class="line-number">72</span><br><span class="line-number">73</span><br><span class="line-number">74</span><br><span class="line-number">75</span><br><span class="line-number">76</span><br><span class="line-number">77</span><br><span class="line-number">78</span><br><span class="line-number">79</span><br><span class="line-number">80</span><br><span class="line-number">81</span><br><span class="line-number">82</span><br><span class="line-number">83</span><br><span class="line-number">84</span><br><span class="line-number">85</span><br><span class="line-number">86</span><br><span class="line-number">87</span><br><span class="line-number">88</span><br><span class="line-number">89</span><br><span class="line-number">90</span><br><span class="line-number">91</span><br><span class="line-number">92</span><br><span class="line-number">93</span><br><span class="line-number">94</span><br><span class="line-number">95</span><br><span class="line-number">96</span><br><span class="line-number">97</span><br><span class="line-number">98</span><br><span class="line-number">99</span><br><span class="line-number">100</span><br><span class="line-number">101</span><br><span class="line-number">102</span><br><span class="line-number">103</span><br><span class="line-number">104</span><br><span class="line-number">105</span><br><span class="line-number">106</span><br><span class="line-number">107</span><br><span class="line-number">108</span><br><span class="line-number">109</span><br><span class="line-number">110</span><br><span class="line-number">111</span><br><span class="line-number">112</span><br><span class="line-number">113</span><br><span class="line-number">114</span><br><span class="line-number">115</span><br><span class="line-number">116</span><br><span class="line-number">117</span><br><span class="line-number">118</span><br><span class="line-number">119</span><br><span class="line-number">120</span><br><span class="line-number">121</span><br><span class="line-number">122</span><br><span class="line-number">123</span><br><span class="line-number">124</span><br><span class="line-number">125</span><br><span class="line-number">126</span><br><span class="line-number">127</span><br><span class="line-number">128</span><br><span class="line-number">129</span><br><span class="line-number">130</span><br><span class="line-number">131</span><br><span class="line-number">132</span><br><span class="line-number">133</span><br><span class="line-number">134</span><br><span class="line-number">135</span><br><span class="line-number">136</span><br><span class="line-number">137</span><br><span class="line-number">138</span><br><span class="line-number">139</span><br><span class="line-number">140</span><br><span class="line-number">141</span><br><span class="line-number">142</span><br><span class="line-number">143</span><br><span class="line-number">144</span><br><span class="line-number">145</span><br><span class="line-number">146</span><br><span class="line-number">147</span><br><span class="line-number">148</span><br><span class="line-number">149</span><br><span class="line-number">150</span><br><span class="line-number">151</span><br><span class="line-number">152</span><br><span class="line-number">153</span><br><span class="line-number">154</span><br><span class="line-number">155</span><br><span class="line-number">156</span><br><span class="line-number">157</span><br><span class="line-number">158</span><br><span class="line-number">159</span><br><span class="line-number">160</span><br><span class="line-number">161</span><br><span class="line-number">162</span><br><span class="line-number">163</span><br><span class="line-number">164</span><br><span class="line-number">165</span><br><span class="line-number">166</span><br><span class="line-number">167</span><br><span class="line-number">168</span><br><span class="line-number">169</span><br><span class="line-number">170</span><br><span class="line-number">171</span><br><span class="line-number">172</span><br><span class="line-number">173</span><br><span class="line-number">174</span><br><span class="line-number">175</span><br><span class="line-number">176</span><br><span class="line-number">177</span><br><span class="line-number">178</span><br><span class="line-number">179</span><br><span class="line-number">180</span><br><span class="line-number">181</span><br><span class="line-number">182</span><br><span class="line-number">183</span><br><span class="line-number">184</span><br><span class="line-number">185</span><br><span class="line-number">186</span><br><span class="line-number">187</span><br><span class="line-number">188</span><br><span class="line-number">189</span><br><span class="line-number">190</span><br><span class="line-number">191</span><br><span class="line-number">192</span><br><span class="line-number">193</span><br><span class="line-number">194</span><br><span class="line-number">195</span><br><span class="line-number">196</span><br><span class="line-number">197</span><br><span class="line-number">198</span><br><span class="line-number">199</span><br><span class="line-number">200</span><br><span class="line-number">201</span><br><span class="line-number">202</span><br><span class="line-number">203</span><br><span class="line-number">204</span><br></div></div><h2 id="代理配置"><a href="#代理配置" class="header-anchor">#</a> 代理配置</h2> <p>同 Vue。通过<code>proxy.conf.json</code>文件进行配置。启动项目时添加配置<code>ng serve --proxy-config ./proxy.conf.json</code>。</p> <div class="language-js line-numbers-mode"><pre class="language-js"><code><span class="token punctuation">{</span>
  <span class="token string-property property">&quot;/api/*&quot;</span><span class="token operator">:</span> <span class="token punctuation">{</span>
    <span class="token string-property property">&quot;target&quot;</span><span class="token operator">:</span> <span class="token string">&quot;http://localhost:8080&quot;</span><span class="token punctuation">,</span>
    <span class="token string-property property">&quot;secure&quot;</span><span class="token operator">:</span> <span class="token boolean">false</span><span class="token punctuation">,</span>
    <span class="token string-property property">&quot;changeOrigin&quot;</span><span class="token operator">:</span> <span class="token boolean">true</span><span class="token punctuation">,</span>
    <span class="token string-property property">&quot;pathRewrite&quot;</span><span class="token operator">:</span> <span class="token punctuation">{</span>
      <span class="token string-property property">&quot;^/api&quot;</span><span class="token operator">:</span> <span class="token string">&quot;api&quot;</span>
    <span class="token punctuation">}</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br></div></div><h2 id="对于-material-design-的使用"><a href="#对于-material-design-的使用" class="header-anchor">#</a> 对于 material-design 的使用</h2> <ol><li>一般使用<code>@angular/material</code> 和<code>@angular/cdk</code>，<code>@angular/material</code>是基于<code>@angular/cdk</code> 的，<code>@angular/cdk</code> 是一些基础的组件，<code>@angular/material</code> 是一些高级的组件，<code>@angular/material</code> 会自动安装<code>@angular/cdk</code>。</li></ol> <h3 id="mat-dialog"><a href="#mat-dialog" class="header-anchor">#</a> mat-dialog</h3> <ol><li>open 的时候可以设置宽高，也可以设置 class，然后在全局的 <code>styles.scss</code> 中设置 class 的样式。</li> <li>还可以传入数据，然后在 dialog 中使用。</li></ol> <div class="language-ts line-numbers-mode"><pre class="language-ts"><code><span class="token function">constructor</span><span class="token punctuation">(</span> <span class="token keyword">public</span> dialog<span class="token operator">:</span> MatDialog<span class="token punctuation">)</span> <span class="token punctuation">{</span><span class="token punctuation">}</span>

<span class="token keyword">const</span> dialogRef <span class="token operator">=</span> <span class="token keyword">this</span><span class="token punctuation">.</span>dialog<span class="token punctuation">.</span><span class="token function">open</span><span class="token punctuation">(</span>UserProfileComponent<span class="token punctuation">,</span> <span class="token punctuation">{</span>
  height<span class="token operator">:</span> <span class="token string">&quot;674px&quot;</span><span class="token punctuation">,</span>
  width<span class="token operator">:</span> <span class="token string">&quot;868px&quot;</span><span class="token punctuation">,</span>
  panelClass<span class="token operator">:</span> <span class="token string">&quot;custom-dialog&quot;</span><span class="token punctuation">,</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br></div></div><h3 id="material-table"><a href="#material-table" class="header-anchor">#</a> material-table</h3> <ol><li>可以方便的设置分页等功能</li> <li>Demo</li></ol> <div class="language-html line-numbers-mode"><pre class="language-html"><code><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>div</span> <span class="token attr-name">class</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>wrapper<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>
  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>table</span> <span class="token attr-name">id</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>listTable<span class="token punctuation">&quot;</span></span> <span class="token attr-name">mat-table</span> <span class="token attr-name">[dataSource]</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>tableData<span class="token punctuation">&quot;</span></span> <span class="token attr-name">class</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>mat-elevation-z8<span class="token punctuation">&quot;</span></span> <span class="token attr-name">matSort</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>tr</span> <span class="token attr-name">mat-header-row</span> <span class="token attr-name">*matHeaderRowDef</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>tableColumns<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>tr</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>tr</span> <span class="token attr-name">mat-row</span> <span class="token attr-name">*matRowDef</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>let row; columns: tableColumns<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>tr</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>ng-container</span> <span class="token attr-name">matColumnDef</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>id<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>
      <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>th</span> <span class="token attr-name">mat-header-cell</span> <span class="token attr-name">*matHeaderCellDef</span> <span class="token attr-name">mat-sort-header</span> <span class="token attr-name">sortActionDescription</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>Sort by ID<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>ID<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>th</span><span class="token punctuation">&gt;</span></span>
      <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>td</span> <span class="token attr-name">mat-cell</span> <span class="token attr-name">*matCellDef</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>let t<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>{{ t.id }}<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>td</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>ng-container</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>ng-container</span> <span class="token attr-name">matColumnDef</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>userId<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>
      <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>th</span> <span class="token attr-name">mat-header-cell</span> <span class="token attr-name">*matHeaderCellDef</span> <span class="token attr-name">mat-sort-header</span> <span class="token attr-name">sortActionDescription</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>Sort by User<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>User<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>th</span><span class="token punctuation">&gt;</span></span>
      <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>td</span> <span class="token attr-name">mat-cell</span> <span class="token attr-name">*matCellDef</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>let t<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>{{ t.userId }}<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>td</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>ng-container</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>ng-container</span> <span class="token attr-name">matColumnDef</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>createdTime<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>
      <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>th</span> <span class="token attr-name">mat-header-cell</span> <span class="token attr-name">*matHeaderCellDef</span> <span class="token attr-name">mat-sort-header</span> <span class="token attr-name">sortActionDescription</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>Sort by TimeStamp<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>TimeStamp<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>th</span><span class="token punctuation">&gt;</span></span>
      <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>td</span> <span class="token attr-name">mat-cell</span> <span class="token attr-name">*matCellDef</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>let t<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>{{ t.createdTime }}<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>td</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>ng-container</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>ng-container</span> <span class="token attr-name">matColumnDef</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>operation<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>
      <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>th</span> <span class="token attr-name">mat-header-cell</span> <span class="token attr-name">*matHeaderCellDef</span><span class="token punctuation">&gt;</span></span>Operation<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>th</span><span class="token punctuation">&gt;</span></span>
      <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>td</span> <span class="token attr-name">mat-cell</span> <span class="token attr-name">*matCellDef</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>let t<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>
        &lt;button
          mat-flat-button
          color=&quot;warn&quot;
          (click)=&quot;onConfirm(t.id)&quot;
          Delete
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>button</span><span class="token punctuation">&gt;</span></span>
      <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>td</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>ng-container</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>tr</span> <span class="token attr-name">class</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>mat-row<span class="token punctuation">&quot;</span></span> <span class="token attr-name">*matNoDataRow</span><span class="token punctuation">&gt;</span></span>
      <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>td</span> <span class="token attr-name">class</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>mat-cell no-matched<span class="token punctuation">&quot;</span></span> <span class="token attr-name">colspan</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>2<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>No data...<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>td</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>tr</span><span class="token punctuation">&gt;</span></span>
  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>table</span><span class="token punctuation">&gt;</span></span>
  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>mat-paginator</span> <span class="token attr-name">[pageSizeOptions]</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>[5, 10, 20]<span class="token punctuation">&quot;</span></span> <span class="token attr-name">showFirstLastButtons</span> <span class="token attr-name">aria-label</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>Select page of periodic elements<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>
  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>mat-paginator</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>div</span><span class="token punctuation">&gt;</span></span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br><span class="line-number">28</span><br><span class="line-number">29</span><br><span class="line-number">30</span><br><span class="line-number">31</span><br><span class="line-number">32</span><br><span class="line-number">33</span><br><span class="line-number">34</span><br></div></div><div class="language-ts line-numbers-mode"><pre class="language-ts"><code><span class="token keyword">import</span> <span class="token punctuation">{</span> AfterViewInit<span class="token punctuation">,</span> Component<span class="token punctuation">,</span> OnInit<span class="token punctuation">,</span> ViewChild <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">&quot;@angular/core&quot;</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token punctuation">{</span> MatTableDataSource <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">&quot;@angular/material/table&quot;</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token punctuation">{</span> MatDialog<span class="token punctuation">,</span> MatDialogRef <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">&quot;@angular/material/dialog&quot;</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token punctuation">{</span> MatPaginator <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">&quot;@angular/material/paginator&quot;</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token punctuation">{</span> MatSort <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">&quot;@angular/material/sort&quot;</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token punctuation">{</span> UserService <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">&quot;./user.service&quot;</span><span class="token punctuation">;</span>

<span class="token decorator"><span class="token at operator">@</span><span class="token function">Component</span></span><span class="token punctuation">(</span><span class="token punctuation">{</span>
  selector<span class="token operator">:</span> <span class="token string">&quot;app-user-list&quot;</span><span class="token punctuation">,</span>
  templateUrl<span class="token operator">:</span> <span class="token string">&quot;./user-list.component.html&quot;</span><span class="token punctuation">,</span>
  styleUrls<span class="token operator">:</span> <span class="token punctuation">[</span><span class="token string">&quot;./user-list.component.scss&quot;</span><span class="token punctuation">]</span><span class="token punctuation">,</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>
<span class="token keyword">export</span> <span class="token keyword">class</span> <span class="token class-name">UserListComponent</span> <span class="token keyword">implements</span> <span class="token class-name">OnInit</span><span class="token punctuation">,</span> AfterViewInit <span class="token punctuation">{</span>
  <span class="token decorator"><span class="token at operator">@</span><span class="token function">ViewChild</span></span><span class="token punctuation">(</span>MatPaginator<span class="token punctuation">)</span> paginator<span class="token operator">!</span><span class="token operator">:</span> MatPaginator<span class="token punctuation">;</span>
  <span class="token decorator"><span class="token at operator">@</span><span class="token function">ViewChild</span></span><span class="token punctuation">(</span>MatSort<span class="token punctuation">)</span> sort<span class="token operator">!</span><span class="token operator">:</span> MatSort<span class="token punctuation">;</span>
  tableData<span class="token operator">:</span> <span class="token builtin">any</span><span class="token punctuation">[</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">;</span>
  <span class="token comment">// 设置表头，这里的 id、userId、createdTime、operation 需要和 tableData 中的 key 一致，注意顺序</span>
  tableColumns<span class="token operator">:</span> <span class="token builtin">string</span><span class="token punctuation">[</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token string">&quot;id&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;userId&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;createdTime&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;operation&quot;</span><span class="token punctuation">]</span><span class="token punctuation">;</span>

  <span class="token function">constructor</span><span class="token punctuation">(</span><span class="token keyword">private</span> userService<span class="token operator">:</span> UserService<span class="token punctuation">)</span> <span class="token punctuation">{</span><span class="token punctuation">}</span>

  <span class="token function">ngOnInit</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">this</span><span class="token punctuation">.</span>userService<span class="token punctuation">.</span><span class="token function">getUserList</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">subscribe</span><span class="token punctuation">(</span><span class="token punctuation">(</span>data<span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
      <span class="token keyword">this</span><span class="token punctuation">.</span>tableData <span class="token operator">=</span> data<span class="token punctuation">;</span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>

  <span class="token function">ngAfterViewInit</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">this</span><span class="token punctuation">.</span>dataSource<span class="token punctuation">.</span>paginator <span class="token operator">=</span> <span class="token keyword">this</span><span class="token punctuation">.</span>paginator<span class="token punctuation">;</span>
    <span class="token keyword">this</span><span class="token punctuation">.</span>dataSource<span class="token punctuation">.</span>sort <span class="token operator">=</span> <span class="token keyword">this</span><span class="token punctuation">.</span>sort<span class="token punctuation">;</span>
    <span class="token comment">// 设置排序规则</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>tableData<span class="token punctuation">.</span>paginator<span class="token punctuation">)</span> <span class="token punctuation">{</span>
      <span class="token keyword">this</span><span class="token punctuation">.</span>tableData<span class="token punctuation">.</span>paginator<span class="token punctuation">.</span><span class="token function">firstPage</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
  <span class="token punctuation">}</span>

  <span class="token function">onConfirm</span><span class="token punctuation">(</span>id<span class="token operator">:</span> <span class="token builtin">string</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">this</span><span class="token punctuation">.</span>userService<span class="token punctuation">.</span><span class="token function">deleteUser</span><span class="token punctuation">(</span>id<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">subscribe</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
      <span class="token keyword">this</span><span class="token punctuation">.</span>tableData <span class="token operator">=</span> <span class="token keyword">this</span><span class="token punctuation">.</span>tableData<span class="token punctuation">.</span><span class="token function">filter</span><span class="token punctuation">(</span><span class="token punctuation">(</span>item<span class="token punctuation">)</span> <span class="token operator">=&gt;</span> item<span class="token punctuation">.</span>id <span class="token operator">!==</span> id<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br><span class="line-number">28</span><br><span class="line-number">29</span><br><span class="line-number">30</span><br><span class="line-number">31</span><br><span class="line-number">32</span><br><span class="line-number">33</span><br><span class="line-number">34</span><br><span class="line-number">35</span><br><span class="line-number">36</span><br><span class="line-number">37</span><br><span class="line-number">38</span><br><span class="line-number">39</span><br><span class="line-number">40</span><br><span class="line-number">41</span><br><span class="line-number">42</span><br></div></div></div></section> <footer class="page-edit"><!----> <div class="last-updated"><span class="prefix">上次更新: </span> <span class="time">4/13/2025</span></div></footer> <div class="page-nav"><p class="inner"><span class="prev"><a href="/handbook/Skill/FeCli.html" class="prev">
            前端脚手架
          </a></span> <span class="next"><a href="/handbook/Angular/AngularDoc.html">
            Angular 企业实战开发
          </a></span></p></div> <div class="comments-wrapper"><!----></div> <ul class="side-bar sub-sidebar-wrapper" style="width:12rem;" data-v-cb1513f6><li class="level-2" data-v-cb1513f6><a href="/handbook/Angular/Angular.html#笔记" class="sidebar-link reco-side-笔记" data-v-cb1513f6>笔记</a></li><li class="level-2" data-v-cb1513f6><a href="/handbook/Angular/Angular.html#学习" class="sidebar-link reco-side-学习" data-v-cb1513f6>学习</a></li><li class="level-3" data-v-cb1513f6><a href="/handbook/Angular/Angular.html#创建项目" class="sidebar-link reco-side-创建项目" data-v-cb1513f6>创建项目</a></li><li class="level-3" data-v-cb1513f6><a href="/handbook/Angular/Angular.html#生命周期" class="sidebar-link reco-side-生命周期" data-v-cb1513f6>生命周期</a></li><li class="level-3" data-v-cb1513f6><a href="/handbook/Angular/Angular.html#依赖注入-di" class="sidebar-link reco-side-依赖注入-di" data-v-cb1513f6>依赖注入 DI</a></li><li class="level-3" data-v-cb1513f6><a href="/handbook/Angular/Angular.html#组件通信" class="sidebar-link reco-side-组件通信" data-v-cb1513f6>组件通信</a></li><li class="level-3" data-v-cb1513f6><a href="/handbook/Angular/Angular.html#路由传参" class="sidebar-link reco-side-路由传参" data-v-cb1513f6>路由传参</a></li><li class="level-2" data-v-cb1513f6><a href="/handbook/Angular/Angular.html#原理" class="sidebar-link reco-side-原理" data-v-cb1513f6>原理</a></li><li class="level-3" data-v-cb1513f6><a href="/handbook/Angular/Angular.html#平台" class="sidebar-link reco-side-平台" data-v-cb1513f6>平台</a></li><li class="level-3" data-v-cb1513f6><a href="/handbook/Angular/Angular.html#renderer-渲染器" class="sidebar-link reco-side-renderer-渲染器" data-v-cb1513f6>Renderer 渲染器</a></li><li class="level-2" data-v-cb1513f6><a href="/handbook/Angular/Angular.html#使用" class="sidebar-link reco-side-使用" data-v-cb1513f6>使用</a></li><li class="level-3" data-v-cb1513f6><a href="/handbook/Angular/Angular.html#显示-html" class="sidebar-link reco-side-显示-html" data-v-cb1513f6>显示 html</a></li><li class="level-3" data-v-cb1513f6><a href="/handbook/Angular/Angular.html#types-node" class="sidebar-link reco-side-types-node" data-v-cb1513f6>@types/node</a></li><li class="level-3" data-v-cb1513f6><a href="/handbook/Angular/Angular.html#google-fonts" class="sidebar-link reco-side-google-fonts" data-v-cb1513f6>google fonts</a></li><li class="level-2" data-v-cb1513f6><a href="/handbook/Angular/Angular.html#原理-2" class="sidebar-link reco-side-原理-2" data-v-cb1513f6>原理</a></li><li class="level-3" data-v-cb1513f6><a href="/handbook/Angular/Angular.html#angular-的-dom-操作原理" class="sidebar-link reco-side-angular-的-dom-操作原理" data-v-cb1513f6>Angular 的 DOM 操作原理</a></li><li class="level-2" data-v-cb1513f6><a href="/handbook/Angular/Angular.html#技巧" class="sidebar-link reco-side-技巧" data-v-cb1513f6>技巧</a></li><li class="level-3" data-v-cb1513f6><a href="/handbook/Angular/Angular.html#卸载-angular-cli" class="sidebar-link reco-side-卸载-angular-cli" data-v-cb1513f6>卸载@angular-cli</a></li><li class="level-3" data-v-cb1513f6><a href="/handbook/Angular/Angular.html#安装指定版本-angular-cli" class="sidebar-link reco-side-安装指定版本-angular-cli" data-v-cb1513f6>安装指定版本@angular-cli</a></li><li class="level-3" data-v-cb1513f6><a href="/handbook/Angular/Angular.html#在-angular-项目中运行-ngcc-ngc" class="sidebar-link reco-side-在-angular-项目中运行-ngcc-ngc" data-v-cb1513f6>在 Angular 项目中运行 ngcc/ngc</a></li><li class="level-3" data-v-cb1513f6><a href="/handbook/Angular/Angular.html#移除打包时关于文件体积限制的-warning" class="sidebar-link reco-side-移除打包时关于文件体积限制的-warning" data-v-cb1513f6>移除打包时关于文件体积限制的 warning</a></li><li class="level-3" data-v-cb1513f6><a href="/handbook/Angular/Angular.html#踩坑系列" class="sidebar-link reco-side-踩坑系列" data-v-cb1513f6>踩坑系列</a></li><li class="level-3" data-v-cb1513f6><a href="/handbook/Angular/Angular.html#httpclient" class="sidebar-link reco-side-httpclient" data-v-cb1513f6>HttpClient</a></li><li class="level-3" data-v-cb1513f6><a href="/handbook/Angular/Angular.html#使用-store" class="sidebar-link reco-side-使用-store" data-v-cb1513f6>使用 Store</a></li><li class="level-2" data-v-cb1513f6><a href="/handbook/Angular/Angular.html#指令使用" class="sidebar-link reco-side-指令使用" data-v-cb1513f6>指令使用</a></li><li class="level-2" data-v-cb1513f6><a href="/handbook/Angular/Angular.html#renderer2" class="sidebar-link reco-side-renderer2" data-v-cb1513f6>Renderer2</a></li><li class="level-2" data-v-cb1513f6><a href="/handbook/Angular/Angular.html#单元测试" class="sidebar-link reco-side-单元测试" data-v-cb1513f6>单元测试</a></li><li class="level-3" data-v-cb1513f6><a href="/handbook/Angular/Angular.html#测试平台的配置文件" class="sidebar-link reco-side-测试平台的配置文件" data-v-cb1513f6>测试平台的配置文件</a></li><li class="level-3" data-v-cb1513f6><a href="/handbook/Angular/Angular.html#测试用例注意事项" class="sidebar-link reco-side-测试用例注意事项" data-v-cb1513f6>测试用例注意事项</a></li><li class="level-3" data-v-cb1513f6><a href="/handbook/Angular/Angular.html#测试用例示例" class="sidebar-link reco-side-测试用例示例" data-v-cb1513f6>测试用例示例</a></li><li class="level-2" data-v-cb1513f6><a href="/handbook/Angular/Angular.html#代理配置" class="sidebar-link reco-side-代理配置" data-v-cb1513f6>代理配置</a></li><li class="level-2" data-v-cb1513f6><a href="/handbook/Angular/Angular.html#对于-material-design-的使用" class="sidebar-link reco-side-对于-material-design-的使用" data-v-cb1513f6>对于 material-design 的使用</a></li><li class="level-3" data-v-cb1513f6><a href="/handbook/Angular/Angular.html#mat-dialog" class="sidebar-link reco-side-mat-dialog" data-v-cb1513f6>mat-dialog</a></li><li class="level-3" data-v-cb1513f6><a href="/handbook/Angular/Angular.html#material-table" class="sidebar-link reco-side-material-table" data-v-cb1513f6>material-table</a></li></ul></main> <!----></div></div></div></div><div class="global-ui"><div class="back-to-ceiling" style="right:1rem;bottom:6rem;width:2.5rem;height:2.5rem;border-radius:.25rem;line-height:2.5rem;display:none;" data-v-c6073ba8 data-v-c6073ba8><svg t="1574745035067" viewBox="0 0 1024 1024" version="1.1" xmlns="http://www.w3.org/2000/svg" p-id="5404" class="icon" data-v-c6073ba8><path d="M526.60727968 10.90185116a27.675 27.675 0 0 0-29.21455937 0c-131.36607665 82.28402758-218.69155461 228.01873535-218.69155402 394.07834331a462.20625001 462.20625001 0 0 0 5.36959153 69.94390903c1.00431239 6.55289093-0.34802892 13.13561351-3.76865779 18.80351572-32.63518765 54.11355614-51.75690182 118.55860487-51.7569018 187.94566865a371.06718723 371.06718723 0 0 0 11.50484808 91.98906777c6.53300375 25.50556257 41.68394495 28.14064038 52.69160883 4.22606766 17.37162448-37.73630017 42.14135425-72.50938081 72.80769204-103.21549295 2.18761121 3.04276886 4.15646224 6.24463696 6.40373557 9.22774369a1871.4375 1871.4375 0 0 0 140.04691725 5.34970492 1866.36093723 1866.36093723 0 0 0 140.04691723-5.34970492c2.24727335-2.98310674 4.21612437-6.18497483 6.3937923-9.2178004 30.66633723 30.70611158 55.4360664 65.4791928 72.80769147 103.21549355 11.00766384 23.91457269 46.15860503 21.27949489 52.69160879-4.22606768a371.15156223 371.15156223 0 0 0 11.514792-91.99901164c0-69.36717486-19.13165746-133.82216804-51.75690182-187.92578088-3.42062944-5.66790279-4.76302748-12.26056868-3.76865837-18.80351632a462.20625001 462.20625001 0 0 0 5.36959269-69.943909c-0.00994388-166.08943902-87.32547796-311.81420293-218.6915546-394.09823051zM605.93803103 357.87693858a93.93749974 93.93749974 0 1 1-187.89594924 6.1e-7 93.93749974 93.93749974 0 0 1 187.89594924-6.1e-7z" p-id="5405" data-v-c6073ba8></path><path d="M429.50777625 765.63860547C429.50777625 803.39355007 466.44236686 1000.39046097 512.00932183 1000.39046097c45.56695499 0 82.4922232-197.00623328 82.5015456-234.7518555 0-37.75494459-36.9345906-68.35043303-82.4922232-68.34111062-45.57627738-0.00932239-82.52019037 30.59548842-82.51086798 68.34111062z" p-id="5406" data-v-c6073ba8></path></svg></div><div></div></div></div>
    <script src="/assets/js/app.ad4d8bf3.js" defer></script><script src="/assets/js/4.e4a90c70.js" defer></script><script src="/assets/js/3.ad1ccd56.js" defer></script><script src="/assets/js/2.0240bc78.js" defer></script><script src="/assets/js/1.b94e320b.js" defer></script><script src="/assets/js/44.f91643b9.js" defer></script>
  </body>
</html>
