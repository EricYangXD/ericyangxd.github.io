<!DOCTYPE html>
<html lang="zh-CN">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>Nginx基础知识 | 木易的OT</title>
    <meta name="generator" content="VuePress 1.9.10">
    <script>
        (function() {
          if (location.href.indexOf('github.io') > -1 || location.href.indexOf('gitee.io') > -1) {
             location.href = 'https://ericyangxd.top'
           }
        })();
        </script><script type='application/ld+json'>
          {
            "@context": "https://schema.org",
            "@type": "Article",
            "headline": "Nginx基础知识",
            "url": "https://ericyangxd.top/handbook/Skill/Nginx.html",
            "image": [
              "https://ericyangxd.top/logo.png"
              ],
            "datePublished": "2022-05-09T00:00:00.000Z",
            "dateModified": "2025-05-28T00:00:00.000Z",
            "author": [{
                "@type": "Person",
                "name": "EricYangXD",
                "url": "https://github.com/EricYangXD/ericyangxd.github.io"
            }]
          }
      </script>
    <meta name="description" content="前端面试,React,Vue,JavaScript,CSS,HTML,HTTP,HTTPS,websocket,UDP,TCP,Webpack,算法,数据结构,LeetCode,小程序,油猴,计算机网络,NodeJs,Vite,Antdesign,EricYangXD,Eric,Chrome,Android,V8,Mac,git,网络安全,开发技巧,路由,router,诗歌,金句,源码,面试,Docker,Shell,clash,Windows">
    <meta name="keywords" content="Nginx">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    
    <link rel="preload" href="/assets/css/0.styles.82c89da6.css" as="style"><link rel="preload" href="/assets/js/app.2e93e985.js" as="script"><link rel="preload" href="/assets/js/4.e4a90c70.js" as="script"><link rel="preload" href="/assets/js/3.ad1ccd56.js" as="script"><link rel="preload" href="/assets/js/2.0240bc78.js" as="script"><link rel="preload" href="/assets/js/1.b94e320b.js" as="script"><link rel="preload" href="/assets/js/121.74079ff9.js" as="script"><link rel="prefetch" href="/assets/js/10.d09001be.js"><link rel="prefetch" href="/assets/js/100.a8eb9afe.js"><link rel="prefetch" href="/assets/js/101.3e7c0a76.js"><link rel="prefetch" href="/assets/js/102.6bfe7c21.js"><link rel="prefetch" href="/assets/js/103.a092b617.js"><link rel="prefetch" href="/assets/js/104.1512252b.js"><link rel="prefetch" href="/assets/js/105.462f7cf9.js"><link rel="prefetch" href="/assets/js/106.786e458a.js"><link rel="prefetch" href="/assets/js/107.a9a469f0.js"><link rel="prefetch" href="/assets/js/108.bf409bfd.js"><link rel="prefetch" href="/assets/js/109.9bfdd2d4.js"><link rel="prefetch" href="/assets/js/11.74c854af.js"><link rel="prefetch" href="/assets/js/110.6dc35bc5.js"><link rel="prefetch" href="/assets/js/111.8c002877.js"><link rel="prefetch" href="/assets/js/112.ef6a5fe6.js"><link rel="prefetch" href="/assets/js/113.37ce9e7c.js"><link rel="prefetch" href="/assets/js/114.cc8f62e5.js"><link rel="prefetch" href="/assets/js/115.cefcfe3a.js"><link rel="prefetch" href="/assets/js/116.e88eda17.js"><link rel="prefetch" href="/assets/js/117.dcfa52a7.js"><link rel="prefetch" href="/assets/js/118.95384689.js"><link rel="prefetch" href="/assets/js/119.6d6de70c.js"><link rel="prefetch" href="/assets/js/120.5c4a829a.js"><link rel="prefetch" href="/assets/js/122.14bd3b65.js"><link rel="prefetch" href="/assets/js/123.0e4ad1c3.js"><link rel="prefetch" href="/assets/js/124.881c4958.js"><link rel="prefetch" href="/assets/js/125.bda5cff2.js"><link rel="prefetch" href="/assets/js/126.dde4995c.js"><link rel="prefetch" href="/assets/js/127.3c8efb5e.js"><link rel="prefetch" href="/assets/js/128.93dc22e3.js"><link rel="prefetch" href="/assets/js/129.134bfa40.js"><link rel="prefetch" href="/assets/js/130.1f674ec2.js"><link rel="prefetch" href="/assets/js/131.0ec9f7df.js"><link rel="prefetch" href="/assets/js/132.4f45b555.js"><link rel="prefetch" href="/assets/js/133.f11fa78f.js"><link rel="prefetch" href="/assets/js/134.1dab5038.js"><link rel="prefetch" href="/assets/js/135.5a177b65.js"><link rel="prefetch" href="/assets/js/136.fc49f403.js"><link rel="prefetch" href="/assets/js/137.34dab427.js"><link rel="prefetch" href="/assets/js/138.d9eb855f.js"><link rel="prefetch" href="/assets/js/139.924aa069.js"><link rel="prefetch" href="/assets/js/14.14598f8a.js"><link rel="prefetch" href="/assets/js/140.e2fac4ed.js"><link rel="prefetch" href="/assets/js/141.d09c58ae.js"><link rel="prefetch" href="/assets/js/142.acbded7c.js"><link rel="prefetch" href="/assets/js/143.b24b2786.js"><link rel="prefetch" href="/assets/js/144.eedb98fc.js"><link rel="prefetch" href="/assets/js/145.8069138f.js"><link rel="prefetch" href="/assets/js/146.9d7b537a.js"><link rel="prefetch" href="/assets/js/147.07586f9f.js"><link rel="prefetch" href="/assets/js/15.13cca212.js"><link rel="prefetch" href="/assets/js/16.4899876e.js"><link rel="prefetch" href="/assets/js/17.13bc3b8f.js"><link rel="prefetch" href="/assets/js/18.76e876d7.js"><link rel="prefetch" href="/assets/js/19.b5d33ae1.js"><link rel="prefetch" href="/assets/js/20.29dbec92.js"><link rel="prefetch" href="/assets/js/21.96fceba8.js"><link rel="prefetch" href="/assets/js/22.d2b3e267.js"><link rel="prefetch" href="/assets/js/23.64c64b94.js"><link rel="prefetch" href="/assets/js/24.b558a260.js"><link rel="prefetch" href="/assets/js/25.bb57ebb2.js"><link rel="prefetch" href="/assets/js/26.47cd7229.js"><link rel="prefetch" href="/assets/js/27.8d7938d4.js"><link rel="prefetch" href="/assets/js/28.f894eb36.js"><link rel="prefetch" href="/assets/js/29.525cb35a.js"><link rel="prefetch" href="/assets/js/30.cbeef5b7.js"><link rel="prefetch" href="/assets/js/31.51f58f47.js"><link rel="prefetch" href="/assets/js/32.3f80a1ce.js"><link rel="prefetch" href="/assets/js/33.418aa3e9.js"><link rel="prefetch" href="/assets/js/34.ce30b292.js"><link rel="prefetch" href="/assets/js/35.097a405e.js"><link rel="prefetch" href="/assets/js/36.2bca446e.js"><link rel="prefetch" href="/assets/js/37.03c8c74a.js"><link rel="prefetch" href="/assets/js/38.06c1896e.js"><link rel="prefetch" href="/assets/js/39.631eea29.js"><link rel="prefetch" href="/assets/js/40.6119e387.js"><link rel="prefetch" href="/assets/js/41.ef449e99.js"><link rel="prefetch" href="/assets/js/42.835371e5.js"><link rel="prefetch" href="/assets/js/43.a5f1c40c.js"><link rel="prefetch" href="/assets/js/44.8f26d0e0.js"><link rel="prefetch" href="/assets/js/45.a7dc3cc9.js"><link rel="prefetch" href="/assets/js/46.a5197fb7.js"><link rel="prefetch" href="/assets/js/47.704a88e8.js"><link rel="prefetch" href="/assets/js/48.1f4d8b45.js"><link rel="prefetch" href="/assets/js/49.b521da58.js"><link rel="prefetch" href="/assets/js/5.73d03319.js"><link rel="prefetch" href="/assets/js/50.ac3ee5ec.js"><link rel="prefetch" href="/assets/js/51.9f4c51c5.js"><link rel="prefetch" href="/assets/js/52.2d014a7e.js"><link rel="prefetch" href="/assets/js/53.c666929c.js"><link rel="prefetch" href="/assets/js/54.a8079928.js"><link rel="prefetch" href="/assets/js/55.5374dfb1.js"><link rel="prefetch" href="/assets/js/56.3e24b3a2.js"><link rel="prefetch" href="/assets/js/57.39ee9ae6.js"><link rel="prefetch" href="/assets/js/58.9c84fe43.js"><link rel="prefetch" href="/assets/js/59.1b0b4a7c.js"><link rel="prefetch" href="/assets/js/6.ef81b8ef.js"><link rel="prefetch" href="/assets/js/60.6e21d755.js"><link rel="prefetch" href="/assets/js/61.f1763db0.js"><link rel="prefetch" href="/assets/js/62.bed210c2.js"><link rel="prefetch" href="/assets/js/63.79ce65f4.js"><link rel="prefetch" href="/assets/js/64.03e41b9a.js"><link rel="prefetch" href="/assets/js/65.3d49d4b9.js"><link rel="prefetch" href="/assets/js/66.7862995d.js"><link rel="prefetch" href="/assets/js/67.6ddfe45a.js"><link rel="prefetch" href="/assets/js/68.c5532942.js"><link rel="prefetch" href="/assets/js/69.4afa792f.js"><link rel="prefetch" href="/assets/js/7.126283bf.js"><link rel="prefetch" href="/assets/js/70.50c748f1.js"><link rel="prefetch" href="/assets/js/71.a44fc302.js"><link rel="prefetch" href="/assets/js/72.bfbcffc9.js"><link rel="prefetch" href="/assets/js/73.902f943c.js"><link rel="prefetch" href="/assets/js/74.6efbdc3d.js"><link rel="prefetch" href="/assets/js/75.61629e32.js"><link rel="prefetch" href="/assets/js/76.bfb124b3.js"><link rel="prefetch" href="/assets/js/77.df40efe1.js"><link rel="prefetch" href="/assets/js/78.3dda516a.js"><link rel="prefetch" href="/assets/js/79.6a4db5dd.js"><link rel="prefetch" href="/assets/js/8.4a5e8a86.js"><link rel="prefetch" href="/assets/js/80.95bf0884.js"><link rel="prefetch" href="/assets/js/81.44f100c9.js"><link rel="prefetch" href="/assets/js/82.b9460f14.js"><link rel="prefetch" href="/assets/js/83.9ec78603.js"><link rel="prefetch" href="/assets/js/84.cf32c67f.js"><link rel="prefetch" href="/assets/js/85.2bd7a333.js"><link rel="prefetch" href="/assets/js/86.7322403b.js"><link rel="prefetch" href="/assets/js/87.f1a5c41f.js"><link rel="prefetch" href="/assets/js/88.c8a7b918.js"><link rel="prefetch" href="/assets/js/89.f2483947.js"><link rel="prefetch" href="/assets/js/9.ed44c863.js"><link rel="prefetch" href="/assets/js/90.b2dea802.js"><link rel="prefetch" href="/assets/js/91.cb0baddd.js"><link rel="prefetch" href="/assets/js/92.8da1202a.js"><link rel="prefetch" href="/assets/js/93.9d2e3ac0.js"><link rel="prefetch" href="/assets/js/94.e08109c8.js"><link rel="prefetch" href="/assets/js/95.fe699a83.js"><link rel="prefetch" href="/assets/js/96.e6384528.js"><link rel="prefetch" href="/assets/js/97.be707c71.js"><link rel="prefetch" href="/assets/js/98.9dd5c2e4.js"><link rel="prefetch" href="/assets/js/99.8b789e5f.js"><link rel="prefetch" href="/assets/js/vendors~docsearch.52b9ad0c.js">
    <link rel="stylesheet" href="/assets/css/0.styles.82c89da6.css">
  </head>
  <body>
    <div id="app" data-server-rendered="true"><div class="theme-container" data-v-130b300a><div data-v-130b300a><div class="password-shadow password-wrapper-out" style="display:none;" data-v-25ba6db2 data-v-130b300a data-v-130b300a><h3 class="title" data-v-25ba6db2 data-v-25ba6db2>木易的OT</h3> <p class="description" data-v-25ba6db2 data-v-25ba6db2>前端面试,React,Vue,JavaScript,CSS,HTML,HTTP,HTTPS,websocket,UDP,TCP,Webpack,算法,数据结构,LeetCode,小程序,油猴,计算机网络,NodeJs,Vite,Antdesign,EricYangXD,Eric,Chrome,Android,V8,Mac,git,网络安全,开发技巧,路由,router,诗歌,金句,源码,面试,Docker,Shell,clash,Windows</p> <label id="box" class="inputBox" data-v-25ba6db2 data-v-25ba6db2><input type="password" value="" data-v-25ba6db2> <span data-v-25ba6db2>Konck! Knock!</span> <button data-v-25ba6db2>OK</button></label> <div class="footer" data-v-25ba6db2 data-v-25ba6db2><span data-v-25ba6db2><i class="iconfont reco-theme" data-v-25ba6db2></i> <a target="blank" href="https://vuepress-theme-reco.recoluan.com" data-v-25ba6db2>vuePress-theme-reco</a></span> <span data-v-25ba6db2><i class="iconfont reco-copyright" data-v-25ba6db2></i> <a data-v-25ba6db2><span data-v-25ba6db2>EricYangXD</span>
            
          <!---->
          2025
        </a></span></div></div> <div class="hide" data-v-130b300a><header class="navbar" data-v-130b300a><div class="sidebar-button"><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" role="img" viewBox="0 0 448 512" class="icon"><path fill="currentColor" d="M436 124H12c-6.627 0-12-5.373-12-12V80c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12z"></path></svg></div> <a href="/" class="home-link router-link-active"><!----> <span class="site-name">木易的OT</span></a> <div class="links"><div class="color-picker"><a class="color-button"><i class="iconfont reco-color"></i></a> <div class="color-picker-menu" style="display:none;"><div class="mode-options"><h4 class="title">Choose mode</h4> <ul class="color-mode-options"><li class="dark">dark</li><li class="auto active">auto</li><li class="light">light</li></ul></div></div></div> <div class="search-box"><input aria-label="Search" autocomplete="off" spellcheck="false" value=""> <!----></div> <nav class="nav-links can-hide"><div class="nav-item"><a href="/" class="nav-link"><i class="undefined"></i>
  首页
</a></div><div class="nav-item"><div class="dropdown-wrapper"><a class="dropdown-title"><span class="title"><i class="undefined"></i>
      木易的OT
    </span> <span class="arrow right"></span></a> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="https://github.com/EricYangXD" target="_blank" rel="noopener noreferrer" class="nav-link external"><i class="undefined"></i>
  Github
  <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></li><li class="dropdown-item"><!----> <a href="https://juejin.cn/user/2295436007445021" target="_blank" rel="noopener noreferrer" class="nav-link external"><i class="undefined"></i>
  掘金
  <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></li></ul></div></div> <!----></nav></div></header> <div class="sidebar-mask" data-v-130b300a></div> <aside class="sidebar" data-v-130b300a><div class="personal-info-wrapper" data-v-39576ba9 data-v-130b300a><!----> <h3 class="name" data-v-39576ba9>
    EricYangXD
  </h3> <div class="num" data-v-39576ba9><div data-v-39576ba9><h3 data-v-39576ba9>109</h3> <h6 data-v-39576ba9>文章</h6></div> <div data-v-39576ba9><h3 data-v-39576ba9>0</h3> <h6 data-v-39576ba9>标签</h6></div></div> <ul class="social-links" data-v-39576ba9></ul> <hr data-v-39576ba9></div> <nav class="nav-links"><div class="nav-item"><a href="/" class="nav-link"><i class="undefined"></i>
  首页
</a></div><div class="nav-item"><div class="dropdown-wrapper"><a class="dropdown-title"><span class="title"><i class="undefined"></i>
      木易的OT
    </span> <span class="arrow right"></span></a> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="https://github.com/EricYangXD" target="_blank" rel="noopener noreferrer" class="nav-link external"><i class="undefined"></i>
  Github
  <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></li><li class="dropdown-item"><!----> <a href="https://juejin.cn/user/2295436007445021" target="_blank" rel="noopener noreferrer" class="nav-link external"><i class="undefined"></i>
  掘金
  <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></li></ul></div></div> <!----></nav> <ul class="sidebar-links"><li><section class="sidebar-group collapsable depth-0"><a href="/" class="sidebar-heading clickable router-link-active"><span>About</span> <span class="arrow right"></span></a> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>Android</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>React</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>Vue</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>LeetCode</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>JavaScript</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>CSS</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>AntDesign</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>小程序</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>Webpack</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading open"><span>开发技巧</span> <span class="arrow down"></span></p> <ul class="sidebar-links sidebar-group-items"><li><a href="/handbook/Skill/DevelopmentSkills.html" class="sidebar-link">前端常用开发技巧</a></li><li><a href="/handbook/Skill/Linux.html" class="sidebar-link">Linux常用命令</a></li><li><a href="/handbook/Skill/Nginx.html" aria-current="page" class="active sidebar-link">Nginx</a></li><li><a href="/handbook/Skill/Python.html" class="sidebar-link">Python</a></li><li><a href="/handbook/Skill/Shell.html" class="sidebar-link">Shell笔记</a></li><li><a href="/handbook/Skill/ShellPractice.html" class="sidebar-link">Shell每日一练</a></li><li><a href="/handbook/Skill/MicroFE.html" class="sidebar-link">微前端</a></li><li><a href="/handbook/Skill/Windows.html" class="sidebar-link">Windows</a></li><li><a href="/handbook/Skill/VSCode.html" class="sidebar-link">VSCode</a></li><li><a href="/handbook/Skill/Aliyun.html" class="sidebar-link">阿里云ACP</a></li><li><a href="/handbook/Skill/FixBugs.html" class="sidebar-link">Bugs问题记录</a></li><li><a href="/handbook/Skill/Photograph.html" class="sidebar-link">摄影笔记</a></li><li><a href="/handbook/Skill/Emoji.html" class="sidebar-link">Emoji表情</a></li><li><a href="/handbook/Skill/Tauri.html" class="sidebar-link">Tauri</a></li><li><a href="/handbook/Skill/Prisma.html" class="sidebar-link">Prisma</a></li><li><a href="/handbook/Skill/FeCli.html" class="sidebar-link">前端脚手架</a></li></ul></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>Angular</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>Backend（Java Based）</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>Docker</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>油猴</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>计算机网络</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>Nodejs</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>Vite</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>Web安全</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>Google Chrome V8</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>Git</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>Mac使用记录</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>文章诗句</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>Office软件</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>股海浮沉</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>打工人须知</span> <span class="arrow right"></span></p> <!----></section></li></ul> </aside> <div class="password-shadow password-wrapper-in" style="display:none;" data-v-25ba6db2 data-v-130b300a><h3 class="title" data-v-25ba6db2 data-v-25ba6db2>Nginx基础知识</h3> <!----> <label id="box" class="inputBox" data-v-25ba6db2 data-v-25ba6db2><input type="password" value="" data-v-25ba6db2> <span data-v-25ba6db2>Konck! Knock!</span> <button data-v-25ba6db2>OK</button></label> <div class="footer" data-v-25ba6db2 data-v-25ba6db2><span data-v-25ba6db2><i class="iconfont reco-theme" data-v-25ba6db2></i> <a target="blank" href="https://vuepress-theme-reco.recoluan.com" data-v-25ba6db2>vuePress-theme-reco</a></span> <span data-v-25ba6db2><i class="iconfont reco-copyright" data-v-25ba6db2></i> <a data-v-25ba6db2><span data-v-25ba6db2>EricYangXD</span>
            
          <!---->
          2025
        </a></span></div></div> <div data-v-130b300a><main class="page"><section><div class="page-title"><h1 class="title">Nginx基础知识</h1> <div data-v-f875f3fc><i class="iconfont reco-account" data-v-f875f3fc><span data-v-f875f3fc>EricYangXD</span></i> <i class="iconfont reco-date" data-v-f875f3fc><span data-v-f875f3fc>2022/5/9</span></i> <i class="iconfont reco-eye" data-v-f875f3fc><span id="/handbook/Skill/Nginx.html" data-flag-title="Your Article Title" class="leancloud-visitors" data-v-f875f3fc><a class="leancloud-visitors-count" style="font-size:.9rem;font-weight:normal;color:#999;"></a></span></i> <!----></div></div> <div class="theme-reco-content content__default"><h2 id="nginx-是什么"><a href="#nginx-是什么" class="header-anchor">#</a> Nginx 是什么</h2> <p>Nginx (engine x) 是一个轻量级、高性能的 HTTP 服务器和反向代理服务器，同时也是一个通用代理服务器(TCP/UDP/IMAP/POP3/SMTP)。</p> <h3 id="优势"><a href="#优势" class="header-anchor">#</a> 优势</h3> <ol><li>Nginx 是一个高性能的 Web 服务器，它非常的轻量级，消耗的 CPU、内存很少；</li> <li>Nginx 采用“master/workers”进程池架构，不使用多线程，消除了进程、线程切换的成本；</li> <li>Nginx 基于 epoll 实现了“I/O 多路复用”，不会阻塞，所以性能很高；</li> <li>Nginx 使用了“职责链”模式，多个模块分工合作，自由组合，以流水线的方式处理 HTTP 请求。</li> <li>是一个轻量级、高性能的 HTTP 服务器和反向代理服务器，占用内存少，并发能力强，nginx 的并发能力要比在同类型的网页服务器中表现要好</li> <li>专为性能优化而开发，最重要的要求便是性能，且十分注重效率，有报告 nginx 能支持高达 50000 个并发连接数</li></ol> <h3 id="缺点"><a href="#缺点" class="header-anchor">#</a> 缺点</h3> <p>Nginx 的服务管理思路延续了当时的流行做法，使用磁盘上的静态配置文件，所以每次修改后必须重启才能生效。</p> <p>这在业务频繁变动的时候是非常致命的（例如流行的微服务架构），特别是对于拥有成千上万台服务器的网站来说，仅仅增加或者删除一行配置就要分发、重启所有的机器，对运维是一个非常大的挑战，要耗费很多的时间和精力，成本很高，很不灵活，难以“随需应变”。</p> <h3 id="正向代理和反向代理"><a href="#正向代理和反向代理" class="header-anchor">#</a> 正向代理和反向代理</h3> <ol><li>正向代理：局域网中的用户想要直接访问网络是不可行的，只能通过代理服务器（Server）来访问，这种代理服务就被称为正向代理。代理服务器代理的是客户端。客户端向代理服务器发送请求，代理服务器再将请求转发给目标服务器，并将服务器的响应返回给客户端。正向代理可以隐藏客户端的真实 IP 地址，提供匿名访问和访问控制等功能。它常用于跨越防火墙访问互联网、访问被封禁的网站等情况。</li> <li>反向代理：客户端无法感知代理，因为客户端访问网络不需要配置，只要把请求发送到反向代理服务器，由反向代理服务器去选择目标服务器获取数据，然后再返回到客户端，此时反向代理服务器和目标服务器对外就是一个服务器，暴露的是代理服务器地址，隐藏了真实服务器 IP 地址。代理服务器代理的是真正的服务端。客户端并不直接访问后端服务器，而是通过反向代理服务器来获取服务。反向代理可以实现负载均衡、高可用性和安全性等功能。它常用于网站的高并发访问、保护后端服务器、提供缓存和 SSL 终止等功能。</li></ol> <h3 id="负载均衡"><a href="#负载均衡" class="header-anchor">#</a> 负载均衡</h3> <p>负载均衡：是高可用网络基础架构的关键组件，通常用于将工作负载分布到多个服务器来提高网站、应用、数据库或其他服务的性能和可靠性。</p> <h3 id="动静分离"><a href="#动静分离" class="header-anchor">#</a> 动静分离</h3> <p>常用的 Web 服务器有：Tomcat、Nginx。动静分离即把静态资源（如 html、css、图片等）放在一台服务器，把动态资源（后端服务等）放在另外的服务器。</p> <ol><li>直接为静态内容设置一个别名或根目录：</li></ol> <div class="language-bash line-numbers-mode"><pre class="language-bash"><code>location ~* .<span class="token punctuation">(</span>jpg<span class="token operator">|</span>jpeg<span class="token operator">|</span>png<span class="token operator">|</span>gif<span class="token operator">|</span>ico<span class="token operator">|</span>css<span class="token operator">|</span>js<span class="token punctuation">)</span>$ <span class="token punctuation">{</span>
    root /path/to/static/files<span class="token punctuation">;</span>
    expires 30d<span class="token punctuation">;</span>  <span class="token comment"># 设置缓存时间</span>
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br></div></div><p>所有的静态文件都被存放在/path/to/static/files 目录下。expires 指令设置了静态文件的缓存时间。 2. 使用 alias 别名指定静态文件的实际路径：</p> <div class="language-bash line-numbers-mode"><pre class="language-bash"><code>location /static/ <span class="token punctuation">{</span>
    <span class="token builtin class-name">alias</span> /path/to/static/files/<span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br></div></div><p>URL 中的<code>/static/</code>会映射到文件系统的<code>/path/to/static/files/</code>。 3. 代理动态内容将请求代理到后端的应用服务器，如 Tomcat、uWSGI 等。：</p> <div class="language-bash line-numbers-mode"><pre class="language-bash"><code>location / <span class="token punctuation">{</span>
    proxy_pass http://backend_server_address<span class="token punctuation">;</span>
    proxy_set_header Host <span class="token variable">$host</span><span class="token punctuation">;</span>
    proxy_set_header X-Real-IP <span class="token variable">$remote_addr</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br></div></div><ul><li>确保你的静态文件路径配置正确，避免 404 错误。</li> <li>使用 expires 指令为静态内容设置缓存，这可以减少服务器的负载并提高页面加载速度。</li> <li>动静分离不仅可以提高服务器的响应速度，还可以减少后端服务器的压力，因为静态文件通常由 Nginx 直接处理，而不需要代理到后端服务器。</li></ul> <h3 id="常用的命令"><a href="#常用的命令" class="header-anchor">#</a> 常用的命令</h3> <ul><li>查看版本：<code>./nginx -v</code></li> <li>启动：<code>./nginx</code></li> <li>快速关闭：<code>./nginx -s stop</code>(推荐) 或 有序停止<code>./nginx -s quit</code></li> <li>重新加载 nginx 配置：<code>./nginx -s reload</code></li> <li>直接杀死 nginx 进程：<code>killall nginx</code></li> <li><code>nginx -s start</code></li> <li>重启 nginx：<code>nginx -t</code></li></ul> <h3 id="nginx-的配置文件"><a href="#nginx-的配置文件" class="header-anchor">#</a> Nginx 的配置文件</h3> <p>配置文件分为三个模块：</p> <ul><li>全局块：从配置文件开始到 events 块之间，主要是设置一些影响 nginx 服务器整体运行的配置指令。（按道理说：并发处理服务的配置时，值越大，可支持的并发处理量越多，但此时会受到硬件、软件等设备等的制约）</li> <li>events 块：影响 nginx 服务器与用户的网络连接，常用的设置包括是否开启对多 workprocess 下的网络连接进行序列化，是否允许同时接收多个网络连接等等</li> <li>http 块：如反向代理和负载均衡都在此配置</li></ul> <h4 id="location-的匹配规则"><a href="#location-的匹配规则" class="header-anchor">#</a> location 的匹配规则</h4> <p>共有四种方式：<code>location[ = | ~ | ~* | ^~ ] uri {...}</code>:</p> <ol><li><code>=</code> ：精确匹配，用于不含正则表达式的 url 前，要求字符串与 url 严格匹配，<strong>完全相等</strong>时，才能停止向下搜索并处理请求。</li> <li><code>^~</code>：用于不含正则表达式的 url 前，要求 nginx 服务器找到表示 url 和字符串<strong>匹配度最高</strong>的 location 后，立即使用此 location 处理请求，而不再匹配。表示 uri 以某个字符串开头</li> <li><code>~</code> ：最佳匹配，用于表示 url 包含正则表达式，并且区分大小写，<strong>匹配到就停止</strong></li> <li><code>~*</code>：与~一样，只是不区分大小写，<strong>匹配到就停止</strong></li> <li><code>/</code>：不使用上面四种时，表示<strong>通用匹配</strong>，每个 URI 都能匹配成功</li> <li><code>!~</code>：区分大小写，不匹配</li> <li><code>!~*</code>：不区分大小写，不匹配</li> <li><code>uri</code>：匹配的网站地址</li> <li><code>{...}</code>：匹配 uri 后要执行的配置段</li></ol> <p>注意:</p> <ul><li>如果 url 包含正则表达式，则不需要 <code>~</code> 作为开头表示</li> <li>nginx 的匹配具有优先顺序，一旦匹配上就会立马退出，不再进行向下匹配</li></ul> <p>location 的定义分为两种：</p> <ul><li>前缀字符串（prefix string）</li> <li>正则表达式（regular expression），具体为前面带 <code>~*</code> 和 <code>~</code> 修饰符的</li></ul> <p>而匹配 location 的顺序为：</p> <ol><li>检查使用前缀字符串的 locations，在使用前缀字符串的 locations 中选择最长匹配的，并将结果进行储存</li> <li>如果符合带有 <code>=</code> 修饰符的 URI，则立刻停止匹配</li> <li>如果符合带有 <code>^~</code> 修饰符的 URI，则也立刻停止匹配。</li> <li>然后按照定义文件的顺序，检查正则表达式，匹配到就停止</li> <li>当正则表达式匹配不到的时候，使用之前储存的前缀字符串</li></ol> <p>再总结一下就是：</p> <ol><li>在顺序上，前缀字符串顺序不重要，按照匹配长度来确定，正则表达式则按照定义顺序。</li> <li>在优先级上，<code>=</code> 修饰符最高，<code>^~</code> 次之，再者是<code>正则</code>，最后是<code>前缀字符串</code>匹配。</li> <li>如果没写这个前缀匹配，那么如果匹配到之后，会先暂存当前命中的匹配，然后继续向下匹配，如果有其他匹配命中，就用其他匹配，否则才会用这个暂存的匹配。</li></ol> <h4 id="server-name-的匹配顺序"><a href="#server-name-的匹配顺序" class="header-anchor">#</a> server_name 的匹配顺序</h4> <p><code>server_name</code>的匹配顺序是怎样的呢？</p> <p>按照如下顺序匹配--匹配顺序: -&gt; 精确匹配 -&gt; <code>*</code>在前的域名 -&gt; <code>*</code>在后的域名 -&gt; 按文件中的顺序匹配 -&gt; <code>default server</code>:第一个，listen 指定 default。</p> <h4 id="配置-rewrite"><a href="#配置-rewrite" class="header-anchor">#</a> 配置 rewrite</h4> <ol><li>语法如下：</li></ol> <div class="language-bash line-numbers-mode"><pre class="language-bash"><code>指令语法：rewrite regex replacement<span class="token punctuation">[</span>flag<span class="token punctuation">]</span><span class="token punctuation">;</span>
默认值：none
应用位置：server、location、if
rewrite是实现URL重定向的重要指令，他根据regex<span class="token punctuation">(</span>正则表达式<span class="token punctuation">)</span>来匹配内容跳转到replacement，结尾是flag标记.
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br></div></div><table><thead><tr><th>flag 标记</th> <th>说明</th></tr></thead> <tbody><tr><td>last</td> <td>本条规则匹配完成后继续向下匹配新的 location URI 规则</td></tr> <tr><td>break</td> <td>本条规则匹配完成后终止，不再匹配任务规则</td></tr> <tr><td>redirect</td> <td>返回 302 临时重定向</td></tr> <tr><td>permanent</td> <td>返回 301 永久重定向</td></tr></tbody></table> <ol start="2"><li>重定向：</li></ol> <ul><li>返回 code:</li></ul> <div class="language-bash line-numbers-mode"><pre class="language-bash"><code>location / <span class="token punctuation">{</span>
    <span class="token builtin class-name">return</span> <span class="token number">301</span> https://www.xxxx.com<span class="token variable">$request_uri</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br></div></div><ul><li>通过$request_uri 变量匹配所有的 URI:</li></ul> <div class="language-bash line-numbers-mode"><pre class="language-bash"><code>rewrite ^ https://www.xxxx.com<span class="token variable">$request_uri</span>? permanent<span class="token punctuation">;</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div><ul><li>通过正则匹配所有的 URI 后再去掉开头第一个/(反斜线):</li></ul> <div class="language-bash line-numbers-mode"><pre class="language-bash"><code>rewrite ^/<span class="token punctuation">(</span>.*<span class="token punctuation">)</span>$ https://www.xxxx.com/<span class="token variable">$1</span><span class="token punctuation">;</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div><ul><li>与 if 指令结合</li></ul> <div class="language-bash line-numbers-mode"><pre class="language-bash"><code>server <span class="token punctuation">{</span>
    listen       <span class="token number">80</span><span class="token punctuation">;</span>
    server_name  test1.net test2.net<span class="token punctuation">;</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token variable">$host</span> <span class="token operator">!=</span> <span class="token string">'test1.net'</span> <span class="token punctuation">)</span> <span class="token punctuation">{</span>
        rewrite ^/<span class="token punctuation">(</span>.*<span class="token punctuation">)</span>$ http://www.baidu.net/<span class="token variable">$1</span> permanent<span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br></div></div><ol start="3"><li>查看 rewrite 日志: <code>rewrite_log on;</code></li></ol> <h4 id="配置-proxy-反向代理"><a href="#配置-proxy-反向代理" class="header-anchor">#</a> 配置 proxy/反向代理</h4> <ol><li><p>url 参数规则</p> <ul><li>url 必须以 http 或者 https 开头，接下来是域名、ip、unix socket 或者 upstream 名字，都可以就端口。后面是可选的 uri</li> <li>url 中是否携带 uri，结果也不一样，如果在 proxy_pass 后面的 url 加/，相当于是绝对根路径，则 nginx 不会把 location 中匹配的路径部分代理走；如果没有/，则会把匹配的路径部分给代理走。</li> <li>Url 参数中可以携带变量<code>proxy_pass http://$host$uri;</code></li></ul></li> <li><p>可以配合 rewrite break 语句</p></li></ol> <div class="language-bash line-numbers-mode"><pre class="language-bash"><code>location /nameb/ <span class="token punctuation">{</span> 
    rewrite /nameb/<span class="token punctuation">(</span><span class="token punctuation">[</span>^/<span class="token punctuation">]</span>+<span class="token punctuation">)</span> /test?nameb<span class="token operator">=</span><span class="token variable">$1</span> <span class="token builtin class-name">break</span><span class="token punctuation">;</span>
    proxy_pass http://127.0.0.1:8801/<span class="token punctuation">;</span> 
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br></div></div><ol start="3"><li>要配置 Nginx 作为反向代理，您需要使用 <code>location</code> 块中的 <code>proxy_pass</code> 指令
<ul><li>当使用 proxy_pass 指令时，确保后端服务器是可用的，否则 Nginx 将返回错误。</li> <li>使用 proxy_set_header 确保后端服务器接收到正确的请求头。</li> <li>如果后端服务器和 Nginx 在不同的机器上，确保网络连接是稳定的。</li></ul></li></ol> <h4 id="正则表达式"><a href="#正则表达式" class="header-anchor">#</a> 正则表达式</h4> <ul><li><code>~</code>: 表示大小写敏感的正则匹配；</li> <li><code>^</code>: 匹配字符串的开始；</li> <li><code>{.+}</code>: 换行符以外的任意字符重复一次或多次；</li> <li><code>()</code>: 分组与取值；</li> <li><code>:</code>: 表示转义；</li> <li><code>serno</code>: 设置提取的变量；<code>server_name ~^my(?&lt;serno&gt;.+).mydomain.com$;</code></li> <li><code>$</code>: 匹配字符串的结束；</li></ul> <h4 id="单页面应用刷新-404-问题"><a href="#单页面应用刷新-404-问题" class="header-anchor">#</a> 单页面应用刷新 404 问题</h4> <div class="language-bash line-numbers-mode"><pre class="language-bash"><code>location / <span class="token punctuation">{</span>
    try_files <span class="token variable">$uri</span> <span class="token variable">$uri</span>/ /index.html<span class="token punctuation">;</span>
    <span class="token comment"># 不使用缓存</span>
    add_header Cache-Control <span class="token string">&quot;no-store&quot;</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br></div></div><h4 id="配置跨域请求"><a href="#配置跨域请求" class="header-anchor">#</a> 配置跨域请求</h4> <div class="language-bash line-numbers-mode"><pre class="language-bash"><code><span class="token comment"># 配置跨域请求，示例代码结构</span>
user nginx<span class="token punctuation">;</span> <span class="token comment"># nginx进行运行的用户</span>
error_log /var/log/nginx/error.log<span class="token punctuation">;</span> <span class="token comment"># 错误日志</span>
http <span class="token punctuation">{</span>
    server_names_hash_bucket_size <span class="token number">512</span><span class="token punctuation">;</span> <span class="token comment"># 设置哈希表的大小</span>
    log_format main <span class="token punctuation">..</span>.<span class="token punctuation">;</span> <span class="token comment"># nginx日志格式</span>
    access_log /var/log/nginx/access.log main<span class="token punctuation">;</span> <span class="token comment"># 日志位置</span>
        
    <span class="token comment"># 引入的nginx配置文件，可以将server放在该目录下，方便管理</span>
    include /etc/nginx/conf.d/*.conf<span class="token punctuation">;</span> 
    <span class="token comment"># 一个nginx服务一个server</span>
    server <span class="token punctuation">{</span><span class="token punctuation">..</span>.<span class="token punctuation">}</span>
<span class="token punctuation">}</span>
<span class="token comment"># 配置跨域请求，server示例应该在http中，否则会报错</span>
server <span class="token punctuation">{</span>
    listen   <span class="token number">80</span><span class="token punctuation">;</span> <span class="token comment"># 服务启动的端口</span>
    server_name _<span class="token punctuation">;</span> <span class="token comment"># 服务域名或IP</span>
    root /usr/share/nginx/html<span class="token punctuation">;</span> <span class="token comment"># 服务指向的文件地址</span>

    location / <span class="token punctuation">{</span>
        <span class="token comment"># 服务器默认是不被允许跨域的。</span>
        <span class="token comment"># 配置`*`后，表示服务器可以接受所有的请求源（Origin）,即接受所有跨域的请求</span>
        add_header <span class="token string">'Access-Control-Allow-Origin'</span> <span class="token string">'*'</span><span class="token punctuation">;</span>
        <span class="token comment"># 允许的请求方法。</span>
        add_header <span class="token string">'Access-Control-Allow-Methods'</span> <span class="token string">'GET, POST, OPTIONS'</span><span class="token punctuation">;</span>
        <span class="token comment"># 允许的请求头。</span>
        add_header <span class="token string">'Access-Control-Allow-Headers'</span> <span class="token string">'DNT,X-Mx-ReqToken,Keep-Alive,User-Agent,X-Requested-With,If-Modified-Since,Cache-Control,Content-Type,Authorization'</span><span class="token punctuation">;</span>
        <span class="token comment"># 允许浏览器缓存预检请求的结果，单位为秒。</span>
        add_header <span class="token string">'Access-Control-Max-Age'</span> <span class="token number">1728000</span><span class="token punctuation">;</span>
        <span class="token comment"># 允许浏览器在实际请求中携带用户凭证。</span>
        add_header <span class="token string">'Access-Control-Allow-Credentials'</span> <span class="token string">'true'</span><span class="token punctuation">;</span>
        <span class="token comment"># 设置响应类型为JSON。</span>
        add_header <span class="token string">'Content-Type'</span> <span class="token string">'application/json charset=UTF-8'</span><span class="token punctuation">;</span>
        <span class="token comment"># 发送&quot;预检请求&quot;时，需要用到方法 OPTIONS ,所以服务器需要允许该方法</span>
        <span class="token comment"># 给OPTIONS 添加 204的返回，是为了处理在发送POST请求时Nginx依然拒绝访问的错误</span>
        <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token variable">$request_method</span> <span class="token operator">=</span> <span class="token string">'OPTIONS'</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
            <span class="token builtin class-name">return</span> <span class="token number">204</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>

        <span class="token comment"># etag on; # 默认开启</span>
        <span class="token comment"># last_modified on; # 默认开启</span>
    <span class="token punctuation">}</span>

    location /api/ <span class="token punctuation">{</span><span class="token punctuation">}</span>
    error_page <span class="token number">404</span> /404.html<span class="token punctuation">;</span> <span class="token comment"># 找不到资源重定向到404页面</span>
    location <span class="token operator">=</span> /40x.html <span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token punctuation">;</span>
            
    error_page <span class="token number">500</span> <span class="token number">502</span> <span class="token number">503</span> <span class="token number">504</span> /50x.html<span class="token punctuation">;</span> <span class="token comment"># 系统错误重定向50x页面</span>
    location <span class="token operator">=</span> /50x.html <span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br><span class="line-number">28</span><br><span class="line-number">29</span><br><span class="line-number">30</span><br><span class="line-number">31</span><br><span class="line-number">32</span><br><span class="line-number">33</span><br><span class="line-number">34</span><br><span class="line-number">35</span><br><span class="line-number">36</span><br><span class="line-number">37</span><br><span class="line-number">38</span><br><span class="line-number">39</span><br><span class="line-number">40</span><br><span class="line-number">41</span><br><span class="line-number">42</span><br><span class="line-number">43</span><br><span class="line-number">44</span><br><span class="line-number">45</span><br><span class="line-number">46</span><br><span class="line-number">47</span><br><span class="line-number">48</span><br><span class="line-number">49</span><br><span class="line-number">50</span><br></div></div><h3 id="root-与-alias-的区别"><a href="#root-与-alias-的区别" class="header-anchor">#</a> root 与 alias 的区别</h3> <ol><li>root 是直接拼接 root + location，而 alias 是用 alias 替换 location</li> <li>server 和 location 中的 root:
<ul><li>server 和 location 中都可以使用 root</li> <li>如果两者都出现，优先级就是就近原则，如果 location 中能匹配到，就是用 location 中的 root 配置，忽略 server 中的 root，当 location 中匹配不到的时候，则使用 server 中的 root 配置。</li></ul></li></ol> <h3 id="开启-gzip"><a href="#开启-gzip" class="header-anchor">#</a> 开启 gzip</h3> <p>Nginx 内置了 ngx_http_gzip_module 模块，该模块会拦截请求，并对需要做 Gzip 压缩的文件做压缩。因为是内部集成，所以我们只用修改 Nginx 的配置，就可以直接开启。</p> <div class="language-bash line-numbers-mode"><pre class="language-bash"><code><span class="token comment"># 登陆服务器</span>
<span class="token function">ssh</span> <span class="token parameter variable">-v</span> root@8.147.xxx.xxx

<span class="token comment"># 进入 Nginx 目录</span>
<span class="token builtin class-name">cd</span> /etc/nginx

<span class="token comment"># 修改 Nginx 配置</span>
<span class="token function">vim</span> nginx.conf

<span class="token comment"># 在 server 中添加 Gzip 压缩相关配置：</span>
server <span class="token punctuation">{</span>
  listen <span class="token number">443</span> ssl<span class="token punctuation">;</span>
  server_name ericyangxd.top<span class="token punctuation">;</span>
  ssl_certificate <span class="token punctuation">..</span>.<span class="token punctuation">;</span>
  ssl_certificate_key <span class="token punctuation">..</span>.<span class="token punctuation">;</span>
  ssl_session_timeout 5m<span class="token punctuation">;</span>
  ssl_ciphers ECDHE-RSA-AES256-GCM-SHA256:ECDHE:ECDH:AES:HIGH:<span class="token operator">!</span>NULL:<span class="token operator">!</span>aNULL:<span class="token operator">!</span>MD5:<span class="token operator">!</span>ADH:<span class="token operator">!</span>RC4<span class="token punctuation">;</span>
  ssl_protocols TLSv1.1 TLSv1.2 TLSv1.3<span class="token punctuation">;</span>
  ssl_prefer_server_ciphers on<span class="token punctuation">;</span>
  location / <span class="token punctuation">{</span>
    <span class="token comment"># 配置下nginx，告诉服务器，当我们访问的路径资源不存在的时候，默认指向静态资源index.html，配合history路由模式</span>
    try_files <span class="token variable">$uri</span> <span class="token variable">$uri</span>/ /index.html<span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
  location ^~ /my-vuepress-blog/ <span class="token punctuation">{</span>
    <span class="token builtin class-name">alias</span> /home/www/website/ts/<span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
  location / <span class="token punctuation">{</span>
    <span class="token builtin class-name">alias</span> /home/www/website/ts/<span class="token punctuation">;</span>
    index index.html<span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
  <span class="token comment"># 这里是新增的 gzip 配置</span>
  <span class="token function">gzip</span> on<span class="token punctuation">;</span> <span class="token comment">#开启gzip压缩输出</span>
  gzip_min_length 1k<span class="token punctuation">;</span> <span class="token comment">#最小压缩文件大小</span>
  gzip_comp_level <span class="token number">6</span><span class="token punctuation">;</span> <span class="token comment">#压缩等级</span>
  gzip_buffers <span class="token number">4</span> 16k<span class="token punctuation">;</span> <span class="token comment">#压缩缓冲区</span>
  gzip_http_version <span class="token number">1.0</span><span class="token punctuation">;</span> <span class="token comment">#压缩版本（默认1.1，前端如果是squid2.5请使用1.0）</span>

  <span class="token comment"># 设置什么类型的文件需要压缩</span>
  gzip_types application/atom+xml application/geo+json application/javascript application/x-javascript application/json application/ld+json application/manifest+json application/rdf+xml application/rss+xml application/xhtml+xml application/xml font/eot font/otf font/ttf image/svg+xml text/css text/javascript text/plain text/xml<span class="token punctuation">;</span>

  <span class="token comment"># 用于设置使用Gzip进行压缩发送是否携带“Vary:Accept-Encoding”头域的响应头部</span>
  <span class="token comment"># 主要是告诉接收方，所发送的数据经过了Gzip压缩处理</span>
  gzip_vary on<span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br><span class="line-number">28</span><br><span class="line-number">29</span><br><span class="line-number">30</span><br><span class="line-number">31</span><br><span class="line-number">32</span><br><span class="line-number">33</span><br><span class="line-number">34</span><br><span class="line-number">35</span><br><span class="line-number">36</span><br><span class="line-number">37</span><br><span class="line-number">38</span><br><span class="line-number">39</span><br><span class="line-number">40</span><br><span class="line-number">41</span><br><span class="line-number">42</span><br><span class="line-number">43</span><br><span class="line-number">44</span><br></div></div><ol><li>gzip ：是否开启 gzip 模块 on 表示开启 off 表示关闭，默认是 off</li> <li>gzip_min_length：设置压缩的最小文件大小，小于该设置值的文件将不会压缩</li> <li>gzip_comp_level：压缩级别，从 1 到 9，默认 1，数字越大压缩效果越好，但也会越占用 CPU 时间，这里选了一个常见的折中值</li> <li>gzip_types：进行压缩的文件类型</li> <li>gzip_vary：设置是否携带&quot;Vary:Accept-Encoding&quot;的响应头部。</li> <li>gzip_buffers：处理请求压缩的缓冲区数量和大小。</li> <li>gzip_disable：选择性地开启和关闭 gzip 功能，基于客户端的浏览器标志。</li> <li>gzip_http_version：针对不同的 http 协议版本，选择性地开启和关闭 gzip 功能。</li> <li>gzip_proxied：设置是否对 nginx 服务器对后台服务器返回的结果进行 gzip 压缩。</li></ol> <p>重新加载一次 Nginx 配置：<code>systemctl reload nginx</code></p> <h2 id="openresty"><a href="#openresty" class="header-anchor">#</a> OpenResty</h2> <p>OpenResty 并不是一个全新的 Web 服务器，而是基于 Nginx，它利用了 Nginx 模块化、可扩展的特性，开发了一系列的增强模块，并把它们打包整合，形成了一个“一站式”的 Web 开发平台。</p> <p>虽然 OpenResty 的核心是 Nginx，但它又超越了 Nginx，关键就在于其中的 ngx_lua 模块，把小巧灵活的 Lua 语言嵌入了 Nginx，可以用脚本的方式操作 Nginx 内部的进程、多路复用、阶段式处理等各种构件。脚本语言的好处你一定知道，它不需要编译，随写随执行，这就免去了 C 语言编写模块漫长的开发周期。OpenResty 还把 Lua 自身的协程与 Nginx 的事件机制完美结合在一起，优雅地实现了许多其他语言所没有的“同步非阻塞”编程范式，能够轻松开发出高性能的 Web 应用。</p> <ol><li>Nginx 依赖于磁盘上的静态配置文件，修改后必须重启才能生效，缺乏灵活性；</li> <li>OpenResty 基于 Nginx，打包了很多有用的模块和库，是一个高性能的 Web 开发平台；</li> <li>OpenResty 的工作语言是 Lua，它小巧灵活，执行效率高，支持“代码热加载”；</li> <li>OpenResty 的核心编程范式是“同步非阻塞”，使用协程，不需要异步回调函数；</li> <li>OpenResty 也使用“阶段式处理”的工作模式，但因为在阶段里执行的都是 Lua 代码，所以非常灵活，配合 Redis 等外部数据库能够实现各种动态配置。</li></ol> <div class="custom-block tip"><p class="title"></p><p>tips test</p></div><details class="custom-block details"><summary>See More</summary> <p>折叠详情块，在 IE/Edge 中不生效</p></details> <h2 id="缓存问题"><a href="#缓存问题" class="header-anchor">#</a> 缓存问题</h2> <h3 id="前端缓存-前端发布新代码后的浏览器缓存问题"><a href="#前端缓存-前端发布新代码后的浏览器缓存问题" class="header-anchor">#</a> 前端缓存-前端发布新代码后的浏览器缓存问题</h3> <p>解决方法</p> <ol><li>用户自行清理浏览器缓存。</li></ol> <ul><li>优点：清除浏览器缓存后可达到效果。</li> <li>缺点：影响用户体验</li></ul> <ol start="2"><li>使用禁用缓存标签，实现禁用浏览器缓存。（优先级略低）</li></ol> <ul><li>优点：可达到效果。</li> <li>缺点：每次请求页面都要重新请求，我们还是希望有缓存的</li></ul> <div class="language-html line-numbers-mode"><pre class="language-html"><code><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>meta</span> <span class="token attr-name">http-equiv</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>Cache-Control<span class="token punctuation">&quot;</span></span> <span class="token attr-name">content</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>no-cache, no-store, must-revalidate<span class="token punctuation">&quot;</span></span> <span class="token punctuation">/&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>meta</span> <span class="token attr-name">http-equiv</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>Cache<span class="token punctuation">&quot;</span></span> <span class="token attr-name">content</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>no-cache<span class="token punctuation">&quot;</span></span> <span class="token punctuation">/&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>meta</span> <span class="token attr-name">http-equiv</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>Pragma<span class="token punctuation">&quot;</span></span> <span class="token attr-name">content</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>no-cache<span class="token punctuation">&quot;</span></span> <span class="token punctuation">/&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>meta</span> <span class="token attr-name">http-equiv</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>Expires<span class="token punctuation">&quot;</span></span> <span class="token attr-name">content</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>0<span class="token punctuation">&quot;</span></span> <span class="token punctuation">/&gt;</span></span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br></div></div><ol start="3"><li>为 js 和 css 文件添加版本号。</li></ol> <ul><li>优点：可达到效果。</li> <li>缺点：给所有的静态资源都添加版本号参数，这个参数可以是时间戳或者随机数。处理方式的代码如下：</li></ul> <div class="language-html line-numbers-mode"><pre class="language-html"><code><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>link</span>
  <span class="token attr-name">rel</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>stylesheet<span class="token punctuation">&quot;</span></span>
  <span class="token attr-name">type</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>text/css<span class="token punctuation">&quot;</span></span>
  <span class="token attr-name">href</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>${pageContext.request.contextPath}/static/plugins/layui-v2.5.5/layui/css/layui.css?v=20200110052406<span class="token punctuation">&quot;</span></span> <span class="token punctuation">/&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>link</span>
  <span class="token attr-name">rel</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>stylesheet<span class="token punctuation">&quot;</span></span>
  <span class="token attr-name">type</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>text/css<span class="token punctuation">&quot;</span></span>
  <span class="token attr-name">href</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>${pageContext.request.contextPath}/static/css/style.css?v=20200110052406<span class="token punctuation">&quot;</span></span> <span class="token punctuation">/&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>link</span>
  <span class="token attr-name">rel</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>stylesheet<span class="token punctuation">&quot;</span></span>
  <span class="token attr-name">type</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>text/css<span class="token punctuation">&quot;</span></span>
  <span class="token attr-name">href</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>${pageContext.request.contextPath}/static/css/addStyle.css?v=20200110052406<span class="token punctuation">&quot;</span></span> <span class="token punctuation">/&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>link</span>
  <span class="token attr-name">rel</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>stylesheet<span class="token punctuation">&quot;</span></span>
  <span class="token attr-name">type</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>text/css<span class="token punctuation">&quot;</span></span>
  <span class="token attr-name">href</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>${pageContext.request.contextPath}/static/css/template/addStyle.css?v=20200110052406<span class="token punctuation">&quot;</span></span> <span class="token punctuation">/&gt;</span></span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br></div></div><ol start="4"><li>修改 nginx 配置。（满足以下条件后有缓存可以修改 nginx 配置文件）背景：</li></ol> <ul><li>使用 nginx 做代理</li> <li>使用 webpack 等打包出一个唯一的入口文件 index.html，或者其他方式的入口 html 文件</li> <li>入口 html 文件中 js 已经使用 hash 后缀方式加载</li> <li>缺点：需要前端人员会配置 nginx</li></ul> <div class="language-bash line-numbers-mode"><pre class="language-bash"><code>location ~ .*<span class="token punctuation">\</span>.<span class="token punctuation">(</span>htm<span class="token operator">|</span>html<span class="token punctuation">)</span>?$ <span class="token punctuation">{</span>
  <span class="token comment"># 原来这样设置的不管用</span>
  <span class="token comment"># expires -1;</span>
  <span class="token comment"># 现在改为，增加缓存</span>
  add_header Cache-Control <span class="token string">&quot;private, no-store, no-cache, must-revalidate, proxy-revalidate&quot;</span><span class="token punctuation">;</span>
  access_log on<span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br></div></div><h3 id="nginx-缓存问题"><a href="#nginx-缓存问题" class="header-anchor">#</a> Nginx 缓存问题</h3> <p>每次修改了动态的内容，缓存却没过期，这样就必须手动清理缓存了。于是尝试使用<code>nginx</code>+<code>ngx_cache_purge</code>模块。</p> <p>需要下载 NGINX 源码和模块源码进行编译，参考<a href="https://www.henghost.com/zixun/7981/" target="_blank" rel="nofollow noopener noreferrer">这里<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></p> <h3 id="nginx-同域名不同前缀-访问不同前后端项目"><a href="#nginx-同域名不同前缀-访问不同前后端项目" class="header-anchor">#</a> Nginx 同域名不同前缀，访问不同前后端项目</h3> <p>在一台 NGINX 机器上通过多端口多域名来配置实现同时跑多个项目。</p> <div class="language-bash line-numbers-mode"><pre class="language-bash"><code>server <span class="token punctuation">{</span>
  <span class="token comment"># 这里默认监听80端口，可根据项目需要自行设置需要监听的端口号</span>
  listen <span class="token number">80</span><span class="token punctuation">;</span>
  server_name 此处填写项目发布的域名或者ip地址<span class="token punctuation">;</span>
  <span class="token comment"># listen       80 default_server;</span>
  <span class="token comment"># listen       [::]:80 default_server;</span>
  <span class="token comment"># server_name  _;</span>
  <span class="token comment"># root         /usr/share/nginx/html;</span>
  <span class="token comment"># Load configuration files for the default server block.</span>
  <span class="token comment"># include /etc/nginx/default.d/*.conf;</span>

  location / <span class="token punctuation">{</span>
    root 此处填写前端项目文件路径（默认访问的前端项目一的路径）<span class="token punctuation">;</span>
    index index.html index.htm<span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
  <span class="token comment"># eg.</span>
  location / <span class="token punctuation">{</span>
    root /etc/nginx/html/<span class="token punctuation">;</span>
    index index.html<span class="token punctuation">;</span>
  <span class="token punctuation">}</span>

  <span class="token comment"># 这里因为每个server只能有一个root 所以在根目录默认有root之后，</span>
  <span class="token comment"># 可以通过alias来配置其他文件路径</span>
  <span class="token comment"># ex: http://www.xxx.com:xxx/unst/#/xxx,</span>
  <span class="token comment"># 将/unst这个前置在页面跳转时加入url的#号之前即可</span>
  location /unst <span class="token punctuation">{</span>
    <span class="token builtin class-name">alias</span> 此处填写前端项目文件路径（前端项目二的路径）<span class="token punctuation">;</span>
    index index.html index.htm<span class="token punctuation">;</span>
  <span class="token punctuation">}</span>

	<span class="token comment"># 前端项目一对应的后端服务一的跳转配置</span>
	location /st/ <span class="token punctuation">{</span>
    proxy_redirect off<span class="token punctuation">;</span>
    proxy_set_header Host <span class="token variable">$host</span><span class="token punctuation">;</span>
    proxy_set_header X-Real-IP <span class="token variable">$remote_addr</span><span class="token punctuation">;</span>
    proxy_set_header X-Forwarded-For <span class="token variable">$proxy_add_x_forwarded_for</span><span class="token punctuation">;</span>
    proxy_pass http://127.0.0.1:8089<span class="token punctuation">;</span>
  <span class="token punctuation">}</span>

  <span class="token comment"># 前端项目二对应的后端服务二的跳转配置</span>
  location /un/ <span class="token punctuation">{</span>
    proxy_pass http://127.0.0.1:8091<span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br><span class="line-number">28</span><br><span class="line-number">29</span><br><span class="line-number">30</span><br><span class="line-number">31</span><br><span class="line-number">32</span><br><span class="line-number">33</span><br><span class="line-number">34</span><br><span class="line-number">35</span><br><span class="line-number">36</span><br><span class="line-number">37</span><br><span class="line-number">38</span><br><span class="line-number">39</span><br><span class="line-number">40</span><br><span class="line-number">41</span><br><span class="line-number">42</span><br><span class="line-number">43</span><br><span class="line-number">44</span><br></div></div><h2 id="nginx-日志"><a href="#nginx-日志" class="header-anchor">#</a> Nginx 日志</h2> <p>Nginx 存储主要活动日志的目录可能位于 <code>/var/log/nginx/</code>或 <code>/usr/local/nginx/logs/</code> 这两个位置。</p> <h2 id="centos-设置-nginx-开机启动"><a href="#centos-设置-nginx-开机启动" class="header-anchor">#</a> CentOS 设置 Nginx 开机启动</h2> <ol><li>在系统服务目录里创建<code>nginx.service</code>文件，<code>vi /usr/lib/systemd/system/nginx.service</code>，内容如下：</li></ol> <div class="language-sh line-numbers-mode"><pre class="language-sh"><code><span class="token punctuation">[</span>Unit<span class="token punctuation">]</span>
<span class="token assign-left variable">Description</span><span class="token operator">=</span>The nginx HTTP and reverse proxy server
<span class="token assign-left variable">After</span><span class="token operator">=</span>network.target remote-fs.target nss-lookup.target

<span class="token punctuation">[</span>Service<span class="token punctuation">]</span>
<span class="token assign-left variable">Type</span><span class="token operator">=</span>forking
<span class="token assign-left variable">PIDFile</span><span class="token operator">=</span>/run/nginx.pid
<span class="token comment"># Nginx will fail to start if /run/nginx.pid already exists but has the wrong</span>
<span class="token comment"># SELinux context. This might happen when running `nginx -t` from the cmdline.</span>
<span class="token comment"># https://bugzilla.redhat.com/show_bug.cgi?id=1268621</span>
<span class="token assign-left variable">ExecStartPre</span><span class="token operator">=</span>/usr/bin/rm <span class="token parameter variable">-f</span> /run/nginx.pid
<span class="token assign-left variable">ExecStartPre</span><span class="token operator">=</span>/usr/sbin/nginx <span class="token parameter variable">-t</span>
<span class="token assign-left variable">ExecStart</span><span class="token operator">=</span>/usr/sbin/nginx
<span class="token assign-left variable">ExecReload</span><span class="token operator">=</span>/bin/kill <span class="token parameter variable">-s</span> HUP <span class="token variable">$MAINPID</span>
<span class="token assign-left variable">ExecStop</span><span class="token operator">=</span>/usr/sbin/nginx <span class="token parameter variable">-s</span> quit
<span class="token assign-left variable">KillSignal</span><span class="token operator">=</span>SIGQUIT
<span class="token assign-left variable">TimeoutStopSec</span><span class="token operator">=</span><span class="token number">5</span>
<span class="token assign-left variable">KillMode</span><span class="token operator">=</span>mixed
<span class="token assign-left variable">PrivateTmp</span><span class="token operator">=</span>true

<span class="token punctuation">[</span>Install<span class="token punctuation">]</span>
<span class="token assign-left variable">WantedBy</span><span class="token operator">=</span>multi-user.target
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br></div></div><ol start="2"><li>设置开机自启动: <code>systemctl enable nginx.service</code></li> <li>查看 nginx 状态: <code>systemctl status nginx.service</code></li> <li>杀死 nginx 重启 nginx: <code>pkill -9 nginx</code>,<code>ps aux | grep nginx</code>,<code>systemctl start nginx</code></li></ol> <h2 id="静态资源优化"><a href="#静态资源优化" class="header-anchor">#</a> 静态资源优化</h2> <p>为了提高静态资源的传输效率，Nginx 提供了以下三个主要的优化指令：</p> <ul><li><code>sendfile</code>: 用于开启高效的文件传输模式。它通过调用系统内核的 <code>sendfile</code> 函数来实现，从而避免了文件的多次拷贝，同时减少了用户态和内核态之间的切换，从而提高了静态文件的传输效率。</li> <li><code>tcp_nopush</code>: 当 <code>sendfile</code> 开启时，<code>tcp_nopush</code> 也可以被启用。它的主要目的是提高网络数据包的传输效率。</li> <li><code>tcp_nodelay</code>: 只有在 <code>keep-alive</code> 连接开启时，<code>tcp_nodelay</code> 才能生效。它的目的是提高网络数据包的实时性。</li></ul> <h2 id="防盗链"><a href="#防盗链" class="header-anchor">#</a> 防盗链</h2> <p>防盗链是指防止其他网站直接链接到你的网站资源（如图片、视频等），从而消耗你的服务器带宽。Nginx 提供了一个非常方便的模块——<code>ngx_http_referer_module</code>，用于实现防盗链功能。</p> <h3 id="基本的防盗链配置"><a href="#基本的防盗链配置" class="header-anchor">#</a> 基本的防盗链配置：</h3> <div class="language-bash line-numbers-mode"><pre class="language-bash"><code>location ~ .*.<span class="token punctuation">(</span>gif<span class="token operator">|</span>jpg<span class="token operator">|</span>jpeg<span class="token operator">|</span>png<span class="token operator">|</span>bmp<span class="token operator">|</span>swf<span class="token punctuation">)</span>$ <span class="token punctuation">{</span>
    valid_referers none blocked www.example.com example.com *.example.net<span class="token punctuation">;</span>

    <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token variable">$invalid_referer</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token builtin class-name">return</span> <span class="token number">403</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br></div></div><h3 id="使用错误图片代替原图片"><a href="#使用错误图片代替原图片" class="header-anchor">#</a> 使用错误图片代替原图片</h3> <div class="language-bash line-numbers-mode"><pre class="language-bash"><code>location ~ .*.<span class="token punctuation">(</span>gif<span class="token operator">|</span>jpg<span class="token operator">|</span>jpeg<span class="token operator">|</span>png<span class="token operator">|</span>bmp<span class="token operator">|</span>swf<span class="token punctuation">)</span>$ <span class="token punctuation">{</span>
    valid_referers none blocked www.example.com example.com *.example.net<span class="token punctuation">;</span>

    <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token variable">$invalid_referer</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        rewrite ^/.*$ /path/to/error/image.jpg<span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br></div></div><h3 id="注意事项"><a href="#注意事项" class="header-anchor">#</a> 注意事项：</h3> <ul><li>防盗链配置可能会影响搜索引擎的爬虫，因此在实施防盗链策略时要小心。</li> <li>如果你的网站使用了 CDN，确保 CDN 的服务器也在 valid_referers 列表中，否则 CDN 可能无法正常工作。</li> <li>为了确保防盗链配置正确，你应该在生产环境之前在测试环境中进行充分的测试。</li></ul> <h2 id="内置变量"><a href="#内置变量" class="header-anchor">#</a> 内置变量</h2> <p>nginx 的配置文件中可以使用的内置变量以美元符$开始。其中，大部分预定义的变量的值由客户端发送携带。</p> <div class="language-bash line-numbers-mode"><pre class="language-bash"><code><span class="token variable">$args</span> 请求行中的参数，同<span class="token variable">$query_string</span>
<span class="token variable">$content_length</span> 请求头中的Content-length字段
<span class="token variable">$content_type</span> 请求头中的Content-Type字段
<span class="token variable">$document_root</span> 当前请求在root指令中指定的值
<span class="token variable">$host</span> 请求行的主机名，或请求头字段 Host 中的主机名
<span class="token variable">$http_user_agent</span> 客户端agent信息
<span class="token variable">$http_cookie</span> 客户端cookie信息
<span class="token variable">$limit_rate</span> 可以限制连接速率的变量
<span class="token variable">$request_method</span> 客户端请求的动作，如GET或POST
<span class="token variable">$remote_addr</span> 客户端的IP地址
<span class="token variable">$remote_port</span> 客户端的端口
<span class="token variable">$remote_user</span> 已经经过Auth Basic Module验证的用户名
<span class="token variable">$request_filename</span> 当前请求的文件路径
<span class="token variable">$scheme</span> HTTP方法（如http，https）
<span class="token variable">$server_protocol</span> 请求使用的协议，如HTTP/1.0或HTTP/1.1
<span class="token variable">$server_addr</span> 服务器地址
<span class="token variable">$server_name</span> 服务器名称
<span class="token variable">$server_port</span> 请求到达服务器的端口号
<span class="token variable">$request_uri</span> 包含请求参数的原始URI
<span class="token variable">$uri</span> 不带请求参数的当前URI
<span class="token variable">$document_uri</span> 与<span class="token variable">$uri</span>相同
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br></div></div><h3 id="本地-nginx"><a href="#本地-nginx" class="header-anchor">#</a> 本地 nginx</h3> <ol><li>安装：<code>brew install nginx</code></li> <li>安装位置：<code>/usr/local/Cellar/nginx/1.25.3</code></li> <li>配置文件：<code>/usr/local/etc/nginx/nginx.conf</code></li> <li>重启（不一定有用）：<code>brew services restart nginx</code></li> <li>在 http 下可以有多个 Server，启动多个服务，但如果都写在一个文件里面，文件就越来越大了，那么为了便于管理多个服务，我们要对 nginx.conf 进行拆分。conf.d 目录下一般是空的，我们新建文件 web.conf 或者任意命名的以.conf 结尾的文件即可被 Nginx 使用，需要在 http 下添加<code>include conf.d/*.conf</code></li> <li>检查 nginx 配置文件是否正确，如果错误会提示具体的错误信息：<code>nginx -t</code></li> <li></li></ol></div></section> <footer class="page-edit"><!----> <div class="last-updated"><span class="prefix">上次更新: </span> <span class="time">5/28/2025</span></div></footer> <div class="page-nav"><p class="inner"><span class="prev"><a href="/handbook/Skill/Linux.html" class="prev">
            Linux常用命令
          </a></span> <span class="next"><a href="/handbook/Skill/Python.html">
            Python
          </a></span></p></div> <div class="comments-wrapper"><!----></div> <ul class="side-bar sub-sidebar-wrapper" style="width:12rem;" data-v-cb1513f6><li class="level-2" data-v-cb1513f6><a href="/handbook/Skill/Nginx.html#nginx-是什么" class="sidebar-link reco-side-nginx-是什么" data-v-cb1513f6>Nginx 是什么</a></li><li class="level-3" data-v-cb1513f6><a href="/handbook/Skill/Nginx.html#优势" class="sidebar-link reco-side-优势" data-v-cb1513f6>优势</a></li><li class="level-3" data-v-cb1513f6><a href="/handbook/Skill/Nginx.html#缺点" class="sidebar-link reco-side-缺点" data-v-cb1513f6>缺点</a></li><li class="level-3" data-v-cb1513f6><a href="/handbook/Skill/Nginx.html#正向代理和反向代理" class="sidebar-link reco-side-正向代理和反向代理" data-v-cb1513f6>正向代理和反向代理</a></li><li class="level-3" data-v-cb1513f6><a href="/handbook/Skill/Nginx.html#负载均衡" class="sidebar-link reco-side-负载均衡" data-v-cb1513f6>负载均衡</a></li><li class="level-3" data-v-cb1513f6><a href="/handbook/Skill/Nginx.html#动静分离" class="sidebar-link reco-side-动静分离" data-v-cb1513f6>动静分离</a></li><li class="level-3" data-v-cb1513f6><a href="/handbook/Skill/Nginx.html#常用的命令" class="sidebar-link reco-side-常用的命令" data-v-cb1513f6>常用的命令</a></li><li class="level-3" data-v-cb1513f6><a href="/handbook/Skill/Nginx.html#nginx-的配置文件" class="sidebar-link reco-side-nginx-的配置文件" data-v-cb1513f6>Nginx 的配置文件</a></li><li class="level-3" data-v-cb1513f6><a href="/handbook/Skill/Nginx.html#root-与-alias-的区别" class="sidebar-link reco-side-root-与-alias-的区别" data-v-cb1513f6>root 与 alias 的区别</a></li><li class="level-3" data-v-cb1513f6><a href="/handbook/Skill/Nginx.html#开启-gzip" class="sidebar-link reco-side-开启-gzip" data-v-cb1513f6>开启 gzip</a></li><li class="level-2" data-v-cb1513f6><a href="/handbook/Skill/Nginx.html#openresty" class="sidebar-link reco-side-openresty" data-v-cb1513f6>OpenResty</a></li><li class="level-2" data-v-cb1513f6><a href="/handbook/Skill/Nginx.html#缓存问题" class="sidebar-link reco-side-缓存问题" data-v-cb1513f6>缓存问题</a></li><li class="level-3" data-v-cb1513f6><a href="/handbook/Skill/Nginx.html#前端缓存-前端发布新代码后的浏览器缓存问题" class="sidebar-link reco-side-前端缓存-前端发布新代码后的浏览器缓存问题" data-v-cb1513f6>前端缓存-前端发布新代码后的浏览器缓存问题</a></li><li class="level-3" data-v-cb1513f6><a href="/handbook/Skill/Nginx.html#nginx-缓存问题" class="sidebar-link reco-side-nginx-缓存问题" data-v-cb1513f6>Nginx 缓存问题</a></li><li class="level-3" data-v-cb1513f6><a href="/handbook/Skill/Nginx.html#nginx-同域名不同前缀-访问不同前后端项目" class="sidebar-link reco-side-nginx-同域名不同前缀-访问不同前后端项目" data-v-cb1513f6>Nginx 同域名不同前缀，访问不同前后端项目</a></li><li class="level-2" data-v-cb1513f6><a href="/handbook/Skill/Nginx.html#nginx-日志" class="sidebar-link reco-side-nginx-日志" data-v-cb1513f6>Nginx 日志</a></li><li class="level-2" data-v-cb1513f6><a href="/handbook/Skill/Nginx.html#centos-设置-nginx-开机启动" class="sidebar-link reco-side-centos-设置-nginx-开机启动" data-v-cb1513f6>CentOS 设置 Nginx 开机启动</a></li><li class="level-2" data-v-cb1513f6><a href="/handbook/Skill/Nginx.html#静态资源优化" class="sidebar-link reco-side-静态资源优化" data-v-cb1513f6>静态资源优化</a></li><li class="level-2" data-v-cb1513f6><a href="/handbook/Skill/Nginx.html#防盗链" class="sidebar-link reco-side-防盗链" data-v-cb1513f6>防盗链</a></li><li class="level-3" data-v-cb1513f6><a href="/handbook/Skill/Nginx.html#基本的防盗链配置" class="sidebar-link reco-side-基本的防盗链配置" data-v-cb1513f6>基本的防盗链配置：</a></li><li class="level-3" data-v-cb1513f6><a href="/handbook/Skill/Nginx.html#使用错误图片代替原图片" class="sidebar-link reco-side-使用错误图片代替原图片" data-v-cb1513f6>使用错误图片代替原图片</a></li><li class="level-3" data-v-cb1513f6><a href="/handbook/Skill/Nginx.html#注意事项" class="sidebar-link reco-side-注意事项" data-v-cb1513f6>注意事项：</a></li><li class="level-2" data-v-cb1513f6><a href="/handbook/Skill/Nginx.html#内置变量" class="sidebar-link reco-side-内置变量" data-v-cb1513f6>内置变量</a></li><li class="level-3" data-v-cb1513f6><a href="/handbook/Skill/Nginx.html#本地-nginx" class="sidebar-link reco-side-本地-nginx" data-v-cb1513f6>本地 nginx</a></li></ul></main> <!----></div></div></div></div><div class="global-ui"><div class="back-to-ceiling" style="right:1rem;bottom:6rem;width:2.5rem;height:2.5rem;border-radius:.25rem;line-height:2.5rem;display:none;" data-v-c6073ba8 data-v-c6073ba8><svg t="1574745035067" viewBox="0 0 1024 1024" version="1.1" xmlns="http://www.w3.org/2000/svg" p-id="5404" class="icon" data-v-c6073ba8><path d="M526.60727968 10.90185116a27.675 27.675 0 0 0-29.21455937 0c-131.36607665 82.28402758-218.69155461 228.01873535-218.69155402 394.07834331a462.20625001 462.20625001 0 0 0 5.36959153 69.94390903c1.00431239 6.55289093-0.34802892 13.13561351-3.76865779 18.80351572-32.63518765 54.11355614-51.75690182 118.55860487-51.7569018 187.94566865a371.06718723 371.06718723 0 0 0 11.50484808 91.98906777c6.53300375 25.50556257 41.68394495 28.14064038 52.69160883 4.22606766 17.37162448-37.73630017 42.14135425-72.50938081 72.80769204-103.21549295 2.18761121 3.04276886 4.15646224 6.24463696 6.40373557 9.22774369a1871.4375 1871.4375 0 0 0 140.04691725 5.34970492 1866.36093723 1866.36093723 0 0 0 140.04691723-5.34970492c2.24727335-2.98310674 4.21612437-6.18497483 6.3937923-9.2178004 30.66633723 30.70611158 55.4360664 65.4791928 72.80769147 103.21549355 11.00766384 23.91457269 46.15860503 21.27949489 52.69160879-4.22606768a371.15156223 371.15156223 0 0 0 11.514792-91.99901164c0-69.36717486-19.13165746-133.82216804-51.75690182-187.92578088-3.42062944-5.66790279-4.76302748-12.26056868-3.76865837-18.80351632a462.20625001 462.20625001 0 0 0 5.36959269-69.943909c-0.00994388-166.08943902-87.32547796-311.81420293-218.6915546-394.09823051zM605.93803103 357.87693858a93.93749974 93.93749974 0 1 1-187.89594924 6.1e-7 93.93749974 93.93749974 0 0 1 187.89594924-6.1e-7z" p-id="5405" data-v-c6073ba8></path><path d="M429.50777625 765.63860547C429.50777625 803.39355007 466.44236686 1000.39046097 512.00932183 1000.39046097c45.56695499 0 82.4922232-197.00623328 82.5015456-234.7518555 0-37.75494459-36.9345906-68.35043303-82.4922232-68.34111062-45.57627738-0.00932239-82.52019037 30.59548842-82.51086798 68.34111062z" p-id="5406" data-v-c6073ba8></path></svg></div><div></div></div></div>
    <script src="/assets/js/app.2e93e985.js" defer></script><script src="/assets/js/4.e4a90c70.js" defer></script><script src="/assets/js/3.ad1ccd56.js" defer></script><script src="/assets/js/2.0240bc78.js" defer></script><script src="/assets/js/1.b94e320b.js" defer></script><script src="/assets/js/121.74079ff9.js" defer></script>
  </body>
</html>
